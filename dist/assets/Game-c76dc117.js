var ht=(a,t,e)=>{if(!t.has(a))throw TypeError("Cannot "+e)};var I=(a,t,e)=>(ht(a,t,"read from private field"),e?e.call(a):t.get(a)),G=(a,t,e)=>{if(t.has(a))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(a):t.set(a,e)},O=(a,t,e,i)=>(ht(a,t,"write to private field"),i?i.call(a,e):t.set(a,e),e);var Ct=(a,t,e)=>(ht(a,t,"access private method"),e);import{g as Re,B as Yt,o as _,b as R,f as A,_ as W,m as Q,h as K,c as B,i as Ut,j as E,k as $,r as P,t as F,F as V,d as z,w as p,a as T,l as $e,e as x,n as Me,D as xt,p as ee}from"./index-dfdf83d7.js";var jt={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(a){(function(){var t=function(){this.init()};t.prototype={init:function(){var n=this||e;return n._counter=1e3,n._html5AudioPool=[],n.html5PoolSize=10,n._codecs={},n._howls=[],n._muted=!1,n._volume=1,n._canPlayEvent="canplaythrough",n._navigator=typeof window<"u"&&window.navigator?window.navigator:null,n.masterGain=null,n.noAudio=!1,n.usingWebAudio=!0,n.autoSuspend=!0,n.ctx=null,n.autoUnlock=!0,n._setup(),n},volume:function(n){var o=this||e;if(n=parseFloat(n),o.ctx||h(),typeof n<"u"&&n>=0&&n<=1){if(o._volume=n,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(n,e.ctx.currentTime);for(var l=0;l<o._howls.length;l++)if(!o._howls[l]._webAudio)for(var d=o._howls[l]._getSoundIds(),y=0;y<d.length;y++){var b=o._howls[l]._soundById(d[y]);b&&b._node&&(b._node.volume=b._volume*n)}return o}return o._volume},mute:function(n){var o=this||e;o.ctx||h(),o._muted=n,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(n?0:o._volume,e.ctx.currentTime);for(var l=0;l<o._howls.length;l++)if(!o._howls[l]._webAudio)for(var d=o._howls[l]._getSoundIds(),y=0;y<d.length;y++){var b=o._howls[l]._soundById(d[y]);b&&b._node&&(b._node.muted=n?!0:b._muted)}return o},stop:function(){for(var n=this||e,o=0;o<n._howls.length;o++)n._howls[o].stop();return n},unload:function(){for(var n=this||e,o=n._howls.length-1;o>=0;o--)n._howls[o].unload();return n.usingWebAudio&&n.ctx&&typeof n.ctx.close<"u"&&(n.ctx.close(),n.ctx=null,h()),n},codecs:function(n){return(this||e)._codecs[n.replace(/^x-/,"")]},_setup:function(){var n=this||e;if(n.state=n.ctx&&n.ctx.state||"suspended",n._autoSuspend(),!n.usingWebAudio)if(typeof Audio<"u")try{var o=new Audio;typeof o.oncanplaythrough>"u"&&(n._canPlayEvent="canplay")}catch{n.noAudio=!0}else n.noAudio=!0;try{var o=new Audio;o.muted&&(n.noAudio=!0)}catch{}return n.noAudio||n._setupCodecs(),n},_setupCodecs:function(){var n=this||e,o=null;try{o=typeof Audio<"u"?new Audio:null}catch{return n}if(!o||typeof o.canPlayType!="function")return n;var l=o.canPlayType("audio/mpeg;").replace(/^no$/,""),d=n._navigator?n._navigator.userAgent:"",y=d.match(/OPR\/([0-6].)/g),b=y&&parseInt(y[0].split("/")[1],10)<33,g=d.indexOf("Safari")!==-1&&d.indexOf("Chrome")===-1,w=d.match(/Version\/(.*?) /),S=g&&w&&parseInt(w[1],10)<15;return n._codecs={mp3:!!(!b&&(l||o.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!l,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(o.canPlayType('audio/wav; codecs="1"')||o.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(o.canPlayType("audio/x-m4b;")||o.canPlayType("audio/m4b;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!S&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!S&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")},n},_unlockAudio:function(){var n=this||e;if(!(n._audioUnlocked||!n.ctx)){n._audioUnlocked=!1,n.autoUnlock=!1,!n._mobileUnloaded&&n.ctx.sampleRate!==44100&&(n._mobileUnloaded=!0,n.unload()),n._scratchBuffer=n.ctx.createBuffer(1,1,22050);var o=function(l){for(;n._html5AudioPool.length<n.html5PoolSize;)try{var d=new Audio;d._unlocked=!0,n._releaseHtml5Audio(d)}catch{n.noAudio=!0;break}for(var y=0;y<n._howls.length;y++)if(!n._howls[y]._webAudio)for(var b=n._howls[y]._getSoundIds(),g=0;g<b.length;g++){var w=n._howls[y]._soundById(b[g]);w&&w._node&&!w._node._unlocked&&(w._node._unlocked=!0,w._node.load())}n._autoResume();var S=n.ctx.createBufferSource();S.buffer=n._scratchBuffer,S.connect(n.ctx.destination),typeof S.start>"u"?S.noteOn(0):S.start(0),typeof n.ctx.resume=="function"&&n.ctx.resume(),S.onended=function(){S.disconnect(0),n._audioUnlocked=!0,document.removeEventListener("touchstart",o,!0),document.removeEventListener("touchend",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",o,!0);for(var M=0;M<n._howls.length;M++)n._howls[M]._emit("unlock")}};return document.addEventListener("touchstart",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",o,!0),n}},_obtainHtml5Audio:function(){var n=this||e;if(n._html5AudioPool.length)return n._html5AudioPool.pop();var o=new Audio().play();return o&&typeof Promise<"u"&&(o instanceof Promise||typeof o.then=="function")&&o.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(n){var o=this||e;return n._unlocked&&o._html5AudioPool.push(n),o},_autoSuspend:function(){var n=this;if(!(!n.autoSuspend||!n.ctx||typeof n.ctx.suspend>"u"||!e.usingWebAudio)){for(var o=0;o<n._howls.length;o++)if(n._howls[o]._webAudio){for(var l=0;l<n._howls[o]._sounds.length;l++)if(!n._howls[o]._sounds[l]._paused)return n}return n._suspendTimer&&clearTimeout(n._suspendTimer),n._suspendTimer=setTimeout(function(){if(n.autoSuspend){n._suspendTimer=null,n.state="suspending";var d=function(){n.state="suspended",n._resumeAfterSuspend&&(delete n._resumeAfterSuspend,n._autoResume())};n.ctx.suspend().then(d,d)}},3e4),n}},_autoResume:function(){var n=this;if(!(!n.ctx||typeof n.ctx.resume>"u"||!e.usingWebAudio))return n.state==="running"&&n.ctx.state!=="interrupted"&&n._suspendTimer?(clearTimeout(n._suspendTimer),n._suspendTimer=null):n.state==="suspended"||n.state==="running"&&n.ctx.state==="interrupted"?(n.ctx.resume().then(function(){n.state="running";for(var o=0;o<n._howls.length;o++)n._howls[o]._emit("resume")}),n._suspendTimer&&(clearTimeout(n._suspendTimer),n._suspendTimer=null)):n.state==="suspending"&&(n._resumeAfterSuspend=!0),n}};var e=new t,i=function(n){var o=this;if(!n.src||n.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}o.init(n)};i.prototype={init:function(n){var o=this;return e.ctx||h(),o._autoplay=n.autoplay||!1,o._format=typeof n.format!="string"?n.format:[n.format],o._html5=n.html5||!1,o._muted=n.mute||!1,o._loop=n.loop||!1,o._pool=n.pool||5,o._preload=typeof n.preload=="boolean"||n.preload==="metadata"?n.preload:!0,o._rate=n.rate||1,o._sprite=n.sprite||{},o._src=typeof n.src!="string"?n.src:[n.src],o._volume=n.volume!==void 0?n.volume:1,o._xhr={method:n.xhr&&n.xhr.method?n.xhr.method:"GET",headers:n.xhr&&n.xhr.headers?n.xhr.headers:null,withCredentials:n.xhr&&n.xhr.withCredentials?n.xhr.withCredentials:!1},o._duration=0,o._state="unloaded",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=n.onend?[{fn:n.onend}]:[],o._onfade=n.onfade?[{fn:n.onfade}]:[],o._onload=n.onload?[{fn:n.onload}]:[],o._onloaderror=n.onloaderror?[{fn:n.onloaderror}]:[],o._onplayerror=n.onplayerror?[{fn:n.onplayerror}]:[],o._onpause=n.onpause?[{fn:n.onpause}]:[],o._onplay=n.onplay?[{fn:n.onplay}]:[],o._onstop=n.onstop?[{fn:n.onstop}]:[],o._onmute=n.onmute?[{fn:n.onmute}]:[],o._onvolume=n.onvolume?[{fn:n.onvolume}]:[],o._onrate=n.onrate?[{fn:n.onrate}]:[],o._onseek=n.onseek?[{fn:n.onseek}]:[],o._onunlock=n.onunlock?[{fn:n.onunlock}]:[],o._onresume=[],o._webAudio=e.usingWebAudio&&!o._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(o),o._autoplay&&o._queue.push({event:"play",action:function(){o.play()}}),o._preload&&o._preload!=="none"&&o.load(),o},load:function(){var n=this,o=null;if(e.noAudio){n._emit("loaderror",null,"No audio support.");return}typeof n._src=="string"&&(n._src=[n._src]);for(var l=0;l<n._src.length;l++){var d,y;if(n._format&&n._format[l])d=n._format[l];else{if(y=n._src[l],typeof y!="string"){n._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}d=/^data:audio\/([^;,]+);/i.exec(y),d||(d=/\.([^.]+)$/.exec(y.split("?",1)[0])),d&&(d=d[1].toLowerCase())}if(d||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),d&&e.codecs(d)){o=n._src[l];break}}if(!o){n._emit("loaderror",null,"No codec support for selected audio sources.");return}return n._src=o,n._state="loading",window.location.protocol==="https:"&&o.slice(0,5)==="http:"&&(n._html5=!0,n._webAudio=!1),new r(n),n._webAudio&&c(n),n},play:function(n,o){var l=this,d=null;if(typeof n=="number")d=n,n=null;else{if(typeof n=="string"&&l._state==="loaded"&&!l._sprite[n])return null;if(typeof n>"u"&&(n="__default",!l._playLock)){for(var y=0,b=0;b<l._sounds.length;b++)l._sounds[b]._paused&&!l._sounds[b]._ended&&(y++,d=l._sounds[b]._id);y===1?n=null:d=null}}var g=d?l._soundById(d):l._inactiveSound();if(!g)return null;if(d&&!n&&(n=g._sprite||"__default"),l._state!=="loaded"){g._sprite=n,g._ended=!1;var w=g._id;return l._queue.push({event:"play",action:function(){l.play(w)}}),w}if(d&&!g._paused)return o||l._loadQueue("play"),g._id;l._webAudio&&e._autoResume();var S=Math.max(0,g._seek>0?g._seek:l._sprite[n][0]/1e3),M=Math.max(0,(l._sprite[n][0]+l._sprite[n][1])/1e3-S),q=M*1e3/Math.abs(g._rate),oe=l._sprite[n][0]/1e3,ke=(l._sprite[n][0]+l._sprite[n][1])/1e3;g._sprite=n,g._ended=!1;var Fe=function(){g._paused=!1,g._seek=S,g._start=oe,g._stop=ke,g._loop=!!(g._loop||l._sprite[n][2])};if(S>=ke){l._ended(g);return}var D=g._node;if(l._webAudio){var J=function(){l._playLock=!1,Fe(),l._refreshBuffer(g);var Te=g._muted||l._muted?0:g._volume;D.gain.setValueAtTime(Te,e.ctx.currentTime),g._playStart=e.ctx.currentTime,typeof D.bufferSource.start>"u"?g._loop?D.bufferSource.noteGrainOn(0,S,86400):D.bufferSource.noteGrainOn(0,S,M):g._loop?D.bufferSource.start(0,S,86400):D.bufferSource.start(0,S,M),q!==1/0&&(l._endTimers[g._id]=setTimeout(l._ended.bind(l,g),q)),o||setTimeout(function(){l._emit("play",g._id),l._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?J():(l._playLock=!0,l.once("resume",J),l._clearTimer(g._id))}else{var ut=function(){D.currentTime=S,D.muted=g._muted||l._muted||e._muted||D.muted,D.volume=g._volume*e.volume(),D.playbackRate=g._rate;try{var Te=D.play();if(Te&&typeof Promise<"u"&&(Te instanceof Promise||typeof Te.then=="function")?(l._playLock=!0,Fe(),Te.then(function(){l._playLock=!1,D._unlocked=!0,o?l._loadQueue():l._emit("play",g._id)}).catch(function(){l._playLock=!1,l._emit("playerror",g._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),g._ended=!0,g._paused=!0})):o||(l._playLock=!1,Fe(),l._emit("play",g._id)),D.playbackRate=g._rate,D.paused){l._emit("playerror",g._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}n!=="__default"||g._loop?l._endTimers[g._id]=setTimeout(l._ended.bind(l,g),q):(l._endTimers[g._id]=function(){l._ended(g),D.removeEventListener("ended",l._endTimers[g._id],!1)},D.addEventListener("ended",l._endTimers[g._id],!1))}catch(Xt){l._emit("playerror",g._id,Xt)}};D.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(D.src=l._src,D.load());var Jt=window&&window.ejecta||!D.readyState&&e._navigator.isCocoonJS;if(D.readyState>=3||Jt)ut();else{l._playLock=!0,l._state="loading";var Bt=function(){l._state="loaded",ut(),D.removeEventListener(e._canPlayEvent,Bt,!1)};D.addEventListener(e._canPlayEvent,Bt,!1),l._clearTimer(g._id)}}return g._id},pause:function(n){var o=this;if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"pause",action:function(){o.pause(n)}}),o;for(var l=o._getSoundIds(n),d=0;d<l.length;d++){o._clearTimer(l[d]);var y=o._soundById(l[d]);if(y&&!y._paused&&(y._seek=o.seek(l[d]),y._rateSeek=0,y._paused=!0,o._stopFade(l[d]),y._node))if(o._webAudio){if(!y._node.bufferSource)continue;typeof y._node.bufferSource.stop>"u"?y._node.bufferSource.noteOff(0):y._node.bufferSource.stop(0),o._cleanBuffer(y._node)}else(!isNaN(y._node.duration)||y._node.duration===1/0)&&y._node.pause();arguments[1]||o._emit("pause",y?y._id:null)}return o},stop:function(n,o){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"stop",action:function(){l.stop(n)}}),l;for(var d=l._getSoundIds(n),y=0;y<d.length;y++){l._clearTimer(d[y]);var b=l._soundById(d[y]);b&&(b._seek=b._start||0,b._rateSeek=0,b._paused=!0,b._ended=!0,l._stopFade(d[y]),b._node&&(l._webAudio?b._node.bufferSource&&(typeof b._node.bufferSource.stop>"u"?b._node.bufferSource.noteOff(0):b._node.bufferSource.stop(0),l._cleanBuffer(b._node)):(!isNaN(b._node.duration)||b._node.duration===1/0)&&(b._node.currentTime=b._start||0,b._node.pause(),b._node.duration===1/0&&l._clearSound(b._node))),o||l._emit("stop",b._id))}return l},mute:function(n,o){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"mute",action:function(){l.mute(n,o)}}),l;if(typeof o>"u")if(typeof n=="boolean")l._muted=n;else return l._muted;for(var d=l._getSoundIds(o),y=0;y<d.length;y++){var b=l._soundById(d[y]);b&&(b._muted=n,b._interval&&l._stopFade(b._id),l._webAudio&&b._node?b._node.gain.setValueAtTime(n?0:b._volume,e.ctx.currentTime):b._node&&(b._node.muted=e._muted?!0:n),l._emit("mute",b._id))}return l},volume:function(){var n=this,o=arguments,l,d;if(o.length===0)return n._volume;if(o.length===1||o.length===2&&typeof o[1]>"u"){var y=n._getSoundIds(),b=y.indexOf(o[0]);b>=0?d=parseInt(o[0],10):l=parseFloat(o[0])}else o.length>=2&&(l=parseFloat(o[0]),d=parseInt(o[1],10));var g;if(typeof l<"u"&&l>=0&&l<=1){if(n._state!=="loaded"||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,o)}}),n;typeof d>"u"&&(n._volume=l),d=n._getSoundIds(d);for(var w=0;w<d.length;w++)g=n._soundById(d[w]),g&&(g._volume=l,o[2]||n._stopFade(d[w]),n._webAudio&&g._node&&!g._muted?g._node.gain.setValueAtTime(l,e.ctx.currentTime):g._node&&!g._muted&&(g._node.volume=l*e.volume()),n._emit("volume",g._id))}else return g=d?n._soundById(d):n._sounds[0],g?g._volume:0;return n},fade:function(n,o,l,d){var y=this;if(y._state!=="loaded"||y._playLock)return y._queue.push({event:"fade",action:function(){y.fade(n,o,l,d)}}),y;n=Math.min(Math.max(0,parseFloat(n)),1),o=Math.min(Math.max(0,parseFloat(o)),1),l=parseFloat(l),y.volume(n,d);for(var b=y._getSoundIds(d),g=0;g<b.length;g++){var w=y._soundById(b[g]);if(w){if(d||y._stopFade(b[g]),y._webAudio&&!w._muted){var S=e.ctx.currentTime,M=S+l/1e3;w._volume=n,w._node.gain.setValueAtTime(n,S),w._node.gain.linearRampToValueAtTime(o,M)}y._startFadeInterval(w,n,o,l,b[g],typeof d>"u")}}return y},_startFadeInterval:function(n,o,l,d,y,b){var g=this,w=o,S=l-o,M=Math.abs(S/.01),q=Math.max(4,M>0?d/M:d),oe=Date.now();n._fadeTo=l,n._interval=setInterval(function(){var ke=(Date.now()-oe)/d;oe=Date.now(),w+=S*ke,w=Math.round(w*100)/100,S<0?w=Math.max(l,w):w=Math.min(l,w),g._webAudio?n._volume=w:g.volume(w,n._id,!0),b&&(g._volume=w),(l<o&&w<=l||l>o&&w>=l)&&(clearInterval(n._interval),n._interval=null,n._fadeTo=null,g.volume(l,n._id),g._emit("fade",n._id))},q)},_stopFade:function(n){var o=this,l=o._soundById(n);return l&&l._interval&&(o._webAudio&&l._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(l._interval),l._interval=null,o.volume(l._fadeTo,n),l._fadeTo=null,o._emit("fade",n)),o},loop:function(){var n=this,o=arguments,l,d,y;if(o.length===0)return n._loop;if(o.length===1)if(typeof o[0]=="boolean")l=o[0],n._loop=l;else return y=n._soundById(parseInt(o[0],10)),y?y._loop:!1;else o.length===2&&(l=o[0],d=parseInt(o[1],10));for(var b=n._getSoundIds(d),g=0;g<b.length;g++)y=n._soundById(b[g]),y&&(y._loop=l,n._webAudio&&y._node&&y._node.bufferSource&&(y._node.bufferSource.loop=l,l&&(y._node.bufferSource.loopStart=y._start||0,y._node.bufferSource.loopEnd=y._stop,n.playing(b[g])&&(n.pause(b[g],!0),n.play(b[g],!0)))));return n},rate:function(){var n=this,o=arguments,l,d;if(o.length===0)d=n._sounds[0]._id;else if(o.length===1){var y=n._getSoundIds(),b=y.indexOf(o[0]);b>=0?d=parseInt(o[0],10):l=parseFloat(o[0])}else o.length===2&&(l=parseFloat(o[0]),d=parseInt(o[1],10));var g;if(typeof l=="number"){if(n._state!=="loaded"||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,o)}}),n;typeof d>"u"&&(n._rate=l),d=n._getSoundIds(d);for(var w=0;w<d.length;w++)if(g=n._soundById(d[w]),g){n.playing(d[w])&&(g._rateSeek=n.seek(d[w]),g._playStart=n._webAudio?e.ctx.currentTime:g._playStart),g._rate=l,n._webAudio&&g._node&&g._node.bufferSource?g._node.bufferSource.playbackRate.setValueAtTime(l,e.ctx.currentTime):g._node&&(g._node.playbackRate=l);var S=n.seek(d[w]),M=(n._sprite[g._sprite][0]+n._sprite[g._sprite][1])/1e3-S,q=M*1e3/Math.abs(g._rate);(n._endTimers[d[w]]||!g._paused)&&(n._clearTimer(d[w]),n._endTimers[d[w]]=setTimeout(n._ended.bind(n,g),q)),n._emit("rate",g._id)}}else return g=n._soundById(d),g?g._rate:n._rate;return n},seek:function(){var n=this,o=arguments,l,d;if(o.length===0)n._sounds.length&&(d=n._sounds[0]._id);else if(o.length===1){var y=n._getSoundIds(),b=y.indexOf(o[0]);b>=0?d=parseInt(o[0],10):n._sounds.length&&(d=n._sounds[0]._id,l=parseFloat(o[0]))}else o.length===2&&(l=parseFloat(o[0]),d=parseInt(o[1],10));if(typeof d>"u")return 0;if(typeof l=="number"&&(n._state!=="loaded"||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,o)}}),n;var g=n._soundById(d);if(g)if(typeof l=="number"&&l>=0){var w=n.playing(d);w&&n.pause(d,!0),g._seek=l,g._ended=!1,n._clearTimer(d),!n._webAudio&&g._node&&!isNaN(g._node.duration)&&(g._node.currentTime=l);var S=function(){w&&n.play(d,!0),n._emit("seek",d)};if(w&&!n._webAudio){var M=function(){n._playLock?setTimeout(M,0):S()};setTimeout(M,0)}else S()}else if(n._webAudio){var q=n.playing(d)?e.ctx.currentTime-g._playStart:0,oe=g._rateSeek?g._rateSeek-g._seek:0;return g._seek+(oe+q*Math.abs(g._rate))}else return g._node.currentTime;return n},playing:function(n){var o=this;if(typeof n=="number"){var l=o._soundById(n);return l?!l._paused:!1}for(var d=0;d<o._sounds.length;d++)if(!o._sounds[d]._paused)return!0;return!1},duration:function(n){var o=this,l=o._duration,d=o._soundById(n);return d&&(l=o._sprite[d._sprite][1]/1e3),l},state:function(){return this._state},unload:function(){for(var n=this,o=n._sounds,l=0;l<o.length;l++)o[l]._paused||n.stop(o[l]._id),n._webAudio||(n._clearSound(o[l]._node),o[l]._node.removeEventListener("error",o[l]._errorFn,!1),o[l]._node.removeEventListener(e._canPlayEvent,o[l]._loadFn,!1),o[l]._node.removeEventListener("ended",o[l]._endFn,!1),e._releaseHtml5Audio(o[l]._node)),delete o[l]._node,n._clearTimer(o[l]._id);var d=e._howls.indexOf(n);d>=0&&e._howls.splice(d,1);var y=!0;for(l=0;l<e._howls.length;l++)if(e._howls[l]._src===n._src||n._src.indexOf(e._howls[l]._src)>=0){y=!1;break}return s&&y&&delete s[n._src],e.noAudio=!1,n._state="unloaded",n._sounds=[],n=null,null},on:function(n,o,l,d){var y=this,b=y["_on"+n];return typeof o=="function"&&b.push(d?{id:l,fn:o,once:d}:{id:l,fn:o}),y},off:function(n,o,l){var d=this,y=d["_on"+n],b=0;if(typeof o=="number"&&(l=o,o=null),o||l)for(b=0;b<y.length;b++){var g=l===y[b].id;if(o===y[b].fn&&g||!o&&g){y.splice(b,1);break}}else if(n)d["_on"+n]=[];else{var w=Object.keys(d);for(b=0;b<w.length;b++)w[b].indexOf("_on")===0&&Array.isArray(d[w[b]])&&(d[w[b]]=[])}return d},once:function(n,o,l){var d=this;return d.on(n,o,l,1),d},_emit:function(n,o,l){for(var d=this,y=d["_on"+n],b=y.length-1;b>=0;b--)(!y[b].id||y[b].id===o||n==="load")&&(setTimeout(function(g){g.call(this,o,l)}.bind(d,y[b].fn),0),y[b].once&&d.off(n,y[b].fn,y[b].id));return d._loadQueue(n),d},_loadQueue:function(n){var o=this;if(o._queue.length>0){var l=o._queue[0];l.event===n&&(o._queue.shift(),o._loadQueue()),n||l.action()}return o},_ended:function(n){var o=this,l=n._sprite;if(!o._webAudio&&n._node&&!n._node.paused&&!n._node.ended&&n._node.currentTime<n._stop)return setTimeout(o._ended.bind(o,n),100),o;var d=!!(n._loop||o._sprite[l][2]);if(o._emit("end",n._id),!o._webAudio&&d&&o.stop(n._id,!0).play(n._id),o._webAudio&&d){o._emit("play",n._id),n._seek=n._start||0,n._rateSeek=0,n._playStart=e.ctx.currentTime;var y=(n._stop-n._start)*1e3/Math.abs(n._rate);o._endTimers[n._id]=setTimeout(o._ended.bind(o,n),y)}return o._webAudio&&!d&&(n._paused=!0,n._ended=!0,n._seek=n._start||0,n._rateSeek=0,o._clearTimer(n._id),o._cleanBuffer(n._node),e._autoSuspend()),!o._webAudio&&!d&&o.stop(n._id,!0),o},_clearTimer:function(n){var o=this;if(o._endTimers[n]){if(typeof o._endTimers[n]!="function")clearTimeout(o._endTimers[n]);else{var l=o._soundById(n);l&&l._node&&l._node.removeEventListener("ended",o._endTimers[n],!1)}delete o._endTimers[n]}return o},_soundById:function(n){for(var o=this,l=0;l<o._sounds.length;l++)if(n===o._sounds[l]._id)return o._sounds[l];return null},_inactiveSound:function(){var n=this;n._drain();for(var o=0;o<n._sounds.length;o++)if(n._sounds[o]._ended)return n._sounds[o].reset();return new r(n)},_drain:function(){var n=this,o=n._pool,l=0,d=0;if(!(n._sounds.length<o)){for(d=0;d<n._sounds.length;d++)n._sounds[d]._ended&&l++;for(d=n._sounds.length-1;d>=0;d--){if(l<=o)return;n._sounds[d]._ended&&(n._webAudio&&n._sounds[d]._node&&n._sounds[d]._node.disconnect(0),n._sounds.splice(d,1),l--)}}},_getSoundIds:function(n){var o=this;if(typeof n>"u"){for(var l=[],d=0;d<o._sounds.length;d++)l.push(o._sounds[d]._id);return l}else return[n]},_refreshBuffer:function(n){var o=this;return n._node.bufferSource=e.ctx.createBufferSource(),n._node.bufferSource.buffer=s[o._src],n._panner?n._node.bufferSource.connect(n._panner):n._node.bufferSource.connect(n._node),n._node.bufferSource.loop=n._loop,n._loop&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop||0),n._node.bufferSource.playbackRate.setValueAtTime(n._rate,e.ctx.currentTime),o},_cleanBuffer:function(n){var o=this,l=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&n.bufferSource&&(n.bufferSource.onended=null,n.bufferSource.disconnect(0),l))try{n.bufferSource.buffer=e._scratchBuffer}catch{}return n.bufferSource=null,o},_clearSound:function(n){var o=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);o||(n.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(n){this._parent=n,this.init()};r.prototype={init:function(){var n=this,o=n._parent;return n._muted=o._muted,n._loop=o._loop,n._volume=o._volume,n._rate=o._rate,n._seek=0,n._paused=!0,n._ended=!0,n._sprite="__default",n._id=++e._counter,o._sounds.push(n),n.create(),n},create:function(){var n=this,o=n._parent,l=e._muted||n._muted||n._parent._muted?0:n._volume;return o._webAudio?(n._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),n._node.gain.setValueAtTime(l,e.ctx.currentTime),n._node.paused=!0,n._node.connect(e.masterGain)):e.noAudio||(n._node=e._obtainHtml5Audio(),n._errorFn=n._errorListener.bind(n),n._node.addEventListener("error",n._errorFn,!1),n._loadFn=n._loadListener.bind(n),n._node.addEventListener(e._canPlayEvent,n._loadFn,!1),n._endFn=n._endListener.bind(n),n._node.addEventListener("ended",n._endFn,!1),n._node.src=o._src,n._node.preload=o._preload===!0?"auto":o._preload,n._node.volume=l*e.volume(),n._node.load()),n},reset:function(){var n=this,o=n._parent;return n._muted=o._muted,n._loop=o._loop,n._volume=o._volume,n._rate=o._rate,n._seek=0,n._rateSeek=0,n._paused=!0,n._ended=!0,n._sprite="__default",n._id=++e._counter,n},_errorListener:function(){var n=this;n._parent._emit("loaderror",n._id,n._node.error?n._node.error.code:0),n._node.removeEventListener("error",n._errorFn,!1)},_loadListener:function(){var n=this,o=n._parent;o._duration=Math.ceil(n._node.duration*10)/10,Object.keys(o._sprite).length===0&&(o._sprite={__default:[0,o._duration*1e3]}),o._state!=="loaded"&&(o._state="loaded",o._emit("load"),o._loadQueue()),n._node.removeEventListener(e._canPlayEvent,n._loadFn,!1)},_endListener:function(){var n=this,o=n._parent;o._duration===1/0&&(o._duration=Math.ceil(n._node.duration*10)/10,o._sprite.__default[1]===1/0&&(o._sprite.__default[1]=o._duration*1e3),o._ended(n)),n._node.removeEventListener("ended",n._endFn,!1)}};var s={},c=function(n){var o=n._src;if(s[o]){n._duration=s[o].duration,m(n);return}if(/^data:[^;]+;base64,/.test(o)){for(var l=atob(o.split(",")[1]),d=new Uint8Array(l.length),y=0;y<l.length;++y)d[y]=l.charCodeAt(y);f(d.buffer,n)}else{var b=new XMLHttpRequest;b.open(n._xhr.method,o,!0),b.withCredentials=n._xhr.withCredentials,b.responseType="arraybuffer",n._xhr.headers&&Object.keys(n._xhr.headers).forEach(function(g){b.setRequestHeader(g,n._xhr.headers[g])}),b.onload=function(){var g=(b.status+"")[0];if(g!=="0"&&g!=="2"&&g!=="3"){n._emit("loaderror",null,"Failed loading audio file with status: "+b.status+".");return}f(b.response,n)},b.onerror=function(){n._webAudio&&(n._html5=!0,n._webAudio=!1,n._sounds=[],delete s[o],n.load())},u(b)}},u=function(n){try{n.send()}catch{n.onerror()}},f=function(n,o){var l=function(){o._emit("loaderror",null,"Decoding audio data failed.")},d=function(y){y&&o._sounds.length>0?(s[o._src]=y,m(o,y)):l()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(n).then(d).catch(l):e.ctx.decodeAudioData(n,d,l)},m=function(n,o){o&&!n._duration&&(n._duration=o.duration),Object.keys(n._sprite).length===0&&(n._sprite={__default:[0,n._duration*1e3]}),n._state!=="loaded"&&(n._state="loaded",n._emit("load"),n._loadQueue())},h=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var n=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),o=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),l=o?parseInt(o[1],10):null;if(n&&l&&l<9){var d=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!d&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};a.Howler=e,a.Howl=i,typeof Re<"u"?(Re.HowlerGlobal=t,Re.Howler=e,Re.Howl=i,Re.Sound=r):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=i,window.Sound=r)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var r=i._howls.length-1;r>=0;r--)i._howls[r].stereo(e);return i},HowlerGlobal.prototype.pos=function(e,i,r){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(i=typeof i!="number"?s._pos[1]:i,r=typeof r!="number"?s._pos[2]:r,typeof e=="number")s._pos=[e,i,r],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(e,i,r,s,c,u){var f=this;if(!f.ctx||!f.ctx.listener)return f;var m=f._orientation;if(i=typeof i!="number"?m[1]:i,r=typeof r!="number"?m[2]:r,s=typeof s!="number"?m[3]:s,c=typeof c!="number"?m[4]:c,u=typeof u!="number"?m[5]:u,typeof e=="number")f._orientation=[e,i,r,s,c,u],typeof f.ctx.listener.forwardX<"u"?(f.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),f.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),f.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),f.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),f.ctx.listener.upY.setTargetAtTime(c,Howler.ctx.currentTime,.1),f.ctx.listener.upZ.setTargetAtTime(u,Howler.ctx.currentTime,.1)):f.ctx.listener.setOrientation(e,i,r,s,c,u);else return m;return f},Howl.prototype.init=function(e){return function(i){var r=this;return r._orientation=i.orientation||[1,0,0],r._stereo=i.stereo||null,r._pos=i.pos||null,r._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},r._onstereo=i.onstereo?[{fn:i.onstereo}]:[],r._onpos=i.onpos?[{fn:i.onpos}]:[],r._onorientation=i.onorientation?[{fn:i.onorientation}]:[],e.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,i){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"stereo",action:function(){r.stereo(e,i)}}),r;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof e=="number")r._stereo=e,r._pos=[e,0,0];else return r._stereo;for(var c=r._getSoundIds(i),u=0;u<c.length;u++){var f=r._soundById(c[u]);if(f)if(typeof e=="number")f._stereo=e,f._pos=[e,0,0],f._node&&(f._pannerAttr.panningModel="equalpower",(!f._panner||!f._panner.pan)&&t(f,s),s==="spatial"?typeof f._panner.positionX<"u"?(f._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):f._panner.setPosition(e,0,0):f._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",f._id);else return f._stereo}return r},Howl.prototype.pos=function(e,i,r,s){var c=this;if(!c._webAudio)return c;if(c._state!=="loaded")return c._queue.push({event:"pos",action:function(){c.pos(e,i,r,s)}}),c;if(i=typeof i!="number"?0:i,r=typeof r!="number"?-.5:r,typeof s>"u")if(typeof e=="number")c._pos=[e,i,r];else return c._pos;for(var u=c._getSoundIds(s),f=0;f<u.length;f++){var m=c._soundById(u[f]);if(m)if(typeof e=="number")m._pos=[e,i,r],m._node&&((!m._panner||m._panner.pan)&&t(m,"spatial"),typeof m._panner.positionX<"u"?(m._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),m._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),m._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):m._panner.setPosition(e,i,r)),c._emit("pos",m._id);else return m._pos}return c},Howl.prototype.orientation=function(e,i,r,s){var c=this;if(!c._webAudio)return c;if(c._state!=="loaded")return c._queue.push({event:"orientation",action:function(){c.orientation(e,i,r,s)}}),c;if(i=typeof i!="number"?c._orientation[1]:i,r=typeof r!="number"?c._orientation[2]:r,typeof s>"u")if(typeof e=="number")c._orientation=[e,i,r];else return c._orientation;for(var u=c._getSoundIds(s),f=0;f<u.length;f++){var m=c._soundById(u[f]);if(m)if(typeof e=="number")m._orientation=[e,i,r],m._node&&(m._panner||(m._pos||(m._pos=c._pos||[0,0,-.5]),t(m,"spatial")),typeof m._panner.orientationX<"u"?(m._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),m._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),m._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):m._panner.setOrientation(e,i,r)),c._emit("orientation",m._id);else return m._orientation}return c},Howl.prototype.pannerAttr=function(){var e=this,i=arguments,r,s,c;if(!e._webAudio)return e;if(i.length===0)return e._pannerAttr;if(i.length===1)if(typeof i[0]=="object")r=i[0],typeof s>"u"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),e._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle<"u"?r.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle<"u"?r.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain<"u"?r.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel<"u"?r.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance<"u"?r.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof r.pannerAttr.refDistance<"u"?r.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor<"u"?r.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel<"u"?r.pannerAttr.panningModel:e._panningModel});else return c=e._soundById(parseInt(i[0],10)),c?c._pannerAttr:e._pannerAttr;else i.length===2&&(r=i[0],s=parseInt(i[1],10));for(var u=e._getSoundIds(s),f=0;f<u.length;f++)if(c=e._soundById(u[f]),c){var m=c._pannerAttr;m={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:m.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:m.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:m.coneOuterGain,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:m.distanceModel,maxDistance:typeof r.maxDistance<"u"?r.maxDistance:m.maxDistance,refDistance:typeof r.refDistance<"u"?r.refDistance:m.refDistance,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:m.rolloffFactor,panningModel:typeof r.panningModel<"u"?r.panningModel:m.panningModel};var h=c._panner;h?(h.coneInnerAngle=m.coneInnerAngle,h.coneOuterAngle=m.coneOuterAngle,h.coneOuterGain=m.coneOuterGain,h.distanceModel=m.distanceModel,h.maxDistance=m.maxDistance,h.refDistance=m.refDistance,h.rolloffFactor=m.rolloffFactor,h.panningModel=m.panningModel):(c._pos||(c._pos=e._pos||[0,0,-.5]),t(c,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var i=this,r=i._parent;i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,e.call(this),i._stereo?r.stereo(i._stereo):i._pos&&r.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var i=this,r=i._parent;return i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,i._stereo?r.stereo(i._stereo):i._pos?r.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,r._refreshBuffer(i)),e.call(this)}}(Sound.prototype.reset);var t=function(e,i){i=i||"spatial",i==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(jt);var Ue;class Ke{constructor(t){G(this,Ue,void 0);O(this,Ue,t)}get id(){return I(this,Ue)}}Ue=new WeakMap;var je,Et;let se=(Et=class extends Ke{constructor(e){super(e);G(this,je,void 0);O(this,je,new Set)}static get classId(){return"RondelSlot"}get residingNations(){return I(this,je)}},je=new WeakMap,Et);class Ee extends se{static get classId(){return"factory"}constructor(){super(Ee.classId)}}const ft="production1",mt="maneuver1",pt="investor",yt="import",gt="production2",vt="maneuver2",bt="taxation";var te,le,Gt;let Zt=(Gt=class{constructor(){G(this,te,void 0);G(this,le,void 0);O(this,te,new Map),I(this,te).set(Ee.classId,new Ee),I(this,te).set(ft,new se(ft)),I(this,te).set(mt,new se(mt)),I(this,te).set(pt,new se(pt)),I(this,te).set(yt,new se(yt)),I(this,te).set(gt,new se(gt)),I(this,te).set(vt,new se(vt)),I(this,te).set(bt,new se(bt)),O(this,le,[this.factorySlot,this.production1Slot,this.maneuver1Slot,this.investorSlot,this.importSlot,this.production2Slot,this.maneuver2Slot,this.taxationSlot])}*allSlots(){for(const t of I(this,le))yield t}get factorySlot(){return this.idToEntity(Ee.classId)}get production1Slot(){return this.idToEntity(ft)}get maneuver1Slot(){return this.idToEntity(mt)}get investorSlot(){return this.idToEntity(pt)}get importSlot(){return this.idToEntity(yt)}get production2Slot(){return this.idToEntity(gt)}get maneuver2Slot(){return this.idToEntity(vt)}get taxationSlot(){return this.idToEntity(bt)}idToEntity(t){return I(this,te).get(t)}slotClockwiseTo(t,e){let i=I(this,le).indexOf(t);return i+=e,i%=I(this,le).length,I(this,le)[i]}passedInvestor(t,e){for(;t!==e&&(t=this.slotClockwiseTo(t,1),t!==e);)if(t===this.investorSlot)return!0;return!1}},te=new WeakMap,le=new WeakMap,Gt);var He,at,it,rt,ye,ae,Le;class kt extends Ke{constructor(e,i,r){super(e);G(this,He,void 0);G(this,at,3);G(this,it,3);G(this,rt,5);G(this,ye,void 0);G(this,ae,void 0);G(this,Le,void 0);O(this,He,new Zt),O(this,ye,i),O(this,ae,r),this.currentNation=this.firstNation,O(this,Le,new Set)}static get classId(){return"AbstractImperialGame"}get rondel(){return I(this,He)}get availableFreeRondelSlotCount(){return I(this,at)}get availablePaidRondelSlotCount(){return I(this,it)}get factoryBuildCosts(){return I(this,rt)}nationIdToEntity(e){return I(this,ye).get(e)}*allNations(){for(const e of I(this,ye).values())yield e}get nationCount(){return I(this,ye).size}get firstNation(){return I(this,ae)[0]}get lastNation(){return I(this,ae)[I(this,ae).length-1]}nationTurnAfter(e){let i=I(this,ae).indexOf(e);return i+=1,i%=I(this,ae).length,I(this,ae)[i]}get swissBankers(){return I(this,Le)}}He=new WeakMap,at=new WeakMap,it=new WeakMap,rt=new WeakMap,ye=new WeakMap,ae=new WeakMap,Le=new WeakMap;var re,ge,De,Ve,ze;let tt=(re=class extends Ke{constructor(e,i,r){super(e.id);G(this,De,void 0);G(this,Ve,void 0);G(this,ze,void 0);O(this,De,e),O(this,Ve,i),O(this,ze,r),this.bearer=null}static*allInterestValues(){for(let e=1;e<=9;e+=1)yield e}static bondCostByInterestValue(e){return I(re,ge).get(e)}get nation(){return I(this,De)}get interest(){return I(this,Ve)}get cost(){return I(this,ze)}},ge=new WeakMap,De=new WeakMap,Ve=new WeakMap,ze=new WeakMap,G(re,ge,void 0),(()=>{O(re,ge,new Map);let e=2;const i=[4,6,8];for(const r of re.allInterestValues()){const s=r<=1?0:I(re,ge).get(r-1);i.includes(r)&&(e+=1),I(re,ge).set(r,s+e)}})(),re);var ce,Pe,Mt;let Y=(Mt=class extends Ke{constructor(e){super(e);G(this,ce,void 0);G(this,Pe,void 0);this.residingRondelSlot=null,this.powerPoints=0,this.treasury=0,this.governor=null,O(this,ce,new Map),O(this,Pe,new Map);for(const i of tt.allInterestValues()){const r=new tt(this,i,tt.bondCostByInterestValue(i));I(this,ce).set(r.interest,r),I(this,Pe).set(r.cost,r)}this.unsoldBondsByInterestValue=new Map(I(this,ce))}*allBonds(){for(const e of I(this,ce).values())yield e}bondByInterestValue(e){return I(this,ce).get(e)}bondByCost(e){return I(this,Pe).get(e)}*allSoldBonds(){for(const e of tt.allInterestValues())this.unsoldBondsByInterestValue.has(e)===!1&&(yield this.bondByInterestValue(e))}},ce=new WeakMap,Pe=new WeakMap,Mt);const Qt=Object.freeze(Object.create(null));class et{constructor(t,e,i){Object.defineProperties(this,{value:{value:t,enumerable:!0},members:{value:e,enumerable:!1},label:{value:i,enumerable:!0}}),Object.freeze(this)}when(t){for(const e of this.members)if(!Object.prototype.hasOwnProperty.call(t,e))throw new Error(`unhandled case ${e}`);for(const e of Object.getOwnPropertyNames(t))if(Object.is(this.value,e))return t[e](this);throw new Error("unreachable")}get[Symbol.toStringTag](){return`${this.label}.${this.value}`}static fromArray(t,e){const i=new Map,r=new Set(t);return e===void 0&&(e="<anonymous>"),t.forEach(s=>{i.set(s,new et(s,r,e))}),new Proxy(Qt,{get(s,c,u){if(i.has(c))return i.get(c);if(c===Symbol.iterator)return i.values.bind(i);if(c==="toString")return()=>`${e}(${Array.from(r).join("|")})`;if(typeof c=="symbol")return Reflect.get(Object,c,u);throw new Error(`"${String(c)}" not found in ${e}`)},set(){throw new Error(`Enum ${e} cannot be mutated`)}})}}const wt=Symbol("NO_VALUE"),$t=Symbol("SET_START"),Kt=Symbol("ARY_START"),en=Symbol("MAP_START"),tn=Symbol("OBJ_START"),nt=Symbol("ITER_END");class Tt{constructor(t){this.value=t,this.children=new Map}getOrInsert(t,e,i){if(t.length===0)return this.value===wt&&(this.value=e(...i)),this.value;const[r,...s]=t;if(r instanceof Array)return this.getOrInsert([Kt,...r,nt,...s],e,i);if(r instanceof Set){const c=[...r];return c.sort(),this.getOrInsert([$t,...c,nt,...s],e,i)}if(r instanceof Map){const c=[...r.entries()].sort();return this.getOrInsert([en,...c,nt,...s],e,i)}if(r instanceof Object){const c=Object.entries(r).sort();return this.getOrInsert([tn,...c,nt,...s],e,i)}return this.children.has(r)||this.children.set(r,new Tt(wt)),this.children.get(r).getOrInsert(s,e,i)}}const Ht=a=>{const t=new Tt(wt);return(...e)=>t.getOrInsert(e,a,e)},k=et.fromArray(["AH","IT","FR","GB","GE","RU"],"Nation"),N=et.fromArray(["RU","CN","IN","BR","US","EU"],"Nation2030"),v=et.fromArray(["CN","JP","FR","GB","TR","RU","GE"],"NationAsia"),dt={1:2,2:4,3:6,4:9,5:12,6:16,7:20,8:25,9:30},Z=Ht((a,t)=>({nation:a,number:t,cost:dt[t]})),Lt=()=>new Set(["AH","IT","FR","GB","GE","RU"].map(a=>Object.keys(dt).map(t=>Z(k[a],parseInt(t,10)))).flat()),Dt=()=>new Set(["RU","CN","IN","BR","US","EU"].map(a=>Object.keys(dt).map(t=>Z(N[a],parseInt(t,10)))).flat()),Vt=()=>new Set(["CN","JP","FR","GB","TR","RU","GE"].map(a=>Object.keys(dt).map(t=>Z(v[a],parseInt(t,10)))).flat());class L extends kt{static get classId(){return"imperial2030"}static get RussiaId(){return N.RU}static get ChinaId(){return N.CN}static get IndiaId(){return N.IN}static get BrazilId(){return N.BR}static get UnitedStatesId(){return N.US}static get EuropeanUnionId(){return N.EU}constructor(t){const e=new Map;e.set(L.RussiaId,new Y(L.RussiaId)),e.set(L.ChinaId,new Y(L.ChinaId)),e.set(L.IndiaId,new Y(L.IndiaId)),e.set(L.BrazilId,new Y(L.BrazilId)),e.set(L.UnitedStatesId,new Y(L.UnitedStatesId)),e.set(L.EuropeanUnionId,new Y(L.EuropeanUnionId));const i=new Array(6);i[0]=e.get(L.RussiaId),i[1]=e.get(L.ChinaId),i[2]=e.get(L.IndiaId),i[3]=e.get(L.BrazilId),i[4]=e.get(L.UnitedStatesId),i[5]=e.get(L.EuropeanUnionId),super(t,e,i)}get Russia(){return this.nationIdToEntity(L.RussiaId)}get China(){return this.nationIdToEntity(L.ChinaId)}get India(){return this.nationIdToEntity(L.IndiaId)}get Brazil(){return this.nationIdToEntity(L.BrazilId)}get UnitedStates(){return this.nationIdToEntity(L.UnitedStatesId)}get EuropeanUnion(){return this.nationIdToEntity(L.EuropeanUnionId)}}class j extends kt{static get classId(){return"imperialAsia"}static get ChinaId(){return v.CN}static get JapanId(){return v.JP}static get FranceId(){return v.FR}static get GreatBritainId(){return v.GB}static get TurkeyId(){return v.TR}static get RussiaId(){return v.RU}static get GermanyId(){return v.GE}constructor(t){const e=new Map;e.set(j.ChinaId,new Y(j.ChinaId)),e.set(j.JapanId,new Y(j.JapanId)),e.set(j.FranceId,new Y(j.FranceId)),e.set(j.GreatBritainId,new Y(j.GreatBritainId)),e.set(j.TurkeyId,new Y(j.TurkeyId)),e.set(j.RussiaId,new Y(j.RussiaId)),e.set(j.GermanyId,new Y(j.GermanyId));const i=new Array(7);i[0]=e.get(j.ChinaId),i[1]=e.get(j.JapanId),i[2]=e.get(j.FranceId),i[3]=e.get(j.GreatBritainId),i[4]=e.get(j.TurkeyId),i[5]=e.get(j.RussiaId),i[6]=e.get(j.GermanyId),super(t,e,i)}get China(){return this.nationIdToEntity(j.ChinaId)}get Japan(){return this.nationIdToEntity(j.JapanId)}get France(){return this.nationIdToEntity(j.FranceId)}get GreatBritain(){return this.nationIdToEntity(j.GreatBritainId)}get Turkey(){return this.nationIdToEntity(j.TurkeyId)}get Russia(){return this.nationIdToEntity(j.RussiaId)}get Germany(){return this.nationIdToEntity(j.GermanyId)}}class H extends kt{static get classId(){return"imperial"}static get AustriaHungaryId(){return k.AH}static get ItalyId(){return k.IT}static get FranceId(){return k.FR}static get GreatBritainId(){return k.GB}static get GermanyId(){return k.GE}static get RussiaId(){return k.RU}constructor(t){const e=new Map;e.set(H.AustriaHungaryId,new Y(H.AustriaHungaryId)),e.set(H.ItalyId,new Y(H.ItalyId)),e.set(H.FranceId,new Y(H.FranceId)),e.set(H.GreatBritainId,new Y(H.GreatBritainId)),e.set(H.GermanyId,new Y(H.GermanyId)),e.set(H.RussiaId,new Y(H.RussiaId));const i=new Array(6);i[0]=e.get(H.AustriaHungaryId),i[1]=e.get(H.ItalyId),i[2]=e.get(H.FranceId),i[3]=e.get(H.GreatBritainId),i[4]=e.get(H.GermanyId),i[5]=e.get(H.RussiaId),super(t,e,i)}get AustriaHungary(){return this.nationIdToEntity(H.AustriaHungaryId)}get Italy(){return this.nationIdToEntity(H.ItalyId)}get France(){return this.nationIdToEntity(H.FranceId)}get GreatBritain(){return this.nationIdToEntity(H.GreatBritainId)}get Germany(){return this.nationIdToEntity(H.GermanyId)}get Russia(){return this.nationIdToEntity(H.RussiaId)}}let nn=class extends Ke{constructor(t,e){super(e),this.isLand=t,this.ownership=null,this.hasArmsFactory=!1,this.hasNavalFactory=!1,this.friendlyUnits=new Map,this.hostileUnits=new Map}get isOcean(){return this.isLand===!1}set isOcean(t){this.isLand=t===!1}get hasFactory(){return this.hasArmsFactory||this.hasNavalFactory}get isDevoidOfFactory(){return this.hasFactory===!1}get isOccupiedByHostiles(){return this.hostileUnits.size>0}get isNotOccupiedByHostiles(){return this.isOccupiedByHostiles===!1}};const an=(a,t,e,i)=>{const r=t.get(a),s=i.graph.get(a),c=new nn(!s.isOcean,a);c.ownership=s.nation,c.hasArmsFactory=r.factory==="armaments",c.hasNavalFactory=r.factory==="shipyard";for(const[u]of e){const{armies:f,fleets:m,friendly:h}=e.get(u).get(a);(f>0||m>0)&&(h?c.friendlyUnits:c.hostileUnits).set(u,f+m)}return c},rn=(a,t)=>{const e=new Set,i=new Set,r=new Set;for(const s of a)t.has(s)?i.add(s):e.add(s);for(const s of t)a.has(s)?i.add(s):r.add(s);return[e,i,r]},U=(a,t)=>{const e=new Set(t);return Ht(i=>{const[r,s,c]=rn(e,new Set(Object.keys(i||{})));if(r.size>0||c.size>0)throw new Error(JSON.stringify({expected:[...r],unexpected:[...c],ok:[...s],type:a}));return{type:a,payload:i}})},on=Object.freeze({type:"noop"}),C={noop:on,playerGainsCash:U("playerGainsCash",["player","amount"]),playerTradedInForABond:U("playerTradedInForABond",["player","bondNation","bondCost"]),playerAutoSkipsBondPurchase:U("playerAutoSkipsBondPurchase",["player","bondNation"]),playerPaysForRondel:U("playerPaysForRondel",["player","cost","slot"]),playerInvests:U("playerInvests",["player"]),nationGainsTreasury:U("nationGainsTreasury",["nation","amount"]),nationGainsPowerPoints:U("nationGainsPowerPoints",["nation","powerPoints"]),nationPaysPlayer:U("nationPaysPlayer",["player","nation","amount"]),investorCardHolderChanged:U("investorCardHolderChanged",["oldInvestorCardHolder","newInvestorCardHolder"]),nationControllerChanged:U("nationControllerChanged",["oldNationController","newNationController","nation"]),initialize:U("initialize",["players","soloMode","variant","baseGame"]),blockCanal:U("blockCanal",[]),bondPurchase:U("bondPurchase",["nation","player","cost","tradeInValue"]),buildFactory:U("buildFactory",["province","player","nationCosts","playerCosts"]),coexist:U("coexist",["province","incumbent","challenger"]),destroyFactory:U("destroyFactory",["province"]),endGame:U("endGame",[]),endManeuver:U("endManeuver",[]),fight:U("fight",["province","incumbent","challenger","targetType"]),forceInvestor:U("forceInvestor",["player"]),friendlyEntrance:U("friendlyEntrance",["incumbent","challenger","province"]),import:U("import",["placements"]),maneuver:U("maneuver",["origin","destination"]),production:U("production",["province"]),rondel:U("rondel",["nation","cost","slot"]),couldNotBuildFactory:U("couldNotBuildFactory",["nation"]),skipBuildFactory:U("skipBuildFactory",["player","nation"]),skipBondPurchase:U("skipBondPurchase",["player","nation"]),skipDestroyFactory:U("skipDestroyFactory",["province"]),skipForceInvestor:U("skipForceInvestor",["player"]),unblockCanal:U("unblockCanal",[]),undo:U("undo",["player"]),unfriendlyEntrance:U("unfriendlyEntrance",["incumbent","challenger","province"])};class sn extends Map{get(t){return this.has(t)||this.set(t,new Set),super.get(t)}}class At{constructor({nodes:t,edges:e}){this.graph=new Map,this.byNation=new sn,this.setupGraph(t),this.setImmediateNeighbors(e)}setupGraph(t){for(const{name:e,nation:i,isOcean:r,factoryType:s,egress:c}of t)this.graph.set(e,{nation:i,neighbors:new Set,isOcean:r,factoryType:s,egress:c}),this.byNation.has(i)||this.byNation.set(i,new Set),this.byNation.get(i).add(e)}setImmediateNeighbors(t){t.forEach(([e,i])=>{this.graph.get(e).neighbors.add(i),this.graph.get(i).neighbors.add(e)})}neighborsFor(t){const e=this.validatePaths(this.pathsFrom(t,[t.origin]),t.isFleet,t.origin);return[...new Set(e.map(i=>i[i.length-1]))]}pathsFrom({origin:t,nation:e,isFleet:i,friendlyFleets:r,occupiedHomeProvinces:s=[],hasMoved:c=!1},u,f=[]){this.validate(t);for(const m of this.graph.get(t).neighbors){if(u.includes(m))continue;const h=u.concat(m);!i&&!this.graph.get(m).isOcean&&!s.includes(m)&&this.graph.get(m).nation===e&&(u[u.length-1]===m?f.push(u):f.push(h),this.pathsFrom({origin:m,nation:e,isFleet:i,friendlyFleets:r,occupiedHomeProvinces:s,hasMoved:this.graph.get(t).nation===e?c:!0},h,f)),!i&&this.graph.get(m).isOcean&&r.has(m)&&!c?(f.push(h),this.pathsFrom({origin:m,nation:e,isFleet:i,friendlyFleets:r,occupiedHomeProvinces:s,hasMoved:!1},h,f)):(i&&this.graph.get(m).isOcean||!i&&!this.graph.get(m).isOcean&&this.graph.get(t).nation===e&&this.graph.get(m).nation!==e&&!c||!i&&!this.graph.get(m).isOcean&&this.graph.get(m).nation===e&&s.includes(m)&&!c||!i&&!this.graph.get(m).isOcean&&!c)&&f.push(h)}return f}validatePaths(t,e,i){let r=[];return r=t.filter(s=>!(!e&&this.graph.get(s[s.length-1]).isOcean)),r=r.filter(s=>s.length>1),r=r.filter(s=>{const c=s[s.length-1]!==this.graph.get(i).egress;return!(e&&this.graph.get(i).nation&&c)}),r}validate(t){if(!this.graph.has(t))throw new Error(`province ${t} not found. Available provinces are: ${[...this.graph.keys()]}`)}}const ln=[{isOcean:!0,name:"bayofbiscay"},{isOcean:!0,name:"blacksea"},{isOcean:!0,name:"westernmediterraneansea"},{isOcean:!0,name:"ioniansea"},{isOcean:!0,name:"easternmediterraneansea"},{isOcean:!0,name:"northsea"},{isOcean:!0,name:"northatlantic"},{isOcean:!0,name:"balticsea"},{isOcean:!0,name:"englishchannel"},{isOcean:!1,name:"turkey"},{isOcean:!1,name:"bulgaria"},{isOcean:!1,name:"romania"},{isOcean:!1,name:"westbalkan"},{isOcean:!1,name:"greece"},{isOcean:!1,name:"tunis"},{isOcean:!1,name:"algeria"},{isOcean:!1,name:"morocco"},{isOcean:!1,name:"spain"},{isOcean:!1,name:"portugal"},{isOcean:!1,name:"belgium"},{isOcean:!1,name:"holland"},{isOcean:!1,name:"denmark"},{isOcean:!1,name:"norway"},{isOcean:!1,name:"sweden"},{nation:k.RU,factoryType:"armaments",name:"moscow",isHome:!0},{nation:k.RU,factoryType:"armaments",name:"warsaw"},{nation:k.RU,factoryType:"shipyard",name:"stpetersburg",egress:"balticsea"},{nation:k.RU,factoryType:"armaments",name:"kiev"},{nation:k.RU,factoryType:"shipyard",name:"odessa",isHome:!0,egress:"blacksea"},{nation:k.GE,factoryType:"shipyard",name:"danzig",egress:"balticsea"},{nation:k.GE,factoryType:"armaments",name:"berlin",isHome:!0},{nation:k.GE,factoryType:"armaments",name:"munich"},{nation:k.GE,factoryType:"armaments",name:"cologne"},{nation:k.GE,factoryType:"shipyard",name:"hamburg",isHome:!0,egress:"northsea"},{nation:k.GB,factoryType:"shipyard",name:"dublin",egress:"northatlantic"},{nation:k.GB,factoryType:"shipyard",name:"edinburgh",egress:"northsea"},{nation:k.GB,factoryType:"shipyard",name:"liverpool",isHome:!0,egress:"northatlantic"},{nation:k.GB,factoryType:"armaments",name:"sheffield"},{nation:k.GB,factoryType:"shipyard",name:"london",isHome:!0,egress:"englishchannel"},{nation:k.FR,factoryType:"armaments",name:"paris",isHome:!0},{nation:k.FR,factoryType:"armaments",name:"dijon"},{nation:k.FR,factoryType:"shipyard",name:"marseille",egress:"westernmediterraneansea"},{nation:k.FR,factoryType:"shipyard",name:"bordeaux",isHome:!0,egress:"bayofbiscay"},{nation:k.FR,factoryType:"shipyard",name:"brest",egress:"englishchannel"},{nation:k.IT,factoryType:"shipyard",name:"genoa",egress:"westernmediterraneansea"},{nation:k.IT,factoryType:"shipyard",name:"venice",egress:"ioniansea"},{nation:k.IT,factoryType:"armaments",name:"florence"},{nation:k.IT,factoryType:"armaments",name:"rome",isHome:!0},{nation:k.IT,factoryType:"shipyard",name:"naples",isHome:!0,egress:"westernmediterraneansea"},{nation:k.AH,factoryType:"shipyard",name:"trieste",egress:"ioniansea"},{nation:k.AH,factoryType:"armaments",name:"vienna",isHome:!0},{nation:k.AH,factoryType:"armaments",name:"budapest",isHome:!0},{nation:k.AH,factoryType:"armaments",name:"prague"},{nation:k.AH,factoryType:"armaments",name:"lemberg"}],cn=[["moscow","kiev"],["moscow","warsaw"],["moscow","stpetersburg"],["warsaw","stpetersburg"],["warsaw","moscow"],["warsaw","kiev"],["warsaw","lemberg"],["warsaw","prague"],["warsaw","danzig"],["stpetersburg","moscow"],["stpetersburg","kiev"],["stpetersburg","warsaw"],["stpetersburg","danzig"],["stpetersburg","balticsea"],["kiev","moscow"],["kiev","odessa"],["kiev","romania"],["kiev","lemberg"],["kiev","warsaw"],["odessa","kiev"],["odessa","blacksea"],["odessa","romania"],["blacksea","odessa"],["blacksea","turkey"],["blacksea","easternmediterraneansea"],["blacksea","bulgaria"],["blacksea","romania"],["turkey","blacksea"],["turkey","easternmediterraneansea"],["turkey","bulgaria"],["easternmediterraneansea","turkey"],["easternmediterraneansea","ioniansea"],["easternmediterraneansea","greece"],["easternmediterraneansea","bulgaria"],["easternmediterraneansea","blacksea"],["bulgaria","romania"],["bulgaria","blacksea"],["bulgaria","turkey"],["bulgaria","easternmediterraneansea"],["bulgaria","greece"],["bulgaria","westbalkan"],["romania","lemberg"],["romania","kiev"],["romania","odessa"],["romania","blacksea"],["romania","bulgaria"],["romania","westbalkan"],["romania","budapest"],["westbalkan","budapest"],["westbalkan","romania"],["westbalkan","bulgaria"],["westbalkan","greece"],["westbalkan","ioniansea"],["westbalkan","trieste"],["greece","westbalkan"],["greece","bulgaria"],["greece","easternmediterraneansea"],["greece","ioniansea"],["ioniansea","trieste"],["ioniansea","westbalkan"],["ioniansea","greece"],["ioniansea","easternmediterraneansea"],["ioniansea","tunis"],["ioniansea","westernmediterraneansea"],["ioniansea","naples"],["lemberg","kiev"],["lemberg","romania"],["lemberg","budapest"],["lemberg","prague"],["lemberg","warsaw"],["budapest","lemberg"],["budapest","romania"],["budapest","westbalkan"],["budapest","trieste"],["budapest","vienna"],["budapest","prague"],["prague","danzig"],["prague","warsaw"],["prague","lemberg"],["prague","budapest"],["prague","vienna"],["prague","munich"],["prague","berlin"],["vienna","prague"],["vienna","budapest"],["vienna","trieste"],["vienna","venice"],["vienna","munich"],["trieste","vienna"],["trieste","budapest"],["trieste","westbalkan"],["trieste","ioniansea"],["trieste","venice"],["venice","vienna"],["venice","trieste"],["venice","ioniansea"],["venice","rome"],["venice","florence"],["venice","genoa"],["rome","venice"],["rome","ioniansea"],["rome","naples"],["rome","westernmediterraneansea"],["rome","florence"],["naples","rome"],["naples","ioniansea"],["naples","westernmediterraneansea"],["florence","genoa"],["florence","venice"],["florence","rome"],["florence","westernmediterraneansea"],["genoa","vienna"],["genoa","venice"],["genoa","florence"],["genoa","westernmediterraneansea"],["genoa","marseille"],["marseille","dijon"],["marseille","genoa"],["marseille","westernmediterraneansea"],["marseille","spain"],["marseille","bordeaux"],["bordeaux","brest"],["bordeaux","dijon"],["bordeaux","marseille"],["bordeaux","spain"],["bordeaux","bayofbiscay"],["brest","englishchannel"],["brest","paris"],["brest","dijon"],["brest","bordeaux"],["brest","bayofbiscay"],["paris","englishchannel"],["paris","belgium"],["paris","dijon"],["paris","brest"],["dijon","paris"],["dijon","belgium"],["dijon","munich"],["dijon","marseille"],["dijon","bordeaux"],["dijon","brest"],["tunis","westernmediterraneansea"],["tunis","algeria"],["algeria","westernmediterraneansea"],["algeria","tunis"],["algeria","morocco"],["morocco","bayofbiscay"],["morocco","algeria"],["westernmediterraneansea","marseille"],["westernmediterraneansea","genoa"],["westernmediterraneansea","florence"],["westernmediterraneansea","rome"],["westernmediterraneansea","naples"],["westernmediterraneansea","ioniansea"],["westernmediterraneansea","tunis"],["westernmediterraneansea","algeria"],["westernmediterraneansea","bayofbiscay"],["westernmediterraneansea","spain"],["spain","bayofbiscay"],["spain","bordeaux"],["spain","marseille"],["spain","westernmediterraneansea"],["spain","portugal"],["portugal","bayofbiscay"],["portugal","spain"],["bayofbiscay","northatlantic"],["bayofbiscay","englishchannel"],["bayofbiscay","brest"],["bayofbiscay","bordeaux"],["bayofbiscay","spain"],["bayofbiscay","portugal"],["bayofbiscay","morocco"],["northatlantic","dublin"],["northatlantic","edinburgh"],["northatlantic","northsea"],["northatlantic","liverpool"],["northatlantic","london"],["northatlantic","englishchannel"],["northatlantic","bayofbiscay"],["dublin","northatlantic"],["edinburgh","northatlantic"],["edinburgh","northsea"],["edinburgh","sheffield"],["edinburgh","liverpool"],["liverpool","edinburgh"],["liverpool","sheffield"],["liverpool","london"],["liverpool","northatlantic"],["sheffield","edinburgh"],["sheffield","northsea"],["sheffield","london"],["sheffield","liverpool"],["london","sheffield"],["london","northsea"],["london","englishchannel"],["london","northatlantic"],["london","liverpool"],["northsea","norway"],["northsea","balticsea"],["northsea","denmark"],["northsea","hamburg"],["northsea","holland"],["northsea","englishchannel"],["northsea","london"],["northsea","sheffield"],["northsea","edinburgh"],["northsea","northatlantic"],["englishchannel","northatlantic"],["englishchannel","london"],["englishchannel","holland"],["englishchannel","belgium"],["englishchannel","paris"],["englishchannel","brest"],["englishchannel","bayofbiscay"],["belgium","englishchannel"],["belgium","holland"],["belgium","cologne"],["belgium","munich"],["belgium","dijon"],["belgium","paris"],["holland","northsea"],["holland","hamburg"],["holland","cologne"],["holland","belgium"],["holland","englishchannel"],["cologne","belgium"],["cologne","holland"],["cologne","hamburg"],["cologne","berlin"],["cologne","munich"],["munich","cologne"],["munich","berlin"],["munich","prague"],["munich","vienna"],["munich","dijon"],["munich","belgium"],["berlin","balticsea"],["berlin","danzig"],["berlin","prague"],["berlin","munich"],["berlin","cologne"],["berlin","hamburg"],["hamburg","denmark"],["hamburg","balticsea"],["hamburg","berlin"],["hamburg","cologne"],["hamburg","holland"],["hamburg","northsea"],["danzig","balticsea"],["danzig","stpetersburg"],["danzig","warsaw"],["danzig","prague"],["danzig","berlin"],["norway","northsea"],["norway","balticsea"],["norway","sweden"],["sweden","norway"],["sweden","balticsea"],["balticsea","stpetersburg"],["balticsea","danzig"],["balticsea","berlin"],["balticsea","hamburg"],["balticsea","denmark"],["balticsea","northsea"],["balticsea","sweden"]],Nt=new At({nodes:ln,edges:cn});class ne{static fromLog(t,e,i){const r=new ne;return t.forEach(s=>r.tick(s,e,i)),r}tick(t,e,i){if(t.type==="initialize"){this.initialize(t,e,i);return}switch(e.previousPlayerName=e.currentPlayerName,t.type){case"bondPurchase":{this.bondPurchase(t,e);return}case"skipBondPurchase":{this.skipBondPurchase(t,e);break}}}initialize(t,e,i){const r=i({players:t.payload.players,provinceNames:Array.from(Nt.graph.keys())});this.inAuction=!0,this.order=r.order,this.firstPlayerIndex=0,t.payload.baseGame==="imperial"||!t.payload.baseGame?e.currentNation=k.AH:t.payload.baseGame==="imperial2030"?e.currentNation=N.RU:t.payload.baseGame==="imperialAsia"&&(e.currentNation=v.CN),e.availableActions=ne.availableBondPurchases({availableBonds:r.availableBonds,players:r.players,currentNation:e.currentNation,currentPlayerName:this.order[0],previousPlayerName:this.order[0]}),e.availableActions.add(C.skipBondPurchase({player:this.order[0],nation:e.currentNation}))}static availableBondPurchases(t){const e=new Set;return[...t.availableBonds].filter(r=>r.cost<=t.players[t.currentPlayerName].cash&&r.nation===t.currentNation).forEach(r=>{e.add(C.bondPurchase({nation:t.currentNation,player:t.currentPlayerName,cost:r.cost,tradeInValue:0}))}),e}bondPurchase(t,e){const i={2:1,4:2,6:3,9:4,12:5,16:6,20:7,25:8,30:9};e.nations.get(t.payload.nation).treasury+=t.payload.cost,e.players[t.payload.player].cash-=t.payload.cost;const r=Z(t.payload.nation,i[t.payload.cost]);if(!e.availableBonds.has(r))throw new Error(`${r} not available`);e.players[t.payload.player].bonds.add(r),e.availableBonds.delete(r),e.nations.get(t.payload.nation).controller===null&&(e.nations.get(t.payload.nation).controller=t.payload.player),ne.totalInvestmentInNation(t.payload.player,t.payload.nation,e)>ne.totalInvestmentInNation(e.nations.get(t.payload.nation).controller,t.payload.nation,e)&&(e.nations.get(t.payload.nation).controller=t.payload.player),this.setAvailableActions(t,e)}skipBondPurchase(t,e){this.setAvailableActions(t,e)}setAvailableActions(t,e){for(e.availableActions=new Set;e.availableActions.size<=2;){const i=this.order.indexOf(e.currentPlayerName);if(e.currentPlayerName=this.order[i+1]||this.order[0],e.availableActions.add(C.undo({player:e.previousPlayerName})),this.shouldAdvanceNation(e)&&(ne.advanceNation(e),this.resetCurrentPlayer(e),!e.currentNation)){this.prepareToStartGame(e);return}if(ne.availableBondPurchases(e).size===0)e.annotatedLog.push(C.playerAutoSkipsBondPurchase({player:e.currentPlayerName,bondNation:e.currentNation}));else{for(const s of ne.availableBondPurchases(e))e.availableActions.add(s);e.availableActions.add(C.skipBondPurchase({player:e.currentPlayerName,nation:e.currentNation}))}}}shouldAdvanceNation(t){return t.currentPlayerName===this.order[this.firstPlayerIndex||0]}static advanceNation(t){let e=[];t.baseGame==="imperial"||!t.baseGame?e=[k.AH,k.IT,k.FR,k.GB,k.GE,k.RU]:t.baseGame==="imperial2030"?e=[N.RU,N.CN,N.IN,N.BR,N.US,N.EU]:t.baseGame==="imperialAsia"&&(e=[v.CN,v.JP,v.FR,v.GB,v.TR,v.RU,v.GE]);const i=e.indexOf(t.currentNation);t.currentNation=e[i+1]}resetCurrentPlayer(t){this.firstPlayerIndex?this.firstPlayerIndex+=1:this.firstPlayerIndex=1,this.order[this.firstPlayerIndex]||(this.firstPlayerIndex=0),t.currentPlayerName=this.order[this.firstPlayerIndex]}prepareToStartGame(t){for(const s in t.players)t.checkForSwissBank(s);const[e,i]=ne.getStartingPlayerAndNation(t);t.currentPlayerName=e,t.currentNation=i;for(const s of t.availableRondelActions(i))t.availableActions.add(s);this.inAuction=!1;let r;t.baseGame==="imperial"||!t.baseGame?r=this.order.indexOf(t.nations.get(k.AH).controller):t.baseGame==="imperial2030"?r=this.order.indexOf(t.nations.get(N.RU).controller):t.baseGame==="imperialAsia"&&(r=this.order.indexOf(t.nations.get(v.CN).controller)),t.variant!=="withoutInvestorCard"&&(t.investorCardHolder=this.order[r+1]||this.order[0])}static totalInvestmentInNation(t,e,i){return i.players[t]?[...i.players[t].bonds].filter(r=>r.nation===e).reduce((r,s)=>r+s.cost,0):0}static getStartingPlayerAndNation(t){let e,i;return t.baseGame==="imperial"||!t.baseGame?(e=k.AH,i=t.nations.get(e).controller,i||(e=k.IT,i=t.nations.get(e).controller),i||(e=k.FR,i=t.nations.get(e).controller),i||(e=k.GB,i=t.nations.get(e).controller),i||(e=k.GE,i=t.nations.get(e).controller),i||(e=k.RU,i=t.nations.get(e).controller)):t.baseGame==="imperial2030"?(e=N.RU,i=t.nations.get(e).controller,i||(e=N.CN,i=t.nations.get(e).controller),i||(e=N.IN,i=t.nations.get(e).controller),i||(e=N.BR,i=t.nations.get(e).controller),i||(e=N.US,i=t.nations.get(e).controller),i||(e=N.EU,i=t.nations.get(e).controller)):t.baseGame==="imperialAsia"&&(e=v.CN,i=t.nations.get(e).controller,i||(e=v.JP,i=t.nations.get(e).controller),i||(e=v.FR,i=t.nations.get(e).controller),i||(e=v.GB,i=t.nations.get(e).controller),i||(e=v.TR,i=t.nations.get(e).controller),i||(e=v.RU,i=t.nations.get(e).controller),i||(e=v.GE,i=t.nations.get(e).controller)),[i,e]}}const dn=({players:a,provinceNames:t})=>{const e={availableBonds:Dt(),nations:new Map,order:a.map(h=>h.id),players:{}};let i;switch(a.length){case 6:i=13;break;case 5:i=15;break;case 4:i=19;break;case 3:i=25;break;case 2:default:i=37;break}a.forEach(({id:h})=>{e.players[h]={name:h,cash:i,bonds:new Set,rawScore:0}});for(const h of N)e.nations.set(h,{controller:null,treasury:0,rondelPosition:null,flagCount:0,powerPoints:0,taxChartPosition:5});const r=()=>{const h=new Map;for(const n of t)h.set(n,{armies:0,fleets:0,friendly:!1});return h},s=new Map;[N.RU,N.CN,N.IN,N.BR,N.US,N.EU].map(h=>s.set(h,r())),e.units=s;const c=new Map,u=["chicago","brasilia","paris","moscow","beijing","newdelhi"],f=["neworleans","riodejaneiro","london","vladivostok","shanghai","mumbai"];for(const h of t){let n=null;u.includes(h)?n="armaments":f.includes(h)&&(n="shipyard"),c.set(h,{factory:n})}const m=new Map;for(const h of N)h===N.CN?m.set(h,{armies:10,fleets:6}):h===N.US?m.set(h,{armies:6,fleets:10}):m.set(h,{armies:8,fleets:8});return e.provinces=c,e.currentNation=N.RU,e.unitLimits=m,e},un=({players:a,provinceNames:t})=>{const e={availableBonds:Vt(),nations:new Map,order:a.map(h=>h.id),players:{}};let i;switch(a.length){case 6:i=15;break;case 5:i=18;break;case 4:i=22;break;case 3:i=28;break;case 2:i=40;break}a.forEach(({id:h})=>{e.players[h]={name:h,cash:i,bonds:new Set,rawScore:0}});for(const h of v)e.nations.set(h,{controller:null,treasury:0,rondelPosition:null,flagCount:0,powerPoints:0,taxChartPosition:5});const r=()=>{const h=new Map;for(const n of t)h.set(n,{armies:0,fleets:0,friendly:!1});return h},s=new Map;[v.CN,v.JP,v.FR,v.GB,v.TR,v.RU,v.GE].forEach(h=>{s.set(h,r())}),e.units=s;const c=new Map,u=["syria","moscow","peking","sinkiang","cambodia","hyderabad"],f=["iraq","odessa","annam","otaru","tokyo","madras","sumatra","borneo"];for(const h of t){let n=null;u.includes(h)?n="armaments":f.includes(h)&&(n="shipyard"),c.set(h,{factory:n})}const m=new Map;for(const h of v)m.set(h,{armies:8,fleets:8});return e.provinces=c,e.currentNation=v.CN,e.unitLimits=m,e},hn=({players:a,provinceNames:t})=>{const e={availableBonds:Lt(),nations:new Map,order:a.map(h=>h.id),players:{}};let i;switch(a.length){case 6:i=15;break;case 5:i=18;break;case 4:i=22;break;case 3:i=28;break;case 2:default:i=40;break}a.forEach(({id:h})=>{e.players[h]={name:h,cash:i,bonds:new Set,rawScore:0}});for(const h of k)e.nations.set(h,{controller:null,treasury:0,rondelPosition:null,flagCount:0,powerPoints:0,taxChartPosition:5});const r=()=>{const h=new Map;for(const n of t)h.set(n,{armies:0,fleets:0,friendly:!1});return h},s=new Map;[k.AH,k.IT,k.FR,k.GB,k.GE,k.RU].map(h=>s.set(h,r())),e.units=s;const c=new Map,u=["vienna","budapest","paris","berlin","rome","moscow"],f=["bordeaux","london","liverpool","hamburg","naples","odessa"];for(const h of t){let n=null;u.includes(h)?n="armaments":f.includes(h)&&(n="shipyard"),c.set(h,{factory:n})}const m=new Map;for(const h of k)h===k.AH?m.set(h,{armies:10,fleets:6}):h===k.GB?m.set(h,{armies:6,fleets:10}):m.set(h,{armies:8,fleets:8});return e.provinces=c,e.currentNation=k.AH,e.unitLimits=m,e},Ae=(a,t)=>{const e=t.currentPlayerName,i=new Set([C.skipBondPurchase({player:e,nation:a})]),r=[...t.players[e].bonds].filter(s=>s.nation===a).map(s=>s.cost);return[...t.availableBonds].forEach(s=>{const c=s.cost<=t.players[e].cash;a===s.nation&&(c&&i.add(C.bondPurchase({nation:a,player:t.currentPlayerName,cost:s.cost,tradeInValue:0})),r.forEach(f=>{s.cost<=t.players[e].cash+f&&f<s.cost&&i.add(C.bondPurchase({nation:a,player:t.currentPlayerName,cost:s.cost,tradeInValue:f}))}))}),i},fn=a=>({firstPlayerIndex:a.firstPlayerIndex}),mn=a=>{const t=new Map;for(const[h,n]of a.units){const o=new Map;for(const[l,d]of n)o.set(l,{...d});a.baseGame==="imperial"?t.set(k[h.value],o):a.baseGame==="imperial2030"?t.set(N[h.value],o):a.baseGame==="imperialAsia"&&t.set(v[h.value],o)}const e=new Map;for(const[h,n]of a.nations)a.baseGame==="imperial"?e.set(k[h.value],{...n}):a.baseGame==="imperial2030"?e.set(N[h.value],{...n}):a.baseGame==="imperialAsia"&&e.set(v[h.value],{...n});const i=new Map;for(const[h,n]of a.provinces)i.set(h,{...n});const r=new Set;for(const h of a.availableBonds)r.add(h);const s=new Set;for(const h of a.availableActions)s.add(h);const c={};for(const h of Object.keys(a.players)){c[h]={},c[h].cash=a.players[h].cash,c[h].name=a.players[h].name,c[h].rawScore=a.players[h].rawScore;const n=new Set;for(const o of a.players[h].bonds)n.add(o);c[h].bonds=n}const u={};for(const h of Object.keys(a.fleetConvoyCount))u[h]=a.fleetConvoyCount[h];const f=[];for(const h of a.coexistingNations)f.push(h);const m=[];for(const h of a.swissBanksWhoDoNotInterrupt)m.push(h);return{units:t,nations:e,provinces:i,availableBonds:r,availableActions:s,players:c,fleetConvoyCount:u,coexistingNations:f,currentNationInConflict:a.currentNationInConflict,swissBanksWhoDoNotInterrupt:m,importing:!1,buildingFactory:a.buildingFactory}},fe=a=>t=>{throw new Error(`got=${t.value}, want=${a}`)},pn=({players:a,provinceNames:t})=>{const e={2:({id:n,nation:o})=>o.when({RU:()=>[{id:n,nation:N.RU},{id:n,nation:N.IN},{id:n,nation:N.US}],CN:()=>[{id:n,nation:N.CN},{id:n,nation:N.BR},{id:n,nation:N.EU}],IN:fe("RU|CN"),BR:fe("RU|CN"),US:fe("RU|CN"),EU:fe("RU|CN")}),3:({id:n,nation:o})=>o.when({RU:()=>[{id:n,nation:N.RU},{id:n,nation:N.BR}],CN:()=>[{id:n,nation:N.CN},{id:n,nation:N.EU}],IN:()=>[{id:n,nation:N.IN},{id:n,nation:N.US}],BR:fe("RU|CN|IN"),EU:fe("RU|CN|IN"),US:fe("RU|CN|IN")}),4:n=>[n],5:n=>[n],6:n=>[n]},i={availableBonds:Dt(),nations:new Map,order:a.map(n=>n.id),players:{}};a.map(e[a.length]).flat().forEach(({id:n,nation:o})=>{i.players[n]===void 0&&(i.players[n]={name:n,cash:2,bonds:new Set,rawScore:0});const l=o.when({US:()=>N.RU,IN:()=>N.BR,BR:()=>N.CN,CN:()=>N.US,RU:()=>N.EU,EU:()=>N.IN});i.availableBonds.delete(Z(o,4)),i.availableBonds.delete(Z(l,1)),i.players[n].bonds.add(Z(o,4)),i.players[n].bonds.add(Z(l,1))});const r=new Set;Object.keys(i.players).forEach(n=>{for(const o of i.players[n].bonds)r.add(o)});for(const n of N){const o=Array.from(r).filter(w=>w.nation===n).sort(({cost:w},{cost:S})=>w<S?1:w>S?-1:0),l=o[0],d=Object.keys(i.players).find(w=>i.players[w].bonds.has(l))||null,y=o.reduce((w,{cost:S})=>w+S,0);i.nations.set(n,{controller:d,treasury:y,rondelPosition:null,flagCount:0,powerPoints:0,taxChartPosition:5});const b=i.nations.get(N.RU).controller,g=i.order.indexOf(b);g===i.order.length-1?i.investorCardHolder=i.order[0]:i.investorCardHolder=i.order[g+1]}const s=()=>{const n=new Map;for(const o of t)n.set(o,{armies:0,fleets:0,friendly:!1});return n},c=new Map;[N.RU,N.CN,N.IN,N.BR,N.US,N.EU].forEach(n=>{c.set(n,s())}),i.units=c;const u=new Map,f=["chicago","brasilia","paris","moscow","beijing","newdelhi"],m=["neworleans","riodejaneiro","london","vladivostok","shanghai","mumbai"];for(const n of t){let o=null;f.includes(n)?o="armaments":m.includes(n)&&(o="shipyard"),u.set(n,{factory:o})}const h=new Map;for(const n of N)n===N.CN?h.set(n,{armies:10,fleets:6}):n===N.US?h.set(n,{armies:6,fleets:10}):h.set(n,{armies:8,fleets:8});return i.provinces=u,i.currentNation=N.RU,i.unitLimits=h,i},me=a=>t=>{throw new Error(`got=${t.value}, want=${a}`)},yn=({players:a,provinceNames:t})=>{const e={2:({id:n,nation:o})=>o.when({RU:()=>[{id:n,nation:v.RU},{id:n,nation:v.IN},{id:n,nation:v.US}],CN:()=>[{id:n,nation:v.CN},{id:n,nation:v.BR},{id:n,nation:v.EU}],IN:me("RU|CN"),BR:me("RU|CN"),US:me("RU|CN"),EU:me("RU|CN")}),3:({id:n,nation:o})=>o.when({RU:()=>[{id:n,nation:v.RU},{id:n,nation:v.BR}],CN:()=>[{id:n,nation:v.CN},{id:n,nation:v.EU}],IN:()=>[{id:n,nation:v.IN},{id:n,nation:v.US}],BR:me("RU|CN|IN"),EU:me("RU|CN|IN"),US:me("RU|CN|IN")}),4:n=>[n],5:n=>[n],6:n=>[n]},i={availableBonds:Vt(),nations:new Map,order:a.map(n=>n.id),players:{}};a.map(e[a.length]).flat().forEach(({id:n,nation:o})=>{i.players[n]===void 0&&(i.players[n]={name:n,cash:2,bonds:new Set,rawScore:0});const l=o.when({GB:()=>v.RU,TR:()=>v.JP,JP:()=>v.CN,CN:()=>v.GE,RU:()=>v.FR,FR:()=>v.TR,GE:()=>v.GB});i.availableBonds.delete(Z(o,4)),i.availableBonds.delete(Z(l,1)),i.players[n].bonds.add(Z(o,4)),i.players[n].bonds.add(Z(l,1))});const r=new Set;Object.keys(i.players).forEach(n=>{for(const o of i.players[n].bonds)r.add(o)});for(const n of v){const o=Array.from(r).filter(w=>w.nation===n).sort(({cost:w},{cost:S})=>w<S?1:w>S?-1:0),l=o[0],d=Object.keys(i.players).find(w=>i.players[w].bonds.has(l))||null,y=o.reduce((w,{cost:S})=>w+S,0);i.nations.set(n,{controller:d,treasury:y,rondelPosition:null,flagCount:0,powerPoints:0,taxChartPosition:5});const b=i.nations.get(v.CN).controller,g=i.order.indexOf(b);g===i.order.length-1?i.investorCardHolder=i.order[0]:i.investorCardHolder=i.order[g+1]}const s=()=>{const n=new Map;for(const o of t)n.set(o,{armies:0,fleets:0,friendly:!1});return n},c=new Map;[v.CN,v.JP,v.FR,v.GB,v.TR,v.RU,v.GE].forEach(n=>{c.set(n,s())}),i.units=c;const u=new Map,f=["syria","moscow","peking","sinkiang","cambodia","hyderabad"],m=["iraq","odessa","annam","otaru","tokyo","madras","sumatra","borneo"];for(const n of t){let o=null;f.includes(n)?o="armaments":m.includes(n)&&(o="shipyard"),u.set(n,{factory:o})}const h=new Map;for(const n of v)h.set(n,{armies:8,fleets:8});return i.provinces=u,i.currentNation=v.CN,i.unitLimits=h,i},pe=a=>t=>{throw new Error(`got=${t.value}, want=${a}`)},gn=({players:a,provinceNames:t})=>{const e={2:({id:n,nation:o})=>o.when({AH:()=>[{id:n,nation:k.AH},{id:n,nation:k.FR},{id:n,nation:k.GE}],IT:()=>[{id:n,nation:k.IT},{id:n,nation:k.RU},{id:n,nation:k.GB}],FR:pe("AH|IT"),GB:pe("AH|IT"),RU:pe("AH|IT"),GE:pe("AH|IT")}),3:({id:n,nation:o})=>o.when({AH:()=>[{id:n,nation:k.AH},{id:n,nation:k.GB}],IT:()=>[{id:n,nation:k.IT},{id:n,nation:k.RU}],FR:()=>[{id:n,nation:k.FR},{id:n,nation:k.GE}],GB:pe("AH|IT|FR"),RU:pe("AH|IT|FR"),GE:pe("AH|IT|FR")}),4:n=>[n],5:n=>[n],6:n=>[n]},i={availableBonds:Lt(),nations:new Map,order:a.map(n=>n.id),players:{}};a.map(e[a.length]).flat().forEach(({id:n,nation:o})=>{i.players[n]===void 0&&(i.players[n]={name:n,cash:2,bonds:new Set,rawScore:0});const l=o.when({GE:()=>k.IT,RU:()=>k.FR,AH:()=>k.GE,IT:()=>k.GB,FR:()=>k.AH,GB:()=>k.RU});i.availableBonds.delete(Z(o,4)),i.availableBonds.delete(Z(l,1)),i.players[n].bonds.add(Z(o,4)),i.players[n].bonds.add(Z(l,1))});const r=new Set;Object.keys(i.players).forEach(n=>{for(const o of i.players[n].bonds)r.add(o)});for(const n of k){const o=Array.from(r).filter(w=>w.nation===n).sort(({cost:w},{cost:S})=>w<S?1:w>S?-1:0),l=o[0],d=Object.keys(i.players).find(w=>i.players[w].bonds.has(l))||null,y=o.reduce((w,{cost:S})=>w+S,0);i.nations.set(n,{controller:d,treasury:y,rondelPosition:null,flagCount:0,powerPoints:0,taxChartPosition:5});const b=i.nations.get(k.AH).controller,g=i.order.indexOf(b);g===i.order.length-1?i.investorCardHolder=i.order[0]:i.investorCardHolder=i.order[g+1]}const s=()=>{const n=new Map;for(const o of t)n.set(o,{armies:0,fleets:0,friendly:!1});return n},c=new Map;[k.AH,k.IT,k.FR,k.GB,k.GE,k.RU].forEach(n=>{c.set(n,s())}),i.units=c;const u=new Map,f=["vienna","budapest","paris","berlin","rome","moscow"],m=["bordeaux","london","liverpool","hamburg","naples","odessa"];for(const n of t){let o=null;f.includes(n)?o="armaments":m.includes(n)&&(o="shipyard"),u.set(n,{factory:o})}const h=new Map;for(const n of k)n===k.AH?h.set(n,{armies:10,fleets:6}):n===k.GB?h.set(n,{armies:6,fleets:10}):h.set(n,{armies:8,fleets:8});return i.provinces=u,i.currentNation=k.AH,i.unitLimits=h,i};var Ie;class vn{constructor(t){G(this,Ie,void 0);O(this,Ie,t)}nationCosts(t){return Math.min(t.treasury,I(this,Ie))}playerCosts(t,e){const i=I(this,Ie)-this.nationCosts(t);return Math.max(0,Math.min(i,e.cash))}}Ie=new WeakMap;var We;class St{constructor(t){G(this,We,void 0);O(this,We,t)}canAffordToBuild(t,e){return t.treasury+e.cash>=I(this,We)}static buildableFactoriesLocations(t){const e=new Set;for(const i of t)i.isDevoidOfFactory&&i.isNotOccupiedByHostiles&&e.add(i);return e}}We=new WeakMap;const Ft=class extends Error{constructor(a,t){super(`${a} cannot afford ${Math.abs(t)}`),this.name="InsufficientCashError"}};class bn{static get InsufficientCashError(){return Ft}static changeBy(t,e,i){if(t.cash+e<0)throw new Ft(t,e);if(i){const r=t.cash;i.pushUndoOperation(()=>{t.cash=r})}e&&(t.cash=Math.max(0,t.cash+e))}}var de,Be,qe;class _n{constructor(t,e,i){G(this,de,void 0);G(this,Be,void 0);G(this,qe,void 0);O(this,de,t),O(this,Be,e),O(this,qe,i)}nextAvailableFreeRondelSlots(t){const e=new Set;if(t)for(let i=0;i<I(this,Be);i+=1)t=I(this,de).slotClockwiseTo(t,1),e.add(t);else for(const i of I(this,de).allSlots())e.add(i);return e}nextAvailablePaidRondelSlots(t,e){const i=new Map;if(t){t=I(this,de).slotClockwiseTo(t,I(this,Be));for(let r=0;r<I(this,qe);r+=1){const s=(r+1)*e;t=I(this,de).slotClockwiseTo(t,1),i.set(t,s)}}return i}}de=new WeakMap,Be=new WeakMap,qe=new WeakMap;var Je;class wn{constructor(t){G(this,Je,void 0);O(this,Je,t)}costPerPaidRondelSlot(t){let e=1;switch(I(this,Je).constructor){case H:e+=1;break;case L:case j:default:e+=Math.floor(t.powerPoints/5);break}return e}}Je=new WeakMap;const Rt=class extends Error{constructor(a,t){super(`Attepting to make invalid move from ${a==null?void 0:a.id} to ${t.id}.`),this.name="InvalidMoveError"}};var ot,ve,Ce;const st=class{constructor(t){G(this,ot,void 0);G(this,ve,void 0);G(this,Ce,void 0);O(this,ot,t),O(this,ve,new _n(t.rondel,t.availableFreeRondelSlotCount,t.availablePaidRondelSlotCount)),O(this,Ce,new wn(t))}static get InvalidMoveError(){return Rt}get availableSlots(){return I(this,ve)}get slotDistanceCosts(){return I(this,Ce)}static forceMoveNation(t,e,i){const r=t.residingRondelSlot;i&&i.pushUndoOperation(()=>st.forceMoveNation(t,r)),r&&r.residingNations.delete(t),t.residingRondelSlot=e,e&&e.residingNations.add(t)}tryMoveNation(t,e,i,r){const s=e.residingRondelSlot;let u=I(this,ve).nextAvailableFreeRondelSlots(s).has(i),f=0;if(u===!1){const m=I(this,Ce).costPerPaidRondelSlot(e),h=I(this,ve).nextAvailablePaidRondelSlots(s,m);u=h.has(i),u&&(f=h.get(i))}if(u)st.forceMoveNation(e,i,r),bn.changeBy(t,-f,r);else throw new Rt(e.residingRondelSlot,i)}};let Ge=st;ot=new WeakMap,ve=new WeakMap,Ce=new WeakMap;var Xe,Ye,Ze;class Oe{constructor(t,e){G(this,Xe,void 0);G(this,Ye,void 0);G(this,Ze,void 0);O(this,Xe,t),O(this,Ye,e),O(this,Ze,new Yt("3bdHcA8P3mcww2ojgC5G8YiT"))}error(t,e){switch(e.gameId=I(this,Ye),I(this,Xe)){case"production":I(this,Ze).error(t,e);break;case"replay":case"silent":break;default:console.error(t,e);break}}}Xe=new WeakMap,Ye=new WeakMap,Ze=new WeakMap;const Ot=class extends Error{constructor(a){super(`${a} is an invalid undo operation`),this.name="InvalidUndoOperationError"}},_t=class extends Error{constructor(){super("Attempting to modify the undo stack while an undo is in progress"),this.name="ModificationWhileUndoingError"}};var ie,be;class kn{constructor(){G(this,ie,void 0);G(this,be,!1);O(this,ie,[])}static get InvalidUndoOperationError(){return Ot}static get ModificationWhileUndoingError(){return _t}pushUndoOperation(t){if(I(this,be))throw new _t;if(t instanceof Function)I(this,ie).length===0&&this.addUndoCheckpoint(),I(this,ie)[I(this,ie).length-1].push(t);else throw new Ot(t)}addUndoCheckpoint(){if(I(this,be))throw new _t;I(this,ie).push([])}undoToLastCheckpoint(){if(I(this,ie).length===0)return;O(this,be,!0);const t=I(this,ie).pop();for(;t.length>0;)t.pop()();O(this,be,!1)}}ie=new WeakMap,be=new WeakMap;var _e,X,ue,we,he,Qe,lt,zt;const ct=class{constructor(t,e){G(this,lt);G(this,_e,void 0);G(this,X,void 0);G(this,ue,void 0);G(this,we,void 0);G(this,he,void 0);G(this,Qe,void 0);O(this,_e,e||new Oe),this.board=t||Nt,this.log=[],this.annotatedLog=[],this.unitsToMove=[],this.units=new Map,this.provinces=new Map,this.nations=new Map,this.availableActions=new Set,this.maneuvering=!1,this.handlingConflict=!1,this.soloMode=!1,this.swissBanks=[],this.uncontrolledNations=[],this.passingThroughInvestor=!1,this.previousPlayerName="",this.fleetConvoyCount={},this.maxImports=0,this.winner="",this.availableBonds=new Set,this.players={},this.investing=!1,this.firstInvestor="",this.currentNationInConflict=null,this.coexistingNations=[],this.swissBanksWhoDoNotInterrupt=[],this.baseGame="",O(this,X,null),O(this,ue,new kn)}get game(){return I(this,X)}tickFromLog(t){t.forEach(e=>this.tick(e))}tick(t){var r,s,c;if(Ct(this,lt,zt).call(this,t),t.type==="initialize"){this.log.push(t),this.annotatedLog.push(t),this.initialize(t);return}if(t.type==="endGame"){this.log.push(t),this.annotatedLog.push(t),this.endGame();return}let e=!1;for(const u of this.availableActions)if(ct.isEqual(u,t)){e=!0;break}if(e===!1){I(this,_e).error("Invalid action error",{action:t,expectedAvailableActions:Object.assign([...this.availableActions])});return}this.availableActions=new Set,this.log.length>0&&!this.winner&&this.log.slice(-1)[0].type!=="undo"&&this.availableActions.add(C.undo({player:this.currentPlayerName})),this.log.push(t);const i={playerName:this.currentPlayerName,...t};switch(this.annotatedLog.push(i),t.type){case"undo":{I(this,ue).undoToLastCheckpoint(),Object.assign(this,this.oldState),(r=this.auction)!=null&&r.inAuction&&Object.assign(this.auction,this.oldAuctionState);return}case"bondPurchase":{(s=this.auction)!=null&&s.inAuction?this.auction.tick(t,this):this.bondPurchase(t);return}case"skipBondPurchase":{(c=this.auction)!=null&&c.inAuction?this.auction.tick(t,this):this.postBondPurchase();return}case"endManeuver":{this.endManeuver();return}case"fight":{this.fight(t);return}case"coexist":{this.coexist(t);return}case"unfriendlyEntrance":{this.unfriendlyEntrance(t);return}case"friendlyEntrance":{this.friendlyEntrance(t);return}case"forceInvestor":{this.swissBanksWhoDoNotInterrupt=[],this.passingThroughInvestor=!1,this.nations.get(this.currentNation).rondelPosition="investor";const u=I(this,X).nationIdToEntity(this.currentNation);Ge.forceMoveNation(u,I(this,X).rondel.investorSlot,I(this,ue));const f=C.rondel({slot:"investor",nation:this.currentNation,cost:0});this.currentPlayerName=this.nations.get(this.currentNation).controller,this.investor(f);return}case"skipForceInvestor":{if(this.swissBanksWhoDoNotInterrupt.push(this.currentPlayerName),this.swissBanksWhoDoNotInterrupt.length===this.swissBanks.length){const f=this.log.slice().reverse().find(m=>m.type==="rondel");this.currentPlayerName=this.nations.get(f.payload.nation).controller,this.availableActions.add(f),this.tick(f);return}this.allowSwissBanksToForceInvestor();return}case"buildFactory":{this.buildFactory(t.payload.province);return}case"skipBuildFactory":{this.handlePassingThroughInvestor(),this.buildingFactory=!1;return}case"destroyFactory":{this.destroyFactory(t);return}case"skipDestroyFactory":{this.skipDestroyFactory();return}case"import":{this.import(t);return}case"maneuver":{this.maneuver(t);return}case"blockCanal":{this.setManeuverAvailableActions();const u=this.log[this.log.length-2].payload;this.availableActions.delete(C.maneuver({origin:u.origin,destination:u.destination})),this.currentPlayerName=this.previousPlayerName;return}case"unblockCanal":{const u=this.log[this.log.length-2].payload,f=C.maneuver({origin:u.origin,destination:u.destination});this.maneuver(f,!0);return}case"rondel":{this.previousPlayerName=this.currentPlayerName,this.advanceOnRondel(t);break}}}initialize(t){switch(this.baseGame=t.payload.baseGame||H.classId,this.baseGame){case H.classId:O(this,X,new H);break;case L.classId:O(this,X,new L);break;case j.classId:O(this,X,new j);break;default:I(this,_e).error("Undefined gamemode error",{gameMode:this.baseGame}),O(this,X,null);break}O(this,we,new Ge(I(this,X))),O(this,he,new vn(I(this,X).factoryBuildCosts)),O(this,Qe,new St(I(this,X).factoryBuildCosts)),this.variant=t.payload.variant;let e;if(this.variant==="standard"?this.baseGame==="imperial"?e=gn:this.baseGame==="imperial2030"?e=pn:this.baseGame==="imperialAsia"&&(e=yn):(this.baseGame==="imperial"?e=hn:this.baseGame==="imperial2030"?e=dn:this.baseGame==="imperialAsia"&&(e=un),this.auction=ne.fromLog(this.log,this,e)),e){const i=e({players:t.payload.players,provinceNames:Array.from(this.board.graph.keys())});if(this.availableBonds=i.availableBonds,this.currentNation=i.currentNation,this.investorCardHolder=i.investorCardHolder,this.nations=i.nations,this.order=i.order,this.players=i.players,this.provinces=i.provinces,this.unitLimits=i.unitLimits,this.units=this.initializeUnits(i.units),this.currentPlayerName=this.getStartingPlayer(),this.previousPlayerName=this.currentPlayerName,this.variant==="standard")for(const r of this.availableRondelActions(this.currentNation))this.availableActions.add(r);this.soloMode=t.payload.soloMode}}getStartingPlayer(){return this.variant==="standard"?this.nations.get(this.currentNation).controller:this.order[0]}bondPurchase(t){const e={2:1,4:2,6:3,9:4,12:5,16:6,20:7,25:8,30:9},{bonds:i}=this.players[t.payload.player];let r=[];t.payload.cost>this.players[t.payload.player].cash&&(r=[...i].filter(({nation:n})=>n===t.payload.nation).map(({cost:n})=>n));const s=Math.max(...r),c=Z(t.payload.nation,e[s]),u=t.payload.tradeInValue||c.cost;if(u>0){const n=Z(t.payload.nation,e[u]),o=t.payload.cost-u;this.nations.get(t.payload.nation).treasury+=o,this.availableBonds.add(n),this.players[t.payload.player].cash-=o,this.players[t.payload.player].bonds.delete(n),this.annotatedLog.push(C.playerTradedInForABond({player:t.payload.player,bondNation:t.payload.nation,bondCost:u}))}else this.nations.get(t.payload.nation).treasury+=t.payload.cost,this.players[t.payload.player].cash-=t.payload.cost;const f=Z(t.payload.nation,e[t.payload.cost]);if(!this.availableBonds.has(f))throw new Error(`${f} not available`);this.players[t.payload.player].bonds.add(f),this.availableBonds.delete(f),this.nations.get(t.payload.nation).controller===null&&(this.nations.get(t.payload.nation).controller=t.payload.player);const m=this.nations.get(t.payload.nation).controller;this.totalInvestmentInNation(t.payload.player,t.payload.nation)>this.totalInvestmentInNation(this.nations.get(t.payload.nation).controller,t.payload.nation)&&(this.nations.get(t.payload.nation).controller=t.payload.player);const h=this.nations.get(t.payload.nation).controller;this.annotatedLog.push(C.nationControllerChanged({oldNationController:m,newNationController:h,nation:t.payload.nation})),this.investorCardActive=!1,this.updateRawScores(),this.postBondPurchase()}postBondPurchase(){if(this.investing){this.previousPlayerName=this.currentPlayerName;let i;this.baseGame==="imperial"?i=this.currentNation.when({AH:()=>k.IT,IT:()=>k.FR,FR:()=>k.GB,GB:()=>k.GE,GE:()=>k.RU,RU:()=>k.AH}):this.baseGame==="imperial2030"?i=this.currentNation.when({RU:()=>N.CN,CN:()=>N.IN,IN:()=>N.BR,BR:()=>N.US,US:()=>N.EU,EU:()=>N.RU}):this.baseGame==="imperialAsia"&&(i=this.currentNation.when({CN:()=>v.JP,JP:()=>v.FR,FR:()=>v.GB,GB:()=>v.TR,TR:()=>v.RU,RU:()=>v.GE,GE:()=>v.CN}));const r=this.order.indexOf(this.currentPlayerName);if(r===this.order.length-1?this.currentPlayerName=this.order[0]:this.currentPlayerName=this.order[r+1],this.currentPlayerName!==this.firstInvestor){if(this.swissBanks.includes(this.currentPlayerName))for(const s of this.bondPurchasesFromAllNations())this.availableActions.add(s);else for(const s of Ae(this.currentNation,this))this.availableActions.add(s);for(;this.availableActions.size<=2&&this.investing;){this.annotatedLog.push(C.playerAutoSkipsBondPurchase({player:this.currentPlayerName,bondNation:this.currentNation}));const s=this.order.indexOf(this.currentPlayerName);if(this.currentPlayerName=this.order[s+1]||this.order[0],this.currentPlayerName===this.firstInvestor){this.investing=!1;for(const c in this.players)this.checkForSwissBank(c);this.currentNation=this.nextNation(this.currentNation),this.currentPlayerName=this.nations.get(this.currentNation).controller,this.advanceInvestorCard(),this.availableActions.forEach(c=>{c.type==="skipBondPurchase"&&this.availableActions.delete(c)});for(const c of this.availableRondelActions(this.currentNation))this.availableActions.add(c);return}if(this.swissBanks.includes(this.currentPlayerName))for(const c of this.bondPurchasesFromAllNations())this.availableActions.add(c);else for(const c of Ae(this.currentNation,this))this.availableActions.add(c)}return}if(!this.nations.get(i).controller){this.currentNation=i,this.roundOfInvestment();return}this.investing=!1}const t=this.order.indexOf(this.investorCardHolder),e=this.swissBanks.sort((i,r)=>{const s=this.order.indexOf(i),c=this.order.indexOf(r);return t===0?s>c?1:-1:s-t+1>c-t+1?1:-1});if(this.variant!=="withoutInvestorCard"&&e.length>0&&e.some(i=>this.hasNotBoughtABondThisTurn(i)===!0)){for(const i of e.filter(r=>this.hasNotBoughtABondThisTurn(r)))if(i!==this.investorCardHolder&&this.endOfInvestorTurn(i),this.availableActions.size<=1){this.annotatedLog.push(C.playerAutoSkipsBondPurchase({player:this.currentPlayerName,bondNation:this.currentNation})),this.currentNation=this.nextNation(this.currentNation),this.currentPlayerName=this.nations.get(this.currentNation).controller,this.advanceInvestorCard();for(const r of this.availableRondelActions(this.currentNation))this.availableActions.add(r)}}else{for(const i in this.players)this.checkForSwissBank(i);this.currentNation=this.nextNation(this.currentNation),this.currentPlayerName=this.nations.get(this.currentNation).controller,this.advanceInvestorCard();for(const i of this.availableRondelActions(this.currentNation))this.availableActions.add(i)}}checkForSwissBank(t){if(this.nationsUnderControl(t).length>0){const e=this.swissBanks.indexOf(t);e!==-1&&this.swissBanks.splice(e,1)}else this.swissBanks.indexOf(t)===-1&&this.swissBanks.push(t)}endManeuver(){this.unitsToMove=[],this.fleetConvoyCount={},this.maneuvering=!1,this.adjudicateFlags(),this.handlePassingThroughInvestor()}endGame(){const t={};Object.keys(this.players).forEach(r=>{let s=this.players[r].rawScore;s+=this.players[r].cash,t[r]=s});const e=Math.max(...Object.keys(t).map(r=>t[r])),i=Object.keys(t).filter(r=>t[r]===e);if(i.length===1)this.winner=i[0];else{let r={};for(const[s,c]of this.nations)c.powerPoints===25&&(r=s);this.winner="",i.forEach(s=>{this.totalInvestmentInNation(s,r)>this.totalInvestmentInNation(this.winner,r)&&(this.winner=s)})}this.availableActions.clear()}fight(t){var o,l;this.coexistingNations=[],this.currentNationInConflict=null;const{province:e}=t.payload,i=this.units.get(t.payload.incumbent).get(e),r=this.units.get(t.payload.challenger).get(e);let s=null;if(this.unitsToMove.forEach(([d],y)=>{d===e&&(s=y)}),s!==null){this.unitsToMove.splice(s,1);for(const d of this.availableActions)(((o=d.payload)==null?void 0:o.origin)===e||((l=d.payload)==null?void 0:l.province)===e)&&this.availableActions.delete(d)}for(;(i.fleets>0||i.armies>0)&&(r.fleets>0||r.armies>0);)t.payload.targetType==="army"?(i.armies-=1,r.armies>0?r.armies-=1:r.fleets-=1):(i.fleets-=1,r.armies>0?r.armies-=1:r.fleets-=1);const c=this.units.get(this.currentNation).get(e).fleets,u=this.units.get(this.currentNation).get(e).armies;if(c===0&&u===0){let d={},y={};for(const b of this.availableActions)b.type==="coexist"&&b.payload.province===e?d=b:b.type==="fight"&&b.payload.province===e&&(y=b);this.availableActions.delete(d),this.availableActions.delete(y)}const f=i.armies+i.fleets,m=r.armies+r.fleets;let h=!0;for(const[d,y]of this.board.byNation)y.has(e)&&d&&(h=!1);m>f&&h&&(this.provinces.get(e).flag=t.payload.challenger);const n=[];for(const[d,y]of this.units){const b=y.get(e),g=b.armies,w=b.fleets;(g>0||w>0)&&n.push(d)}Object.keys(n).length>0&&m===f&&h&&(n.length===1?this.provinces.get(e).flag=n[0]:n.length>1&&(this.provinces.get(e).flag=null)),this.handlingConflict=!1,this.previousPlayerName=this.currentPlayerName,this.log[this.log.length-2].type==="coexist"?this.currentPlayerName=this.nations.get(t.payload.incumbent).controller:this.currentPlayerName=this.nations.get(t.payload.challenger).controller,this.setManeuverAvailableActions()}coexist(t){var i;this.coexistingNations.push(t.payload.challenger);const e=[];for(const[r]of this.nations){const{armies:s,fleets:c}=this.units.get(r).get(t.payload.province);(s>0||c>0)&&!this.coexistingNations.includes(r)&&e.push(r)}for(const[r]of this.nations)r!==this.currentNation&&((i=this.board.byNation.get(r))!=null&&i.has(t.payload.province))&&(this.units.get(t.payload.challenger).get(t.payload.province).friendly=!0);if(e.length>0){this.previousPlayerName=this.currentPlayerName,this.currentPlayerName=this.nations.get(e[0]).controller;const r=t.payload.province;this.availableActions.clear(),this.units.get(e[0]).get(t.payload.province).armies>0?this.availableActions.add(C.fight({province:r,incumbent:this.coexistingNations[0],challenger:e[0],targetType:"army"})):this.units.get(e[0]).get(t.payload.province).fleets>0&&this.availableActions.add(C.fight({province:r,incumbent:this.coexistingNations[0],challenger:e[0],targetType:"fleet"}));let s=!1;for(const c of this.availableActions)c.type!=="undo"&&(s=!0);if(s){this.availableActions.add(C.coexist({province:r,incumbent:this.coexistingNations[0],challenger:e[0]})),this.handlingConflict=!0;return}}if(this.handlingConflict=!1,this.coexistingNations=[],this.currentNationInConflict=null,this.previousPlayerName=this.currentPlayerName,this.currentPlayerName=this.nations.get(t.payload.incumbent).controller,this.unitsToMove.length===0)if(this.units.get(t.payload.challenger).get(t.payload.province).friendly=!0,this.unitsToMove=[],this.maneuvering=!1,this.variant==="withoutInvestorCard")this.roundOfInvestment();else{this.handleAdvancePlayer();for(const r of this.availableRondelActions(this.currentNation))this.availableActions.add(r)}else this.setManeuverAvailableActions()}unfriendlyEntrance(t){const{province:e}=t.payload;if(!!this.provinces.get(e).factory&&this.board.graph.get(e).nation!==this.currentNation&&this.units.get(this.currentNation).get(e).armies>=3&&this.log[this.log.length-1].type!=="skipDestroyFactory"){for(const r of[C.destroyFactory({province:e}),C.skipDestroyFactory({province:e})])this.availableActions.add(r);return}this.handlingConflict=!1,this.unitsToMove.length===0?(this.unitsToMove=[],this.maneuvering=!1,this.handlePassingThroughInvestor()):this.setManeuverAvailableActions()}friendlyEntrance(t){this.handlingConflict=!1,this.units.get(t.payload.challenger).get(t.payload.province).friendly=!0,this.unitsToMove.length===0?(this.unitsToMove=[],this.maneuvering=!1,this.handlePassingThroughInvestor()):this.setManeuverAvailableActions()}buildFactory(t){const e=this.nations.get(this.currentNation),i=this.players[this.currentPlayerName];this.provinces.get(t).factory=this.board.graph.get(t).factoryType;const r=I(this,he).nationCosts(e),s=I(this,he).playerCosts(e,i);e.treasury-=r,i.cash-=s,this.handlePassingThroughInvestor(),this.buildingFactory=!1}destroyFactory(t){this.provinces.get(t.payload.province).factory="",this.units.get(this.currentNation).get(t.payload.province).armies-=3,this.handlingConflict=!1,this.setManeuverAvailableActions()}skipDestroyFactory(){this.handlingConflict=!1,this.setManeuverAvailableActions()}import(t){t.payload.placements.forEach(({province:e,type:i})=>{const{nation:r}=this.board.graph.get(e);i==="army"?this.units.get(r).get(e).armies+=1:this.units.get(r).get(e).fleets+=1,this.nations.get(r).treasury-=1}),this.importing=!1,this.maxImports=0,this.handlePassingThroughInvestor()}maneuver(t,e){var n,o;const{origin:i}=t.payload,{destination:r}=t.payload,s=this.board.graph.get(r).isOcean?"fleet":"army";if(s==="fleet"){if(this.baseGame==="imperial2030"&&!e){const l=this.provinces.get("colombia").flag,d=i==="northpacific"&&r==="caribbeansea"||i==="caribbeansea"&&r==="northpacific",y=this.provinces.get("northafrica").flag,b=i==="mediterraneansea"&&r==="indianocean"||i==="indianocean"&&r==="mediterraneansea";if(d&&l&&l!==this.currentNation||b&&y&&y!==this.currentNation){const w=l||y;this.availableActions.add(C.blockCanal()),this.availableActions.add(C.unblockCanal()),this.currentPlayerName=this.nations.get(w).controller;return}}this.units.get(this.currentNation).get(i).fleets-=1,this.units.get(this.currentNation).get(r).fleets+=1}if(s==="army"){const l=new Set;for(const[w,S]of this.units.get(this.currentNation))S.fleets-(this.fleetConvoyCount[w]||0)>0&&l.add(w);const g=(this.board.pathsFrom({origin:i,nation:this.currentNation,isFleet:!1,friendlyFleets:l,isOccupied:!1},[i]).filter(w=>w[w.length-1]===r)||[]).sort((w,S)=>w.filter(M=>this.board.graph.get(M).isOcean).length-S.filter(M=>this.board.graph.get(M).isOcean).length)[0].filter(w=>this.board.graph.get(w).isOcean);for(const w of g)this.fleetConvoyCount[w]=(this.fleetConvoyCount[w]||0)+1;this.units.get(this.currentNation).get(i).armies-=1,this.units.get(this.currentNation).get(r).armies+=1,this.unitsToMove=this.unitsToMove.filter(([,w])=>w==="army")}const c=this.unitsToMove.findIndex(l=>l[0]===t.payload.origin&&l[1]===s);this.unitsToMove.splice(c,1),this.updateFlag(i);let u=null;for(const[l]of this.nations)if(l!==this.currentNation){const d=this.units.get(l).get(r);(d.armies>0||d.fleets>0)&&(d.armies>0&&(u||(u=l),this.availableActions.add(C.fight({province:r,incumbent:l,challenger:this.currentNation,targetType:"army"}))),d.fleets>0&&(u||(u=l),this.availableActions.add(C.fight({province:r,incumbent:l,challenger:this.currentNation,targetType:"fleet"}))))}let f=!1;for(const l of this.availableActions)l.type!=="undo"&&(f=!0);if(f){this.availableActions.add(C.coexist({province:r,incumbent:u,challenger:this.currentNation})),this.handlingConflict=!0;return}for(const[l]of this.nations){if(l!==this.currentNation&&((n=this.board.byNation.get(l))!=null&&n.has(r))&&this.provinces.get(r).factory&&this.unoccupiedFactoryCount(l)===0&&this.units.get(this.currentNation).get(r).armies<2){this.availableActions.add(C.friendlyEntrance({incumbent:l,challenger:this.currentNation,province:r})),this.tick(C.friendlyEntrance({incumbent:l,challenger:this.currentNation,province:r}));return}if(l!==this.currentNation&&((o=this.board.byNation.get(l))!=null&&o.has(r))){this.availableActions.add(C.unfriendlyEntrance({incumbent:l,challenger:this.currentNation,province:r})),this.availableActions.add(C.friendlyEntrance({incumbent:l,challenger:this.currentNation,province:r})),this.handlingConflict=!0;return}}if(!!this.provinces.get(r).factory&&this.board.graph.get(r).nation!==this.currentNation&&this.units.get(this.currentNation).get(r).armies>=3&&this.log[this.log.length-1].type!=="skipDestroyFactory"){this.availableActions.add(C.destroyFactory({province:r})),this.availableActions.add(C.skipDestroyFactory({province:r}));return}let h=!0;for(const[l,d]of this.board.byNation)d.has(r)&&l&&(h=!1);h===!0&&(this.provinces.get(r).flag=this.currentNation),this.setManeuverAvailableActions()}setManeuverAvailableActions(){if(this.unitsToMove.length>0){this.checkForNewFights();const t=new Map,e=new Map;this.availableActions.add(C.endManeuver()),this.unitsToMove.forEach(([i,r])=>{const s=this.units.get(this.currentNation).get(i);s.fleets>0&&r==="fleet"?t.set(i,s.fleets):s.armies>0&&e.set(i,s.armies);for(const[u]of t)for(const f of this.board.neighborsFor({origin:u,nation:this.currentNation,isFleet:!0,friendlyFleets:new Set,occupiedHomeProvinces:this.occupiedHomeProvinces(this.currentNation)}))this.availableActions.add(C.maneuver({origin:u,destination:f}));const c=new Set;for(const[u,f]of this.units.get(this.currentNation))f.fleets-(this.fleetConvoyCount[u]||0)>0&&c.add(u);for(const[u]of e)for(const f of this.board.neighborsFor({origin:u,nation:this.currentNation,isFleet:!1,friendlyFleets:c,occupiedHomeProvinces:this.occupiedHomeProvinces(this.currentNation)}))this.availableActions.add(C.maneuver({origin:u,destination:f}))})}else{this.maneuvering=!1;for(const t of this.availableActions)t.type==="endManeuver"&&this.availableActions.delete(t);this.fleetConvoyCount={},this.adjudicateFlags(),this.handlePassingThroughInvestor()}}advanceOnRondel(t){this.currentNation=t.payload.nation;const e=this.nations.get(this.currentNation),i=I(this,X).nationIdToEntity(this.currentNation),r=this.players[this.currentPlayerName],s=i.residingRondelSlot,c=I(this,X).rondel.idToEntity(t.payload.slot);if(s&&I(this,X).rondel.passedInvestor(s,c)&&this.passingThroughInvestor===!1&&(this.passingThroughInvestor=!0,this.swissBanksWhoDoNotInterrupt=[],this.canAffordToPayInvestors(this.currentNation))){this.allowSwissBanksToForceInvestor();let u=!1;for(const f of this.availableActions)if(f.type!=="undo"){u=!0;break}if(u)return}try{e.rondelPosition=t.payload.slot,I(this,we).tryMoveNation(r,i,c,I(this,ue))}catch(u){switch(u.constructor){case Ge.InvalidMoveError:I(this,_e).error(u.message,{player:r,nation:i,rondelSlot:c});break;default:throw u}}switch(t.payload.cost>0&&this.annotatedLog.push(C.playerPaysForRondel({player:this.currentPlayerName,cost:t.payload.cost,slot:t.payload.slot})),t.payload.slot){case"investor":{this.investor(t);return}case"import":{this.importRondel(t);return}case"production1":case"production2":{const{nation:u}=t.payload,f=m=>this.provinces.get(m).factory==="armaments"||this.provinces.get(m).factory==="shipyard";Array.from(this.board.byNation.get(u)).filter(f).forEach(m=>{const h=this.units.get(u).get(m);this.nobodyIsOccupying(m,u)&&(this.provinces.get(m).factory==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",1)?h.fleets+=1:this.provinces.get(m).factory!=="shipyard"&&!this.overUnitLimit(t.payload.nation,"army",1)&&(h.armies+=1))}),this.handlePassingThroughInvestor();return}case"taxation":{const u=t.payload.nation,f=this.nations.get(u),m=I(this,X).nationIdToEntity(u),h=this.taxRevenueOf(u),n=this.nationTaxationProfit(u,h),o=this.playerBonusAfterUnitMaintenanceCosts(u,h),l=this.powerPointsGainedFrom(h);if(f.taxChartPosition=this.getTaxChartPosition(h),f.treasury+=n,this.annotatedLog.push(C.nationGainsTreasury({nation:u,amount:n})),this.players[this.currentPlayerName].cash+=o,this.annotatedLog.push(C.playerGainsCash({player:this.currentPlayerName,amount:o})),f.powerPoints+=l,m.powerPoints+=l,f.powerPoints>=25){f.powerPoints=25,m.powerPoints=25,this.updateRawScores(),this.tick(C.endGame());return}this.annotatedLog.push(C.nationGainsPowerPoints({nation:u,powerPoints:l})),this.handlePassingThroughInvestor(),this.updateRawScores();return}case"maneuver1":case"maneuver2":{this.availableActions.add(C.endManeuver()),this.maneuvering=!0,this.collectUnitsToMove(t),this.checkForNewFights(),this.setManeuverAvailableActions();return}case"factory":{const u=new Set;for(const f of this.board.byNation.get(this.currentNation))u.add(an(f,this.provinces,this.units,this.board));if(I(this,Qe).canAffordToBuild(e,r)){this.buildingFactory=!0;const f=I(this,he).nationCosts(e),m=I(this,he).playerCosts(e,r);for(const h of St.buildableFactoriesLocations(u))this.availableActions.add(C.buildFactory({province:h.id,player:this.currentPlayerName,nationCosts:f,playerCosts:m}));this.availableActions.add(C.skipBuildFactory({nation:this.currentNation,player:this.currentPlayerName}))}else this.annotatedLog.push(C.couldNotBuildFactory({nation:this.currentNation})),this.handlePassingThroughInvestor();break}}}investor(t){const{nation:e}=t.payload;for(const r of Object.keys(this.players))r!==this.currentPlayerName&&this.playerBondsOfNation(r,e).forEach(s=>{let c=s.number;this.nations.get(e).treasury>=c?this.nations.get(e).treasury-=c:this.players[this.currentPlayerName].cash>=c?this.players[this.currentPlayerName].cash-=c:(c=this.players[this.currentPlayerName].cash,this.players[this.currentPlayerName].cash=0),this.players[r].cash+=c,this.annotatedLog.push(C.nationPaysPlayer({player:this.players[r].name,nation:e,amount:c}))});const i=[...this.players[this.currentPlayerName].bonds].filter(r=>r.nation===e).reduce((r,s)=>r+s.number,0);if(this.nations.get(e).treasury>i)this.players[this.currentPlayerName].cash+=i,this.nations.get(e).treasury-=i,this.annotatedLog.push(C.nationPaysPlayer({player:this.currentPlayerName,nation:e,amount:i}));else{const r=this.nations.get(e).treasury;this.players[this.currentPlayerName].cash+=r,this.nations.get(e).treasury-=r,this.annotatedLog.push(C.nationPaysPlayer({player:this.currentPlayerName,nation:e,amount:r}))}this.variant==="withoutInvestorCard"?this.roundOfInvestment():(this.investorCardActive=!0,this.middleOfInvestorTurn(),this.passingThroughInvestor=!1)}importRondel(t){const e=new Set([C.import({placements:[]})]),r=[...this.board.byNation.get(t.payload.nation)].filter(c=>{let u=!0;for(const[f]of this.nations)f!==t.payload.nation&&this.units.get(f).get(c).armies>0&&(u=!1);return u}),{treasury:s}=this.nations.get(t.payload.nation);s<3?this.maxImports=s:this.maxImports=3;for(const c of r){s>=1&&(this.overUnitLimit(t.payload.nation,"army",1)||e.add(C.import({placements:[{province:c,type:"army"}]})),this.board.graph.get(c).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",1)&&e.add(C.import({placements:[{province:c,type:"fleet"}]})));for(const u of r){s>=2&&(this.overUnitLimit(t.payload.nation,"army",2)||e.add(C.import({placements:[{province:c,type:"army"},{province:u,type:"army"}]})),this.board.graph.get(c).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",1)&&!this.overUnitLimit(t.payload.nation,"army",1)&&e.add(C.import({placements:[{province:c,type:"fleet"},{province:u,type:"army"}]})),this.board.graph.get(u).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",1)&&!this.overUnitLimit(t.payload.nation,"army",1)&&e.add(C.import({placements:[{province:c,type:"army"},{province:u,type:"fleet"}]})),this.board.graph.get(c).factoryType==="shipyard"&&this.board.graph.get(u).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",2)&&e.add(C.import({placements:[{province:c,type:"fleet"},{province:u,type:"fleet"}]})));for(const f of r)s>=3&&(this.overUnitLimit(t.payload.nation,"army",3)||e.add(C.import({placements:[{province:c,type:"army"},{province:u,type:"army"},{province:f,type:"army"}]})),this.board.graph.get(c).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",1)&&!this.overUnitLimit(t.payload.nation,"army",2)&&e.add(C.import({placements:[{province:c,type:"fleet"},{province:u,type:"army"},{province:f,type:"army"}]})),this.board.graph.get(u).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",1)&&!this.overUnitLimit(t.payload.nation,"army",2)&&e.add(C.import({placements:[{province:c,type:"army"},{province:u,type:"fleet"},{province:f,type:"army"}]})),this.board.graph.get(f).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",1)&&!this.overUnitLimit(t.payload.nation,"army",2)&&e.add(C.import({placements:[{province:c,type:"army"},{province:u,type:"army"},{province:f,type:"fleet"}]})),this.board.graph.get(c).factoryType==="shipyard"&&this.board.graph.get(u).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",2)&&!this.overUnitLimit(t.payload.nation,"army",1)&&e.add(C.import({placements:[{province:c,type:"fleet"},{province:u,type:"fleet"},{province:f,type:"army"}]})),this.board.graph.get(c).factoryType==="shipyard"&&this.board.graph.get(f).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",2)&&!this.overUnitLimit(t.payload.nation,"army",1)&&e.add(C.import({placements:[{province:c,type:"fleet"},{province:u,type:"army"},{province:f,type:"fleet"}]})),this.board.graph.get(u).factoryType==="shipyard"&&this.board.graph.get(f).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",2)&&!this.overUnitLimit(t.payload.nation,"army",1)&&e.add(C.import({placements:[{province:c,type:"army"},{province:u,type:"fleet"},{province:f,type:"fleet"}]})),this.board.graph.get(c).factoryType==="shipyard"&&this.board.graph.get(u).factoryType==="shipyard"&&this.board.graph.get(f).factoryType==="shipyard"&&!this.overUnitLimit(t.payload.nation,"fleet",3)&&e.add(C.import({placements:[{province:c,type:"fleet"},{province:u,type:"fleet"},{province:f,type:"fleet"}]})))}}for(const c of e)this.availableActions.add(c);this.importing=!0}collectUnitsToMove(t){this.unitsToMove=[];for(const[e,i]of this.units.get(t.payload.nation)){let r=i.fleets,s=i.armies;for(;r>0||s>0;)r>0?(this.unitsToMove.push([e,"fleet"]),r-=1):s>0&&(this.unitsToMove.push([e,"army"]),s-=1)}}checkForNewFights(){this.unitsToMove.forEach(([t,e])=>{for(const[i]of this.nations){const{armies:r,fleets:s}=this.units.get(i).get(t);(r>0||s>0)&&i!==this.currentNation&&this.availableActions.add(C.fight({province:t,incumbent:i,challenger:this.currentNation,targetType:e}))}})}flagCount(t){let e=0;for(const[,{flag:i}]of this.provinces)i===t&&(e+=1);return e}middleOfInvestorTurn(){this.previousPlayerName=this.currentPlayerName,this.currentPlayerName=this.investorCardHolder,this.players[this.investorCardHolder].cash+=2,this.annotatedLog.push(C.playerInvests({player:this.investorCardHolder})),this.endOfInvestorTurn(this.investorCardHolder)}endOfInvestorTurn(t){if(this.previousPlayerName=this.currentPlayerName,this.currentPlayerName=t,this.variant==="withoutInvestorCard"){for(const e of Ae(this.currentNation,this))this.availableActions.add(e);this.investing=!0,this.firstInvestor=this.currentPlayerName}else{for(const e of this.availableActions)(e.type==="bondPurchase"||e.type==="skipBondPurchase")&&this.availableActions.delete(e);for(const e of this.bondPurchasesFromAllNations())this.availableActions.add(e)}}bondPurchasesFromAllNations(){const t=new Set;for(const[e]of this.nations)for(const i of Ae(e,this))t.add(i);for(const e of t)e.type==="skipBondPurchase"&&e.payload.nation&&t.delete(e);return t.add(C.skipBondPurchase({player:this.currentPlayerName,nation:null})),t}playerBondsOfNation(t,e){const i=[];for(const r of this.players[t].bonds)r.nation===e&&i.push(r);return i}handleAdvancePlayer(){this.previousPlayerName=this.currentPlayerName,this.currentNation=this.nextNation(this.currentNation),this.currentPlayerName=this.nations.get(this.currentNation).controller}totalInvestmentInNation(t,e){return this.players[t]?[...this.players[t].bonds].filter(i=>i.nation===e).reduce((i,r)=>i+r.cost,0):0}advanceInvestorCard(){if(this.investorCardHolder){const t=this.investorCardHolder,e=this.order.indexOf(this.investorCardHolder);e===this.order.length-1?this.investorCardHolder=this.order[0]:this.investorCardHolder=this.order[e+1],this.annotatedLog.push(C.investorCardHolderChanged({oldInvestorCardHolder:t,newInvestorCardHolder:this.investorCardHolder}))}}unitCount(t){return this.armyCount(t)+this.fleetCount(t)}armyCount(t){let e=0;for(const[,i]of this.units.get(t))e+=i.armies;return e}fleetCount(t){let e=0;for(const[,i]of this.units.get(t))e+=i.fleets;return e}overUnitLimit(t,e,i){return e==="army"?this.armyCount(t)+i>this.unitLimits.get(t).armies:this.fleetCount(t)+i>this.unitLimits.get(t).fleets}availableRondelActions(t){const e=I(this,X).nationIdToEntity(t),{availableSlots:i}=I(this,we),r=new Set,s=i.nextAvailableFreeRondelSlots(e.residingRondelSlot);for(const c of s)r.add(C.rondel({nation:t,cost:0,slot:c.id}));if(e.residingRondelSlot){const c=I(this,we).slotDistanceCosts.costPerPaidRondelSlot(e),{cash:u}=this.players[this.currentPlayerName];for(const[f,m]of i.nextAvailablePaidRondelSlots(e.residingRondelSlot,c))m<=u&&r.add(C.rondel({nation:t,cost:m,slot:f.id}))}return r}nextNation(t){let e;return this.baseGame==="imperial"?e=t.when({AH:()=>k.IT,IT:()=>k.FR,FR:()=>k.GB,GB:()=>k.GE,GE:()=>k.RU,RU:()=>k.AH}):this.baseGame==="imperial2030"?e=t.when({RU:()=>N.CN,CN:()=>N.IN,IN:()=>N.BR,BR:()=>N.US,US:()=>N.EU,EU:()=>N.RU}):this.baseGame==="imperialAsia"&&(e=t.when({CN:()=>v.JP,JP:()=>v.FR,FR:()=>v.GB,GB:()=>v.TR,TR:()=>v.RU,RU:()=>v.GE,GE:()=>v.CN})),this.nations.get(e).controller?e:this.nextNation(e)}importAction(t){const e=new Set;for(const i of this.board.byNation.get(t))this.board.graph.get(i).factoryType==="shipyard"&&e.add(C.import({placements:[{province:i,unit:"fleet"}]})),e.add(C.import({placements:[{province:i,unit:"army"}]}));return e}unoccupiedFactoryCount(t){return this.unoccupiedFactories(t).length}unoccupiedFactories(t){const e=[];for(const i of this.board.byNation.get(t))this.provinces.get(i).factory&&this.nobodyIsOccupying(i,t)&&e.push(i);return e}nobodyIsOccupying(t,e){let i=!0;for(const[r]of this.units)if(r!==e){const{armies:s,friendly:c}=this.units.get(r).get(t);s>0&&!c&&(i=!1)}return i}nationsUnderControl(t){const e=[];for(const[i,r]of this.nations)r.controller===t&&e.push(i.value);return e}hasNotBoughtABondThisTurn(t){let e=!0;const i=this.log.slice().reverse();for(const r of i){if(r.type==="rondel")break;r.payload&&r.payload.player===t&&(r.type==="bondPurchase"||r.type==="skipBondPurchase")&&(e=!1)}return e}allowSwissBanksToForceInvestor(){const t=this.order.indexOf(this.investorCardHolder);this.swissBanks.sort((i,r)=>{const s=this.order.indexOf(i),c=this.order.indexOf(r);return t===0?s>c?1:-1:s-t+1>c-t+1?1:-1}).forEach(i=>{this.swissBanksWhoDoNotInterrupt.includes(i)||(this.currentPlayerName=i,this.availableActions.add(C.forceInvestor({player:i})),this.availableActions.add(C.skipForceInvestor({player:i})))})}canAffordToPayInvestors(t){let e=0;for(const i of Object.keys(this.players))for(const r of this.playerBondsOfNation(i,t))e+=r.number;return e<=this.nations.get(t).treasury}occupiedHomeProvinces(t){const e=[];if(this.board.byNation.get(t))for(const i of this.board.byNation.get(t))this.provinceIsOccupied(i,t)&&e.push(i);return e}provinceIsOccupied(t,e){let i=!1;for(const[r]of this.nations){const s=this.units.get(r).get(t);s.armies>0&&r!==e&&s.friendly===!1&&(i=!0)}return i}updateRawScores(){Object.keys(this.players).forEach(t=>{let e=0;for(const i of this.players[t].bonds){const{powerPoints:r}=this.nations.get(i.nation);e+=i.number*Math.floor(r/5)}this.players[t].rawScore=e})}initializeUnits(t){var i;const e=new Map;for(const[r,s]of t){for(const[c,u]of s)(i=this.board.byNation.get(r))!=null&&i.has(c)&&s.set(c,{...u,friendly:!0});e.set(r,s)}return e}roundOfInvestment(){this.investing=!0,this.firstInvestor=this.currentPlayerName;for(const t of Ae(this.currentNation,this))this.availableActions.add(t);for(;this.availableActions.size<=1&&this.investing;){this.annotatedLog.push(C.playerAutoSkipsBondPurchase({player:this.currentPlayerName,bondNation:this.currentNation}));const t=this.order.indexOf(this.currentPlayerName);if(this.currentPlayerName=this.order[t+1]||this.order[0],this.currentPlayerName===this.firstInvestor){this.investing=!1;for(const e in this.players)this.checkForSwissBank(e);this.handleAdvancePlayer(),this.advanceInvestorCard();for(const e of this.availableRondelActions(this.currentNation))this.availableActions.add(e);return}if(this.swissBanks.includes(this.currentPlayerName))for(const e of this.bondPurchasesFromAllNations())this.availableActions.add(e);else for(const e of Ae(this.currentNation,this))this.availableActions.add(e)}}handlePassingThroughInvestor(){if(this.passingThroughInvestor)this.variant!=="withoutInvestorCard"?this.middleOfInvestorTurn():this.roundOfInvestment(),this.passingThroughInvestor=!1;else if(this.variant==="withoutInvestorCard")this.roundOfInvestment();else{this.handleAdvancePlayer();for(const t of this.availableRondelActions(this.currentNation))this.availableActions.add(t)}}adjudicateFlags(){var s;const t=this.log.slice().reverse();let e=0,i=t[e];const r=[];for(;i.type!=="rondel";){const c=(s=i.payload)==null?void 0:s.origin;c&&r.push(c),e+=1,i=t[e]}r.forEach(c=>{this.updateFlag(c)})}updateFlag(t){if(this.unitsToMove.length===0){const e=this.provinces.get(t).flag===this.currentNation,i=this.units.get(this.currentNation).get(t).armies,r=this.units.get(this.currentNation).get(t).fleets;if(e&&i===0&&r===0){const s=[];for(const[c]of this.nations){const u=this.units.get(c).get(t).armies,f=this.units.get(c).get(t).fleets;(u>0||f>0)&&s.push(c)}s.length===1&&(this.provinces.get(t).flag=s[0])}}}taxRevenueOf(t){const e=this.unoccupiedFactoryCount(t)*2+this.flagCount(t);if(this.baseGame==="imperial"){if(e>20)return 20}else if((this.baseGame==="imperial2030"||this.baseGame==="imperialAsia")&&e>23)return 23;return e}getTaxChartPosition(t){return this.baseGame==="imperial"?t>=15?15:t>=5?t:5:0}powerPointsGainedFrom(t){let e=0;return this.baseGame==="imperial"?e=Math.min(Math.max(0,t-5),10):(this.baseGame==="imperial2030"||this.baseGame==="imperialAsia")&&(e={0:0,1:0,2:0,3:0,4:0,5:0,6:1,7:1,8:2,9:2,10:3,11:4,12:5,13:6,14:7,15:8,16:9,17:9,18:10,19:10,20:10,21:10,22:10,23:10}[t]),e}playerBonusBeforeUnitMaintenanceCosts(t,e){let i=0;return this.baseGame==="imperial"?i=Math.max(0,this.getTaxChartPosition(e)-this.nations.get(t).taxChartPosition):(this.baseGame==="imperial2030"||this.baseGame==="imperialAsia")&&(i={0:0,1:0,2:0,3:0,4:0,5:0,6:1,7:1,8:1,9:1,10:2,11:2,12:3,13:3,14:4,15:4,16:5,17:5,18:5,19:5,20:5,21:5,22:5,23:5}[e]),i}unitMaintenanceCosts(t){return this.unitCount(t)}playerBonusAfterUnitMaintenanceCosts(t,e){let i=this.playerBonusBeforeUnitMaintenanceCosts(t,e);if(this.baseGame==="imperial2030"||this.baseGame==="imperialAsia"){const s=this.nations.get(t).treasury+e-this.unitMaintenanceCosts(t);i=Math.max(0,Math.min(i,s))}return i}nationTaxationProfit(t,e){let i=0,r=0;return(this.baseGame==="imperial2030"||this.baseGame==="imperialAsia")&&(i=this.playerBonusAfterUnitMaintenanceCosts(t,e),r=-this.nations.get(t).treasury),Math.max(r,e-this.unitMaintenanceCosts(t)-i)}static isEqual(t,e){return t.type!==e.type?!1:t.payload&&e.payload?t.type==="import"&&e.type==="import"?ct.arraysAreEqual(t.payload.placements,e.payload.placements):t.type==="buildFactory"&&e.type==="buildFactory"?t.payload.province===e.payload.province:Object.keys(t.payload).every(i=>t.payload[i]===e.payload[i]||i==="tradeInValue"):!0}static arraysAreEqual(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i+=1)if(!Object.keys(t[i]).every(s=>t[i][s]===e[i][s]))return!1;return!0}};let Ne=ct;_e=new WeakMap,X=new WeakMap,ue=new WeakMap,we=new WeakMap,he=new WeakMap,Qe=new WeakMap,lt=new WeakSet,zt=function(t){var e;if(t.type==="rondel"||t.type==="bondPurchase"||t.type==="skipBondPurchase"){I(this,ue).addUndoCheckpoint();const i=mn(this);if(this.oldState={...this,...i},(e=this.auction)!=null&&e.inAuction){const r=fn(this.auction);this.oldAuctionState={...this.auction,...r}}}};const Tn={xmlns:"http://www.w3.org/2000/svg",width:"7.951",height:"9.087",viewBox:"0 0 45.889 57.001"},An=A("path",{d:"M2.18 20.407a2 2 0 0 0-2 2v33.956a2 2 0 0 0 2 2h41.89a2 2 0 0 0 2-2v-23.19l-11.99 4.734v-4.734l-11.991 4.734v-4.869l-11.99 4.735V22.407a2 2 0 0 0-2-2zm4.8 25.346h2.728c.907 0 1.635.73 1.635 1.637v2.726c0 .907-.728 1.637-1.635 1.637H6.979c-.906 0-1.636-.73-1.636-1.637V47.39c0-.907.73-1.637 1.636-1.637zm10 0h2.728c.907 0 1.635.73 1.635 1.637v2.726c0 .907-.728 1.637-1.635 1.637h-2.729c-.906 0-1.636-.73-1.636-1.637V47.39c0-.907.73-1.637 1.636-1.637zm10 0h2.728c.907 0 1.635.73 1.635 1.637v2.726c0 .907-.728 1.637-1.635 1.637h-2.729c-.906 0-1.636-.73-1.636-1.637V47.39c0-.907.73-1.637 1.636-1.637zm10 0h2.728c.907 0 1.635.73 1.635 1.637v2.726c0 .907-.728 1.637-1.635 1.637h-2.729c-.906 0-1.636-.73-1.636-1.637V47.39c0-.907.73-1.637 1.636-1.637zM25.828 1.362a6.805 6.805 0 0 0-5.761 3.188 7.623 7.623 0 0 0-5.003-1.882A7.623 7.623 0 0 0 7.833 7.91a5.536 5.536 0 0 0-1.57-.232 5.536 5.536 0 0 0-5.535 5.536 5.536 5.536 0 0 0 5.535 5.537 5.536 5.536 0 0 0 4.43-2.225 7.623 7.623 0 0 0 4.372 1.39 7.622 7.622 0 0 0 3.867-1.065c.716.458 1.547.701 2.397.701a4.447 4.447 0 0 0 4.035-2.595 6.806 6.806 0 1 0 .465-13.595z"},null,-1),Nn=[An];function Pn(a,t){return _(),R("svg",Tn,Nn)}const In={render:Pn},Bn={name:"Flag",props:{filter:{type:String,default:""},fleet:Boolean,height:{type:String,default:""},nation:{type:String,default:""},friendly:Boolean,transform:{type:String,default:""},width:{type:String,default:""},x:{type:Number,default:0},y:{type:Number,default:0}},data:()=>({flags:{AH:Q(K(()=>$(()=>import("./AHFlag-80b93953.js"),["assets/AHFlag-80b93953.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),BR:Q(K(()=>$(()=>import("./BRFlag-3c35bcf3.js"),["assets/BRFlag-3c35bcf3.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),CN:Q(K(()=>$(()=>import("./CNFlag-5950dc7a.js"),["assets/CNFlag-5950dc7a.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),CNAsia:Q(K(()=>$(()=>import("./CNAsiaFlag-b38f4cf4.js"),["assets/CNAsiaFlag-b38f4cf4.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),EU:Q(K(()=>$(()=>import("./EUFlag-26f93781.js"),["assets/EUFlag-26f93781.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),IN:Q(K(()=>$(()=>import("./INFlag-19995b28.js"),["assets/INFlag-19995b28.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),IT:Q(K(()=>$(()=>import("./ITFlag-039747ad.js"),["assets/ITFlag-039747ad.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),JP:Q(K(()=>$(()=>import("./JPFlag-d438d630.js"),["assets/JPFlag-d438d630.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),FR:Q(K(()=>$(()=>import("./FRFlag-b8ee0fa7.js"),["assets/FRFlag-b8ee0fa7.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),GB:Q(K(()=>$(()=>import("./GBFlag-5b529a79.js"),["assets/GBFlag-5b529a79.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),GE:Q(K(()=>$(()=>import("./GEFlag-37a63773.js"),["assets/GEFlag-37a63773.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),RU:Q(K(()=>$(()=>import("./RUFlag-f270a13b.js"),["assets/RUFlag-f270a13b.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),TR:Q(K(()=>$(()=>import("./TRFlag-4f6d0804.js"),["assets/TRFlag-4f6d0804.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]))),US:Q(K(()=>$(()=>import("./USFlag-7fa47316.js"),["assets/USFlag-7fa47316.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"])))}}),computed:{activeFilter(){return this.filter==="grayscale"?"url(#grayscale)":""}}},Cn=["transform"],xn=["x","y"];function Sn(a,t,e,i,r,s){return _(),R("g",{transform:e.transform},[(_(),B(Ut(a.flags[e.nation]),{width:e.width,height:e.height,transform:e.transform,x:e.x,y:e.y,fleet:e.fleet,filter:s.activeFilter},null,8,["width","height","transform","x","y","fleet","filter"])),e.friendly?(_(),R("rect",{key:0,x:e.x+3,y:e.y+2,width:7,height:4,fill:"white",stroke:"none"},null,8,xn)):E("",!0)],8,Cn)}const Se=W(Bn,[["render",Sn]]),Fn={name:"Province",components:{Factory:In,Flag:Se},props:{adjustments:{type:Object,default:()=>{}},buildingFactory:Boolean,dot:{type:String,default:""},factory:{type:String,default:""},factoryType:{type:String,default:""},fontSize:{type:String,default:"8"},importingUnits:{type:Array,default:()=>[]},isImpassable:Boolean,isValid:Boolean,name:{type:String,default:""},nationColor:{type:String,default:""},province:{type:Object,default:()=>{}},selectProvince:{type:Function,default:()=>{}},armies:{type:Array,default:()=>[]},fleets:{type:Array,default:()=>[]},provinceWithFight:Boolean},emits:["fightResolved"],data:()=>({mounted:!1,originalFill:"",tempFactory:!1}),computed:{importingArmies(){return this.importingUnits?this.importingUnits.filter(a=>a.type==="army"):[]},importingFleets(){return this.importingUnits?this.importingUnits.filter(a=>a.type==="fleet"):[]}},mounted(){this.mounted=!0,this.originalFill=this.$refs.province.children[0].children[0].getAttribute("fill")},updated(){const{province:a}=this.$refs,t=[...a.children].find(e=>e.nodeName==="path");a.prepend(t,a.children[0]),this.isValid?this.$refs.province.children[0].classList.add("hoverable"):this.$refs.province.children[0].classList.remove("hoverable"),this.provinceWithFight&&(this.$refs.province.children[0].children[0].animate([{fill:"#EF4400"},{fill:this.originalFill}],{duration:2e3,iterations:1}),this.$emit("fightResolved"))},methods:{availableArmies(){return this.mounted?this.armies:[]},availableFleets(){return this.mounted?this.fleets:[]},flagX(a){var t;return a*2.5+this.$refs.province.children[0].getBBox().x+this.$refs.province.children[0].getBBox().width/2+(((t=this.adjustments)==null?void 0:t.flagX)||0)},flagY(a){var t;return a*2.5+this.$refs.province.children[0].getBBox().y+this.$refs.province.children[0].getBBox().height/2+(((t=this.adjustments)==null?void 0:t.flagY)||0)},fill(a){return a==="shipyard"?"blue":"brown"},showFactory(){this.isValid&&this.buildingFactory&&(this.tempFactory=this.factoryType)},hideFactory(){this.tempFactory=""}}},Rn=["font-size","x","y"],On=["cx","cy","fill"],En=["cx","cy"],Gn=["x","y"];function Mn(a,t,e,i,r,s){var f,m,h,n,o,l,d,y,b,g;const c=P("Factory"),u=P("Flag");return _(),R("g",{ref:"province",onClick:t[0]||(t[0]=w=>e.selectProvince(e.name)),onMouseover:t[1]||(t[1]=w=>s.showFactory()),onMouseleave:t[2]||(t[2]=w=>s.hideFactory())},[(_(),B(Ut(e.province))),a.mounted&&!e.isImpassable?(_(),R("text",{key:0,"font-size":e.fontSize,"font-weight":"100",stroke:"#303030","text-align":"center",x:s.flagX(0)+(((f=e.adjustments)==null?void 0:f.labelX)||0),y:s.flagY(0)+(((m=e.adjustments)==null?void 0:m.labelY)||0),"text-anchor":"middle","alignment-baseline":"central",class:"font-sans"},F(e.name),9,Rn)):E("",!0),e.dot&&a.mounted?(_(),R("circle",{key:1,cx:s.flagX(0)+6+(((h=e.adjustments)==null?void 0:h.dotX)||0),cy:s.flagY(0)-5+(((n=e.adjustments)==null?void 0:n.dotY)||0),r:"3",fill:e.nationColor},null,8,On)):E("",!0),e.factoryType==="shipyard"&&a.mounted?(_(),R("circle",{key:2,cx:s.flagX(0)-6+(((o=e.adjustments)==null?void 0:o.factoryX)||0),cy:s.flagY(0)+5+(((l=e.adjustments)==null?void 0:l.factoryY)||0),r:"8","fill-opacity":"0.4",fill:"blue",stroke:"none"},null,8,En)):e.factoryType==="armaments"&&a.mounted?(_(),R("rect",{key:3,width:"12",height:"12",x:s.flagX(0)-12+(((d=e.adjustments)==null?void 0:d.factoryX)||0),y:s.flagY(0)-1+(((y=e.adjustments)==null?void 0:y.factoryY)||0),"fill-opacity":"0.4",fill:"brown",stroke:"none"},null,8,Gn)):E("",!0),(e.factory||a.tempFactory)&&a.mounted?(_(),B(c,{key:4,type:e.factory,x:s.flagX(0)-10+(((b=e.adjustments)==null?void 0:b.factoryX)||0),y:s.flagY(0)+(((g=e.adjustments)==null?void 0:g.factoryY)||0),fill:s.fill(e.factory||a.tempFactory),stroke:"white","stroke-width":"2px","fill-opacity":a.tempFactory?.3:1},null,8,["type","x","y","fill","fill-opacity"])):E("",!0),(_(!0),R(V,null,z(s.availableFleets(),(w,S)=>{var M,q;return _(),B(u,{key:w+S+"F",nation:w,x:s.flagX(S)+(((M=e.adjustments)==null?void 0:M.flagFleetX)||0),y:s.flagY(S)+10+(((q=e.adjustments)==null?void 0:q.flagFleetY)||0),fleet:!0,width:"21",height:"11"},null,8,["nation","x","y"])}),128)),(_(!0),R(V,null,z(s.availableArmies(),(w,S)=>{var M,q;return _(),B(u,{key:w.nation+S+"A",nation:w.nation,friendly:w.friendly,x:s.flagX(S)+(((M=e.adjustments)==null?void 0:M.flagArmyX)||0),y:s.flagY(S)+(((q=e.adjustments)==null?void 0:q.flagArmyY)||0),width:"13",height:"8"},null,8,["nation","friendly","x","y"])}),128)),(_(!0),R(V,null,z(s.importingArmies,(w,S)=>(_(),B(u,{key:w.nation+S+"A",nation:w.nation,x:s.flagX(S),y:s.flagY(S),filter:"grayscale",width:"13",height:"8"},null,8,["nation","x","y"]))),128)),(_(!0),R(V,null,z(s.importingFleets,(w,S)=>{var M,q;return _(),B(u,{key:w.nation+S+"F",nation:w.nation,x:s.flagX(S)+(((M=e.adjustments)==null?void 0:M.flagFleetX)||0),y:s.flagY(S)+10+(((q=e.adjustments)==null?void 0:q.flagFleetY)||0),fleet:!0,filter:"grayscale",width:"21",height:"11"},null,8,["nation","x","y"])}),128))],544)}const Un=W(Fn,[["render",Mn]]),jn={name:"Board",components:{Province:Un},props:{config:{type:Object,default:()=>{}},game:{type:Object,default:()=>{}},profile:{type:Object,default:()=>{}},gameStarted:Boolean,unitsToImport:{type:Array,default:()=>[]},paused:Boolean,provinceWithFight:{type:String,default:""},selectProvince:{type:Function,default:()=>{}},validProvinces:{type:Array,default:()=>[]}},emits:["fightResolved"],methods:{armies(a){const t=[];for(const[e,i]of this.allUnits())for(const[r,s]of i){const c=a.replace(/\.*\s/gm,"").toLowerCase();if(c===e)for(let u=0;u<s.armies;u+=1){let f=!1;for(const[n,o]of this.game.board.byNation)(n==null?void 0:n.value)!==r&&o.has(c)&&(f=!0);const m=s.friendly&&f;let h=r;h==="CN"&&this.game.baseGame==="imperialAsia"&&(h="CNAsia"),t.push({nation:h,friendly:m})}}return t},buildingFactory(){return this.paused?!1:this.game.availableActions?[...this.game.availableActions].every(a=>a.type==="buildFactory"||a.type==="skipBuildFactory"):!1},dot(a){let t;return this.dots().forEach(e=>{a.replace(/\.*\s/gm,"").toLowerCase()===e.normalizedProvince&&(t=e.flag.value)}),t},dots(){if(!this.gameStarted)return[];const a=[];for(const[t,e]of this.game.provinces){const{flag:i}=e;if(i){const r=t.replace(/\.*\s/gm,"").toLowerCase();a.push({normalizedProvince:r,flag:i})}}return a},factories(){if(!this.gameStarted)return[];const a=[];for(const[t,e]of this.game.provinces){const i=t.replace(/\.*\s/gm,"").toLowerCase();a.push({normalizedProvince:i,type:e.factory})}return a},factory(a){const t=this.factories().find(e=>{const i=a.replace(/\.*\s/gm,"").toLowerCase();return e.normalizedProvince===i});return t?t.type:""},factoryType(a){if(this.game.board&&!["Corsica","Sardinia","Switzerland"].includes(a)){const t=a.replace(/\.*\s/gm,"").toLowerCase();return this.game.board.graph.get(t).factoryType}return""},fleets(a){if(!this.gameStarted)return[];const t=[];for(const[e,i]of this.allUnits())for(const[r,s]of i)if(a.replace(/\.*\s/gm,"").toLowerCase()===e)for(let u=0;u<s.fleets;u+=1){let f=r;f==="CN"&&this.game.baseGame==="imperialAsia"&&(f="CNAsia"),t.push(f)}return t},importingUnits(a){if(this.paused)return[];const t=a.replace(/\.*\s/gm,"").toLowerCase();return this.gameStarted?this.unitsToImport.filter(e=>e.province===t):[]},isImpassable(a){const t=["Sardinia","Corsica","Switzerland","Caspian Sea"];return this.game.baseGame==="imperial2030"&&t.push("Black Sea"),t.includes(a)},isValid(a){if(this.paused)return!1;const t=a.replace(/\.*\s/gm,"").toLowerCase();return!!(this.validProvinces.includes(t)&&this.profile.username in this.game.players)},allUnits(){if(!this.gameStarted)return new Map;const a=new Map;for(const[t,e]of this.game.units)for(const[i,r]of e){const s=i.replace(/\.*\s/gm,"").toLowerCase(),c=new Map;(r.armies>0||r.fleets>0)&&(c.set(t.value,r),a.get(s)?a.set(s,new Set([...c,...a.get(s)])):a.set(s,c))}return a}}},Hn=["viewBox"],Ln=A("filter",{id:"brightness"},[A("feComponentTransfer",null,[A("feFuncR",{type:"linear",slope:"2"}),A("feFuncG",{type:"linear",slope:"2"}),A("feFuncB",{type:"linear",slope:"2"})])],-1),Dn=A("clipPath",{id:"fleetClip"},[A("circle",{cx:"750",cy:"500",r:"500"})],-1),Vn=A("clipPath",{id:"fleetClipBR"},[A("circle",{cx:"325",cy:"250",r:"250"})],-1),zn=A("clipPath",{id:"fleetClipTR"},[A("circle",{cx:"500",cy:"400",r:"400"})],-1),Wn=A("clipPath",{id:"fleetClipCNAsia"},[A("circle",{cx:"300",cy:"250",r:"250"})],-1),qn={stroke:"#000000","stroke-width":"0.5"};function Jn(a,t,e,i,r,s){const c=P("Province"),u=P("v-col"),f=P("v-row");return _(),B(f,null,{default:p(()=>[T(u,null,{default:p(()=>[(_(),R("svg",{"xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:cc":"http://creativecommons.org/ns#","xmlns:rdf":"http://www.w3.org/1999/02/22-rdf-syntax-ns#","xmlns:svg":"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:e.config.viewBox},[Ln,Dn,Vn,zn,Wn,A("g",qn,[(_(!0),R(V,null,z(e.config.seaProvinces,(m,h)=>(_(),B(c,{key:h,province:m,name:h,"select-province":e.selectProvince,fleets:s.fleets(h),"is-valid":s.isValid(h),dot:s.dot(h),"province-with-fight":e.provinceWithFight===h.toString().replace(/\.*\s/gm,"").toLowerCase(),adjustments:e.config.adjustments[h],"nation-color":e.config.nationColors[s.dot(h)],"is-impassable":s.isImpassable(h),"font-size":e.game.baseGame==="imperialAsia"?"13":"8",onFightResolved:t[0]||(t[0]=n=>a.$emit("fightResolved"))},null,8,["province","name","select-province","fleets","is-valid","dot","province-with-fight","adjustments","nation-color","is-impassable","font-size"]))),128)),(_(!0),R(V,null,z(e.config.landProvinces,(m,h)=>(_(),B(c,{key:h,province:m,name:h,"select-province":e.selectProvince,fleets:s.fleets(h),armies:s.armies(h),"importing-units":s.importingUnits(h),"is-valid":s.isValid(h),dot:s.dot(h),"building-factory":s.buildingFactory(),factory:s.factory(h),"factory-type":s.factoryType(h),"province-with-fight":e.provinceWithFight===h.toString().replace(/\.*\s/gm,"").toLowerCase(),adjustments:e.config.adjustments[h],"nation-color":e.config.nationColors[s.dot(h)],"is-impassable":s.isImpassable(h),"font-size":e.game.baseGame==="imperialAsia"?"13":"8",onFightResolved:t[1]||(t[1]=n=>a.$emit("fightResolved"))},null,8,["province","name","select-province","fleets","armies","importing-units","is-valid","dot","building-factory","factory","factory-type","province-with-fight","adjustments","nation-color","is-impassable","font-size"]))),128))])],8,Hn))]),_:1})]),_:1})}const Xn=W(jn,[["render",Jn]]),Yn={name:"Bond",components:{Flag:Se},props:{toggleTradeIn:{type:Function,default:()=>{}},tradedInValue:{type:Number,default:0},bond:{type:Object,default:()=>{}},isBeingAppliedToTradeIn:Boolean,filter:{type:String,default:""},canBePurchased:Boolean},emits:["click"],computed:{nation(){return this.bond.nation.value==="CN"&&this.bond.nation.label==="NationAsia"?"CNAsia":this.bond.nation.value},tooltipText(){return this.canBePurchased&&!this.isBeingAppliedToTradeIn?`Purchase for ${this.bond.cost}m.`:this.canBePurchased&&this.isBeingAppliedToTradeIn?`Purchase for ${this.bond.cost-this.tradedInValue} m plus the ${this.tradedInValue}m bond.`:""}},methods:{backgroundColor(){return this.bond.nation.value==="GE"&&this.bond.nation.label==="NationAsia"?"GEAsia":this.bond.nation.value}}},Zn={class:"d-flex justify-center"};function Qn(a,t,e,i,r,s){const c=P("Flag"),u=P("v-col"),f=P("v-row"),m=P("v-sheet"),h=P("v-tooltip");return _(),B(h,{disabled:!e.canBePurchased,text:s.tooltipText},{activator:p(({props:n})=>[T(m,$e({class:"d-inline-block mx-2 px-2 py-2",color:s.backgroundColor(),elevation:e.isBeingAppliedToTradeIn?10:0,rounded:"",style:e.filter==="grayscale"?{filter:"grayscale(1)"}:{}},n,{onClick:t[0]||(t[0]=o=>a.$emit("click",e.bond))}),{default:p(()=>[T(f,null,{default:p(()=>[T(u,null,{default:p(()=>[T(c,{nation:s.nation,width:"30",height:"20"},null,8,["nation"])]),_:1})]),_:1}),A("div",Zn,F(e.bond.number)+":"+F(e.bond.cost),1)]),_:2},1040,["color","elevation","style"])]),_:1},8,["disabled","text"])}const Pt=W(Yn,[["render",Qn]]),$n={name:"AvailableBonds",components:{Bond:Pt},props:{game:{type:Object,default:()=>{}}},data(){return{dialog:!1}}};function Kn(a,t,e,i,r,s){const c=P("v-btn"),u=P("v-card-title"),f=P("Bond"),m=P("v-col"),h=P("v-row"),n=P("v-card-text"),o=P("v-card-actions"),l=P("v-card"),d=P("v-dialog");return _(),B(d,{modelValue:r.dialog,"onUpdate:modelValue":t[1]||(t[1]=y=>r.dialog=y),width:"50%"},{activator:p(({props:y})=>[T(c,$e({color:"primary"},y),{default:p(()=>[x(" Available bonds ")]),_:2},1040)]),default:p(()=>[T(l,null,{default:p(()=>[T(u,null,{default:p(()=>[x("Available Bonds")]),_:1}),T(n,null,{default:p(()=>[T(h,null,{default:p(()=>[(_(!0),R(V,null,z(e.game.availableBonds,y=>(_(),B(m,{key:y.nation+y.cost},{default:p(()=>[T(f,{bond:y},null,8,["bond"])]),_:2},1024))),128))]),_:1})]),_:1}),T(o,null,{default:p(()=>[T(c,{color:"primary-darken-1",block:"",onClick:t[0]||(t[0]=y=>r.dialog=!1)},{default:p(()=>[x(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const ea=W($n,[["render",Kn]]),ta={name:"BondPurchase",components:{Bond:Pt},props:{game:{type:Object,default:()=>{}},currentPlayer:{type:String,default:""},profile:{type:Object,default:()=>{}},tradedInBondNation:{type:String,default:""},tradedInValue:{type:Number,default:0}},emits:["purchaseBond","skip","toggleTradeIn"],data(){return{dialog:!0}},computed:{upgradeableBonds(){var t;const a=[];for(const e of this.game.players[this.currentPlayer].bonds){let i=!1;for(const r of this.game.availableActions)((t=r.payload)==null?void 0:t.nation)===e.nation&&(i=!0);this.game.players[this.currentPlayer].bonds.has(e)&&i&&a.push(e)}return a}},methods:{canBePurchased(a){let t=!1;for(const e of this.game.availableActions)e.payload.cost===a.cost&&e.payload.nation===a.nation&&(this.tradedInValue>0?e.payload.tradeInValue===this.tradedInValue&&e.payload.nation.value===this.tradedInBondNation&&(t=!0):e.payload.tradeInValue===0&&(t=!0));return t},purchase(a){this.$emit("purchaseBond",a)},skipBondPurchase(){this.$emit("skip")}}};function na(a,t,e,i,r,s){const c=P("v-btn"),u=P("v-col"),f=P("v-toolbar"),m=P("v-card-title"),h=P("Bond"),n=P("v-sheet"),o=P("v-divider"),l=P("v-row"),d=P("v-card-text"),y=P("v-card-actions"),b=P("v-card"),g=P("v-dialog");return _(),B(g,{modelValue:r.dialog,"onUpdate:modelValue":t[1]||(t[1]=w=>r.dialog=w),width:"50%"},{activator:p(({props:w})=>[T(u,null,{default:p(()=>[T(c,$e({color:"primary"},w),{default:p(()=>[x(" Buy a bond ")]),_:2},1040)]),_:2},1024),T(u,null,{default:p(()=>[T(c,{color:"error",onClick:s.skipBondPurchase},{default:p(()=>[x(" Do not buy a bond ")]),_:1},8,["onClick"])]),_:1})]),default:p(()=>[T(b,null,{default:p(()=>[T(m,null,{default:p(()=>[T(f,{color:"surface"},{append:p(()=>[T(c,{icon:"mdi-close",onClick:t[0]||(t[0]=w=>r.dialog=!1)})]),default:p(()=>[x(" Purchase a bond - You have "+F(e.game.players[e.currentPlayer].cash)+"m in cash. ",1)]),_:1})]),_:1}),T(d,null,{default:p(()=>[T(l,null,{default:p(()=>[T(u,{cols:"9"},{default:p(()=>[(_(!0),R(V,null,z(e.game.availableBonds,w=>(_(),B(n,{key:w.nation+w.cost,class:"ma-2 d-inline-block"},{default:p(()=>[s.canBePurchased(w)?(_(),B(h,{key:0,bond:w,"can-be-purchased":!0,"is-being-applied-to-trade-in":e.tradedInValue>0,"traded-in-value":e.tradedInValue,onClick:S=>s.purchase(w)},null,8,["bond","is-being-applied-to-trade-in","traded-in-value","onClick"])):(_(),B(h,{key:1,bond:w,filter:"grayscale"},null,8,["bond"]))]),_:2},1024))),128))]),_:1}),T(o,{vertical:""}),T(u,{cols:"3"},{default:p(()=>[x(" Your bonds that can be upgraded "),(_(!0),R(V,null,z(s.upgradeableBonds,w=>(_(),B(n,{key:w.nation+w.cost,class:"ma-2 d-inline-block"},{default:p(()=>[T(h,{bond:w,"is-being-applied-to-trade-in":e.tradedInValue>0,"traded-in-value":e.tradedInValue,onClick:S=>a.$emit("toggleTradeIn",w)},null,8,["bond","is-being-applied-to-trade-in","traded-in-value","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),T(y,null,{default:p(()=>[T(c,{color:"primary-darken-1",block:"",onClick:s.skipBondPurchase},{default:p(()=>[x(" Do not buy a bond ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const aa=W(ta,[["render",na]]),Wt=a=>a[0].toUpperCase()+a.substring(1),ia=a=>{if(a)switch(a){case"bayofbiscay":return"Bay of Biscay";case"blacksea":return"Black Sea";case"westernmediterraneansea":return"Western Mediterranean Sea";case"easternmediterraneansea":return"Eastern Mediterranean Sea";case"northsea":return"North Sea";case"northatlantic":return"North Atlantic";case"balticsea":return"Baltic Sea";case"englishchannel":return"English Channel";case"westbalkan":return"West Balkan";case"stpetersburg":return"St. Petersburg";case"northpacific":return"North Pacific";case"southpacific":return"South Pacific";case"caribbeansea":return"Caribbean Sea";case"southatlantic":return"South Atlantic";case"gulfofguinea":return"Gulf of Guinea";case"mediterraneansea":return"Mediterranean Sea";case"indianocean":return"Indian Ocean";case"seaofjapan":return"Sea of Japan";case"chinasea":return"China Sea";case"tasmansea":return"Tasman Sea";case"northafrica":return"North Africa";case"southafrica":return"South Africa";case"eastafrica":return"East Africa";case"neareast":return"Near East";case"newzealand":return"New Zealand";case"newdelhi":return"New Delhi";case"riodejaneiro":return"Rio de Janeiro";case"newyork":return"New York";case"neworleans":return"New Orleans";case"sanfrancisco":return"San Francisco";default:return Wt(a)}return"Location"},xe=a=>{switch(a){case"AH":return"Austria-Hungary";case"BR":return"Brazil";case"CN":return"China";case"CNAsia":return"China";case"EU":return"European Union";case"IN":return"India";case"IT":return"Italy";case"JP":return"Japan";case"FR":return"France";case"GB":return"Great Britain";case"GE":return"Germany";case"RU":return"Russia";case"TR":return"Turkey";case"US":return"United States of America";default:return"Nation"}},It=a=>a<0?`-$${Math.abs(a)}m`:`$${a}m`,ra=a=>a?"a fleet":"an army",oa=a=>a?"fleets":"armies",sa={name:"ConflictHandler",props:{controllingPlayerName:{type:String,default:""},game:{type:Object,default:()=>{}},hostingThisGame:{type:Boolean,default:!1},profile:{type:Object,default:()=>{}}},emits:["tick-with-action"],methods:{fighting(){let a=!1;for(const t of this.game.availableActions)(t.type==="coexist"||t.type==="fight")&&(a=!0);return a},occupying(){let a=!0;for(const t of this.game.availableActions)t.type!=="friendlyEntrance"&&t.type!=="unfriendlyEntrance"&&t.type!=="undo"&&(a=!1);return a},coexist(){let a={};for(const t of this.game.availableActions)t.type==="coexist"&&(a=t);this.$emit("tick-with-action",a)},fight(){let a={};for(const t of this.game.availableActions)t.type==="fight"&&(a=t);this.$emit("tick-with-action",a)},friendlyEntrance(){let a={};for(const t of this.game.availableActions)t.type==="friendlyEntrance"&&(a=t);this.$emit("tick-with-action",a)},unfriendlyEntrance(){let a={};for(const t of this.game.availableActions)t.type==="unfriendlyEntrance"&&(a=t);this.$emit("tick-with-action",a)},fightActions(){const a=[];for(const t of this.game.availableActions)t.type==="fight"&&a.push(t);return a},displayNationName(a){return xe(a)}}};function la(a,t,e,i,r,s){const c=P("v-btn"),u=P("v-col"),f=P("v-row");return e.game.handlingConflict&&(e.profile.username===e.controllingPlayerName||e.game.soloMode&&e.hostingThisGame)?(_(),B(u,{key:0},{default:p(()=>[s.fighting()?(_(),B(f,{key:0,justify:"space-evenly"},{default:p(()=>[T(u,null,{default:p(()=>[T(c,{color:"primary-darken-1",onClick:s.coexist},{default:p(()=>[x(" Coexist ")]),_:1},8,["onClick"])]),_:1}),T(u,null,{default:p(()=>[(_(!0),R(V,null,z(s.fightActions(),m=>(_(),B(c,{key:m.payload.incumbent.value+m.payload.targetType,color:"primary-darken-1",onClick:h=>a.$emit("tick-with-action",m)},{default:p(()=>[x(" Fight "+F(s.displayNationName(m.payload.incumbent.value))+" ("+F(m.payload.targetType)+") ",1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):E("",!0),s.occupying()?(_(),B(f,{key:1,justify:"space-evenly"},{default:p(()=>[T(u,null,{default:p(()=>[T(c,{color:"primary-darken-1",onClick:s.friendlyEntrance},{default:p(()=>[x(" Enter friendly ")]),_:1},8,["onClick"])]),_:1}),T(u,null,{default:p(()=>[T(c,{color:"primary-darken-1",onClick:s.unfriendlyEntrance},{default:p(()=>[x(" Enter unfriendly ")]),_:1},8,["onClick"])]),_:1})]),_:1})):E("",!0)]),_:1})):s.fighting()&&(e.profile.username===e.controllingPlayerName||e.game.soloMode&&e.hostingThisGame)?(_(),B(u,{key:1,class:"text-center"},{default:p(()=>[(_(!0),R(V,null,z(s.fightActions(),m=>(_(),B(c,{key:m.payload.province+m.payload.challenger,color:"primary-darken-1",onClick:h=>a.$emit("tick-with-action",m)},{default:p(()=>[x(" Fight "+F(s.displayNationName(m.payload.challenger.value))+" in "+F(m.payload.province),1)]),_:2},1032,["onClick"]))),128))]),_:1})):E("",!0)}const ca=W(sa,[["render",la]]),da={name:"TaxChartSlot",props:{bonus:{type:Number,default:0},taxSlot:{type:Number,default:0},nations:{type:Array,default:()=>[]},powerPointIncrease:{type:Number,default:0},showBonus:{type:Boolean,default:!1}},methods:{fill(a){switch(a){case"AH":return"#EBE084";case"IT":return"#6E8D4E";case"FR":return"#54BFF9";case"GB":return"#EF7F72";case"GE":return"#8F8F8F";case"RU":return"#9C6BAE";case"CN":return"#ebe084";case"IN":return"silver";case"BR":return"#6E8D4E";case"US":return"#EF7F72";case"EU":return"#54bff9";default:return"#FFFFFF"}}}},ua={key:0,class:"flex flex-wrap h-5"},ha=["fill"],fa={key:1};function ma(a,t,e,i,r,s){const c=P("v-col");return _(),B(c,null,{default:p(()=>[A("b",null,F(e.taxSlot),1),e.showBonus?E("",!0):(_(),R("div",ua,[(_(!0),R(V,null,z(e.nations,u=>(_(),R("svg",{key:u,width:"14px",height:"14px",viewBox:"0 0 14 14",version:"1.1",class:"m-0.5",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},[A("g",null,[A("circle",{cx:7,cy:7,r:"7","stroke-width":"0.5",stroke:"black",fill:s.fill(u)},null,8,ha)])]))),128))])),e.showBonus?(_(),R("div",fa,F(e.bonus),1)):E("",!0),A("div",null,"+ "+F(e.powerPointIncrease),1)]),_:1})}const pa=W(da,[["render",ma]]),ya={name:"TaxChart",components:{TaxChartSlot:pa},props:{showBonus:{type:Boolean,default:!1},taxes:{type:Array,default:()=>[]}},data:()=>({dialog:!1})},ga=A("thead",null,[A("tr",null,[A("th",null,"0x"),A("th",null,"1x"),A("th",null,"2x"),A("th",null,"3x"),A("th",null,"4x"),A("th",null,"5x")])],-1),va=A("tbody",null,[A("tr",null,[A("td",null,"0-4 power points"),A("td",null,"5-9 power points"),A("td",null,"10-14 power points"),A("td",null,"15-19 power points"),A("td",null,"20-24 power points"),A("td",null,"25 power points")])],-1);function ba(a,t,e,i,r,s){const c=P("v-btn"),u=P("v-card-title"),f=P("TaxChartSlot"),m=P("v-row"),h=P("v-table"),n=P("v-card-text"),o=P("v-card-actions"),l=P("v-card"),d=P("v-dialog");return _(),B(d,{modelValue:a.dialog,"onUpdate:modelValue":t[1]||(t[1]=y=>a.dialog=y),width:"auto"},{activator:p(({props:y})=>[T(c,$e({color:"primary"},y),{default:p(()=>[x(" Tax chart ")]),_:2},1040)]),default:p(()=>[T(l,null,{default:p(()=>[T(u,null,{default:p(()=>[x("Tax Chart")]),_:1}),T(n,null,{default:p(()=>[T(m,{class:"flex-row-reverse",justify:"space-evenly"},{default:p(()=>[(_(!0),R(V,null,z(e.taxes,y=>(_(),B(f,{key:y.slot,bonus:y.bonus,"tax-slot":y.slot,nations:y.nations,"power-point-increase":y.powerPointIncrease,"show-bonus":e.showBonus},null,8,["bonus","tax-slot","nations","power-point-increase","show-bonus"]))),128))]),_:1}),T(h,null,{default:p(()=>[ga,va]),_:1})]),_:1}),T(o,null,{default:p(()=>[T(c,{color:"primary-darken-1",block:"",onClick:t[0]||(t[0]=y=>a.dialog=!1)},{default:p(()=>[x(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const _a=W(ya,[["render",ba]]),qt=(a,t)=>a.nations.get(t).powerPoints+a.powerPointsGainedFrom(a.taxRevenueOf(t)),wa={name:"TaxStatus",props:{game:{type:Object,default:()=>{}}},data:()=>({dialog:!1}),methods:{displayNationName(a){return xe(a)},displayMonetaryValue_InMillions(a){return It(a)},flagsPlaced(a){return this.game.flagCount(a)},nextTaxRevenue(a){return this.game.taxRevenueOf(a)},nextNationProfit(a){const t=this.game.taxRevenueOf(a);return this.game.nationTaxationProfit(a,t)},nextTaxationPowerPoints(a){const t=qt(this.game,a);return t>25?`25 (${t})`:t.toString()}}},ka=A("i",null,"right now",-1),Ta=A("thead",null,[A("tr",null,[A("th"),A("th",null," Flags "),A("th",null," Tax Revenue "),A("th",null," Nation Profit "),A("th",null," Power Points ")])],-1);function Aa(a,t,e,i,r,s){const c=P("v-btn"),u=P("v-card-title"),f=P("v-card-subtitle"),m=P("v-table"),h=P("v-card-text"),n=P("v-card-actions"),o=P("v-card"),l=P("v-dialog");return _(),B(l,{modelValue:a.dialog,"onUpdate:modelValue":t[1]||(t[1]=d=>a.dialog=d),width:"auto"},{activator:p(({props:d})=>[T(c,$e({color:"primary"},d),{default:p(()=>[x(" Tax status ")]),_:2},1040)]),default:p(()=>[T(o,null,{default:p(()=>[T(u,null,{default:p(()=>[x("Tax Status")]),_:1}),T(f,null,{default:p(()=>[x(" This shows the power points and tax chart positions of each nation if they were to tax "),ka,x(". ")]),_:1}),T(h,null,{default:p(()=>[T(m,null,{default:p(()=>[Ta,A("tbody",null,[(_(!0),R(V,null,z(e.game.nations,([d])=>(_(),R("tr",{key:d.value},[A("td",null,[A("strong",null,F(s.displayNationName(d.value)),1)]),A("td",null,F(s.flagsPlaced(d)),1),A("td",null,F(s.displayMonetaryValue_InMillions(s.nextTaxRevenue(d))),1),A("td",null,F(s.displayMonetaryValue_InMillions(s.nextNationProfit(d))),1),A("td",null,F(s.nextTaxationPowerPoints(d)),1)]))),128))])]),_:1})]),_:1}),T(n,null,{default:p(()=>[T(c,{color:"primary-darken-1",block:"",onClick:t[0]||(t[0]=d=>a.dialog=!1)},{default:p(()=>[x(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Na=W(wa,[["render",Aa]]),Pa={name:"ControlPanel",components:{AvailableBonds:ea,BondPurchase:aa,ConflictHandler:ca,TaxStatus:Na,TaxChart:_a},props:{game:{type:Object,default:()=>{}},chooseImportType:{type:String,default:""},controllingPlayerName:{type:String,default:""},paused:{type:Boolean},profile:{type:Object,default:()=>{}},importPlacements:{type:Array,default:()=>[]},gameData:{type:Object,default:()=>{}},tradedInBondNation:{type:String,default:""},tradedInValue:{type:Number,default:0},hostingThisGame:{type:Boolean},upgradeableBonds:{type:Array,default:()=>[]}},emits:["runImport","chooseImportType","skipBuildFactory","purchaseBond","toggleTradeIn","endManeuver","tick"],data(){return{factoryToDestroy:""}},computed:{purchasingBond(){return this.game.availableActions.size>0&&Array.from(this.game.availableActions).every(t=>t.type==="bondPurchase"||t.type==="skipBondPurchase"||t.type==="undo")&&(this.profile.username===this.controllingPlayerName||this.game.soloMode&&this.hostingThisGame)},canForceInvestor(){return!!(this.game.availableActions.size>0&&Array.from(this.game.availableActions).every(a=>a.type==="forceInvestor"||a.type==="skipForceInvestor"||a.type==="undo")&&(this.game.swissBanks.includes(this.profile.username)||this.game.soloMode&&this.hostingThisGame))},canBlockCanal(){return!!(Array.from(this.game.availableActions).every(a=>a.type==="blockCanal"||a.type==="unblockCanal"||a.type==="undo")&&(this.profile.username===this.controllingPlayerName||this.game.soloMode&&this.hostingThisGame)&&this.game.winner==="")},canEndManeuver(){return Array.from(this.game.availableActions).every(a=>a.type==="blockCanal"||a.type==="unblockCanal"||a.type==="undo")?!1:this.game.maneuvering&&this.factoryToDestroy===""&&!this.game.handlingConflict&&(this.profile.username===this.game.currentPlayerName||this.game.soloMode&&this.hostingThisGame)}},methods:{purchaseBond(a){this.$emit("purchaseBond",a)},skipPurchaseBond(){for(const a of this.game.availableActions)a.type==="skipBondPurchase"&&this.tickWithAction(a)},endManeuver(){this.$emit("endManeuver",C.endManeuver())},tickWithAction(a){this.$emit("tick",a)},destroyingFactory(){if(this.profile.username!==this.controllingPlayerName&&!(this.game.soloMode&&this.hostingThisGame))return!1;let a=!1;for(const t of this.game.availableActions)(t.type==="destroyFactory"||t.type==="skipDestroyFactory")&&(a=!0,this.factoryToDestroy=t.payload.province);return a},destroyFactory(){let a={};for(const t of this.game.availableActions)t.type==="destroyFactory"&&(a=t);this.tickWithAction(a),this.factoryToDestroy=""},skipDestroyFactory(){let a={};for(const t of this.game.availableActions)t.type==="skipDestroyFactory"&&(a=t);this.tickWithAction(a),this.factoryToDestroy=""},canUndo(){let a=!1;for(const t of this.game.availableActions)t.type==="undo"&&(t.payload.player===this.profile.username||this.game.soloMode&&this.hostingThisGame)&&(a=!0);return a},taxes(){if(this.game.baseGame==="imperial")return[15,14,13,12,11,10,9,8,7,6,5].map(a=>{const t=[];for(const[i,r]of this.game.nations)r.taxChartPosition===a&&t.push(i.value);const e=a-5;return{slot:a,nations:t,powerPointIncrease:e}});if(this.game.baseGame==="imperial2030"||this.game.baseGame==="imperialAsia"){const a=[18,16,15,14,13,12,11,10,8,6,5];return a.map((t,e)=>{const i=[];for(const[c,u]of this.game.nations)u.taxChartPosition>=t&&i.push(c.value);const r=a.length-e-1;let s;switch(t){case 5:{s=0;break}case 6:{s=1;break}case 8:{s=1;break}case 10:{s=2;break}case 11:{s=2;break}case 12:{s=3;break}case 13:{s=3;break}case 14:{s=4;break}case 15:{s=4;break}case 16:{s=5;break}case 18:{s=5;break}default:{s=0;break}}return{slot:t,nations:i,powerPointIncrease:r,bonus:s}})}return{}},undo(){for(const a of this.game.availableActions)a.type==="undo"&&(a.payload.player===this.profile.username||this.game.soloMode&&this.hostingThisGame)&&this.tickWithAction(a)},forceInvestor(){for(const a of this.game.availableActions)a.type==="forceInvestor"&&this.tickWithAction(a)},skipForceInvestor(){for(const a of this.game.availableActions)a.type==="skipForceInvestor"&&this.tickWithAction(a)},blockCanal(){for(const a of this.game.availableActions)a.type==="blockCanal"&&this.tickWithAction(a)},unblockCanal(){for(const a of this.game.availableActions)a.type==="unblockCanal"&&this.tickWithAction(a)}}},Ia={class:"m-2"},Ba=A("b",null,"army",-1),Ca=A("b",null,"fleet",-1),xa={class:"text-lg"},Sa={class:"flex flex-wrap justify-evenly"};function Fa(a,t,e,i,r,s){const c=P("v-btn"),u=P("v-col"),f=P("AvailableBonds"),m=P("TaxStatus"),h=P("TaxChart"),n=P("BondPurchase"),o=P("v-row"),l=P("ConflictHandler"),d=P("v-sheet");return _(),B(d,{border:"",rounded:"",class:"pa-2"},{default:p(()=>[T(o,null,{default:p(()=>[s.canUndo()?(_(),B(u,{key:0},{default:p(()=>[T(c,{color:"secondary",onClick:s.undo},{default:p(()=>[x(" Undo ")]),_:1},8,["onClick"])]),_:1})):E("",!0),s.purchasingBond?E("",!0):(_(),B(u,{key:1},{default:p(()=>[T(f,{game:e.game},null,8,["game"])]),_:1})),T(u,null,{default:p(()=>[T(m,{game:e.game},null,8,["game"])]),_:1}),T(u,null,{default:p(()=>[T(h,{"show-bonus":e.game.baseGame==="imperial2030",taxes:s.taxes()},null,8,["show-bonus","taxes"])]),_:1}),!e.paused&&s.purchasingBond?(_(),B(n,{key:2,game:e.game,"current-player":e.controllingPlayerName,profile:e.profile,"traded-in-value":e.tradedInValue,"traded-in-bond-nation":e.tradedInBondNation,onPurchaseBond:s.purchaseBond,onSkip:s.skipPurchaseBond,onToggleTradeIn:t[0]||(t[0]=y=>a.$emit("toggleTradeIn",y))},null,8,["game","current-player","profile","traded-in-value","traded-in-bond-nation","onPurchaseBond","onSkip"])):E("",!0),!e.paused&&s.canEndManeuver?(_(),B(u,{key:3},{default:p(()=>[T(c,{color:"error",onClick:s.endManeuver},{default:p(()=>[x(" End maneuver ")]),_:1},8,["onClick"])]),_:1})):E("",!0),!e.paused&&e.game.importing&&!e.chooseImportType&&(e.profile.username===e.controllingPlayerName||e.game.soloMode&&e.hostingThisGame)?(_(),B(u,{key:4},{default:p(()=>[T(c,{color:"error",onClick:t[1]||(t[1]=y=>a.$emit("runImport"))},{default:p(()=>[x(" End import ")]),_:1}),A("div",Ia,[x(" You have "),A("b",null,F(e.game.maxImports-e.importPlacements.length),1),x(" imports left. ")])]),_:1})):E("",!0),!e.paused&&e.game.importing&&e.chooseImportType&&(e.profile.username===e.controllingPlayerName||e.game.soloMode&&e.hostingThisGame)?(_(),B(u,{key:5},{default:p(()=>[T(o,{justify:"space-evenly"},{default:p(()=>[T(u,{class:"text-center"},{default:p(()=>[T(c,{color:"primary-darken-1",onClick:t[2]||(t[2]=y=>a.$emit("chooseImportType","army"))},{default:p(()=>[x(" Army ")]),_:1})]),_:1}),T(u,{class:"text-center"},{default:p(()=>[T(c,{color:"primary-darken-1",onClick:t[3]||(t[3]=y=>a.$emit("chooseImportType","fleet"))},{default:p(()=>[x(" Fleet ")]),_:1})]),_:1})]),_:1}),x(" Please choose if you want to import an "),Ba,x(" or a "),Ca,x(". ")]),_:1})):E("",!0),e.paused?E("",!0):(_(),B(l,{key:6,game:e.game,profile:e.profile,"controlling-player-name":e.controllingPlayerName,"hosting-this-game":e.hostingThisGame,onTickWithAction:s.tickWithAction},null,8,["game","profile","controlling-player-name","hosting-this-game","onTickWithAction"])),!e.paused&&s.canForceInvestor?(_(),B(u,{key:7},{default:p(()=>[T(c,{color:"primary-darken-1",onClick:s.forceInvestor},{default:p(()=>[x(" Force investor ")]),_:1},8,["onClick"]),T(c,{color:"primary-darken-1",onClick:s.skipForceInvestor},{default:p(()=>[x(" Do not force investor ")]),_:1},8,["onClick"])]),_:1})):E("",!0),!e.paused&&s.canBlockCanal?(_(),B(u,{key:8},{default:p(()=>[T(c,{color:"primary-darken-1",onClick:s.blockCanal},{default:p(()=>[x(" Block canal ")]),_:1},8,["onClick"]),T(c,{color:"primary-darken-1",onClick:s.unblockCanal},{default:p(()=>[x(" Do not block canal ")]),_:1},8,["onClick"])]),_:1})):E("",!0),!e.paused&&e.game.buildingFactory&&(e.profile.username===e.controllingPlayerName||e.game.soloMode&&e.hostingThisGame)?(_(),B(u,{key:9},{default:p(()=>[T(c,{color:"primary-darken-1",onClick:t[4]||(t[4]=y=>a.$emit("skipBuildFactory"))},{default:p(()=>[x(" Skip building a factory ")]),_:1})]),_:1})):E("",!0),!e.paused&&s.destroyingFactory()?(_(),B(u,{key:10},{default:p(()=>[A("div",xa,[x(" Do you want to destroy the factory at "),A("b",null,F(r.factoryToDestroy),1),x("? ")]),A("div",Sa,[T(c,{color:"primary-darken-1",onClick:s.destroyFactory},{default:p(()=>[x(" Yes ")]),_:1},8,["onClick"]),T(c,{color:"primary-darken-1",onClick:s.skipDestroyFactory},{default:p(()=>[x(" No ")]),_:1},8,["onClick"])])]),_:1})):E("",!0)]),_:1})]),_:1})}const Ra=W(Pa,[["render",Fa]]),Oa={name:"Player",components:{Bond:Pt,Flag:Se},props:{currentPlayer:{type:String,default:""},onlineUsers:{type:Array,default:()=>[]},player:{type:Object,default:()=>{}},profile:{type:Object,default:()=>{}},game:{type:Object,default:()=>{}},index:{type:Number,default:0},name:{type:String,default:""},purchasingBond:Boolean,tradedInBondNation:{type:String,default:""},tradedInValue:{type:Number,default:0},turnIndex:{type:Number,default:0}},emits:["toggleTradeIn","cancelApplyToTradeIn"],methods:{applyToTradeIn(a){this.canTradeIn(a)&&this.toggleTradeIn(a)},canTradeIn(a){var e;let t=!1;for(const i of this.game.availableActions)((e=i.payload)==null?void 0:e.nation)===a.nation&&(t=!0);return!!(this.purchasingBond&&this.game.players[this.currentPlayer].bonds.has(a)&&t)},sortedBonds(a){const t=[k.AH,k.IT,k.FR,k.GB,k.GE,k.RU,N.RU,N.CN,N.IN,N.BR,N.US,N.EU,v.CN,v.JP,v.FR,v.GB,v.TR,v.RU,v.GE];return[...a].sort((r,s)=>t.indexOf(r.nation)>t.indexOf(s.nation)?1:-1).sort((r,s)=>r.nation===s.nation&&r.cost>s.cost?1:-1)},toggleTradeIn(a){this.$emit("toggleTradeIn",a)},cancelApplyToTradeIn(a){this.$emit("cancelApplyToTradeIn",a)},isBeingAppliedToTradeIn(a){return a.cost===this.tradedInValue&&a.nation.value===this.tradedInBondNation},cursorClass(){return this.purchasingBond?"cursor-pointer":""},controlledNations(a){let t=[];for(const[e]of this.game.nations)this.game.nations.get(e).controller===a&&(e.value==="CN"&&e.label==="NationAsia"?t=t.concat("CNAsia"):t=t.concat(e.value));return t}}},Ea={key:0,class:"text-5xl"},Ga={key:1,class:"text-caption mr-2"},Ma={key:0},Ua={key:1};function ja(a,t,e,i,r,s){const c=P("v-icon"),u=P("v-chip"),f=P("Flag"),m=P("v-card-title"),h=P("v-card-subtitle"),n=P("v-card-item"),o=P("Bond"),l=P("v-card-text"),d=P("v-card"),y=P("v-col");return _(),B(y,null,{default:p(()=>[T(d,{color:e.player.name===e.currentPlayer?"primary":"",style:{width:"max-content"}},{default:p(()=>[T(n,null,{default:p(()=>[T(m,null,{default:p(()=>[e.index?(_(),R("span",Ea,F(e.index),1)):(_(),R("span",Ga,F(e.turnIndex),1)),T(u,{to:e.player.id?"/users/"+e.player.id:"",class:"mr-2"},{prepend:p(()=>[e.onlineUsers.includes(e.player.name)?(_(),B(c,{key:0,color:"blue"},{default:p(()=>[x(" mdi-circle-medium ")]),_:1})):E("",!0)]),default:p(()=>[x(" "+F(e.player.name),1)]),_:1},8,["to"]),(_(!0),R(V,null,z(s.controlledNations(e.player.name),b=>(_(),B(f,{key:b,nation:b,width:"45",height:"30"},null,8,["nation"]))),128))]),_:1}),T(h,null,{default:p(()=>[A("div",null,"$"+F(e.player.cash)+"mil",1),A("div",null,F(e.player.rawScore+e.player.cash)+" VP",1)]),_:1})]),_:1}),T(l,null,{default:p(()=>[(_(!0),R(V,null,z(s.sortedBonds(e.player.bonds),b=>(_(),B(o,{key:b.nation.value+b.cost,bond:b,"toggle-trade-in":s.toggleTradeIn,"is-being-applied-to-trade-in":s.isBeingAppliedToTradeIn(b),class:Me({"cursor-pointer":s.canTradeIn(b)}),onClick:g=>s.applyToTradeIn(b)},null,8,["bond","toggle-trade-in","is-being-applied-to-trade-in","class","onClick"]))),128)),e.player.name===e.game.investorCardHolder?(_(),R("div",Ma," Investor Card ")):E("",!0),e.game.swissBanks.includes(e.player.name)?(_(),R("div",Ua," Swiss Bank ")):E("",!0)]),_:1})]),_:1},8,["color"])]),_:1})}const Ha=W(Oa,[["render",ja]]),La={name:"GameDetails",components:{Player:Ha},props:{game:{type:Object,default:()=>{}},controllingPlayerName:{type:String,default:""},paused:{type:Boolean,default:!1},profile:{type:Object,default:()=>{}},onlineUsers:{type:Array,default:()=>[]},gameData:{type:Object,default:()=>{}},hostingThisGame:{type:Boolean,default:!1}},emits:["tick","toggleTradeIn"],data(){return{tradedInBondNation:"",tradedInValue:0}},computed:{purchasingBond(){return this.paused?!1:this.game.availableActions.size>0&&Array.from(this.game.availableActions).every(t=>t.type==="bondPurchase"||t.type==="skipBondPurchase"||t.type==="undo")&&(this.profile.username===this.controllingPlayerName||this.game.soloMode&&this.hostingThisGame)},sortedPlayers(){return this.game.winner===""?this.players():this.players().sort((a,t)=>t.rawScore+t.cash-(a.rawScore+a.cash))}},methods:{players(){const a={};for(const t in this.game.players)this.gameData.players.forEach(e=>{t===e.name&&(a[t]={...this.game.players[t],id:e.id})}),a[t]||(a[t]=this.game.players[t]);return Object.values(a)},powerPoints(){return[...Array(26).keys()].map(a=>{const t=[];for(const[e,i]of this.game.nations)i.powerPoints===a&&t.push(e.value);return{slot:a,nations:t}})},tickWithAction(a){this.$emit("tick",a)},toggleTradeIn(a){this.$emit("toggleTradeIn",a)}}};function Da(a,t,e,i,r,s){const c=P("Player");return _(!0),R(V,null,z(s.sortedPlayers,(u,f)=>(_(),B(c,{key:u.name,player:u,"current-player":e.controllingPlayerName,game:e.game,profile:e.profile,"online-users":e.onlineUsers,"purchasing-bond":s.purchasingBond,"traded-in-bond-nation":r.tradedInBondNation,"traded-in-value":r.tradedInValue,index:e.game.winner?f+1:null,"turn-index":f+1,onToggleTradeIn:s.toggleTradeIn},null,8,["player","current-player","game","profile","online-users","purchasing-bond","traded-in-bond-nation","traded-in-value","index","turn-index","onToggleTradeIn"]))),128)}const Va=W(La,[["render",Da]]),za={name:"GameLogEntry",components:{Flag:Se},props:{events:{type:Object,default:()=>{}},index:{type:Number,default:0},board:{type:Object,default:()=>{}}},computed:{event(){return this.events.event}},methods:{capitalize(a){return Wt(a)},displayLocationName(a){return ia(a)},displayMonetaryValue_InMillions(a){return It(a)},unitTypeByDestination_Singular(a){return ra(this.board.graph.get(a).isOcean)},unitTypeByDestination_Plural(a){return oa(this.board.graph.get(a).isOcean)},displayNationName(a){return xe(a)},renderAction(a){const t="NOT IMPLEMENTED";switch(a.type){case"initialize":return t;case"undo":return`${a.payload.player} performed an undo on their last action.`;case"rondel":return this.rondelAction(a.payload);case"buildFactory":return this.buildFactoryAction(a.payload);case"skipBuildFactory":return`${a.payload.player} chose not to build a factory for ${this.displayNationName(a.payload.nation.value)}.`;case"couldNotBuildFactory":return`There were insufficient funds to build a factory for ${this.displayNationName(a.payload.nation.value)}.`;case"bondPurchase":return this.bondPurchaseAction(a.payload);case"skipBondPurchase":return`${a.payload.player} chose not to buy a bond.`;case"import":return this.importAction(a.payload);case"production":return t;case"maneuver":return this.maneuverAction(a.payload);case"coexist":return this.coexistAction(a.payload);case"fight":return this.fightAction(a.payload);case"destroyFactory":return this.destroyFactoryAction(a.payload);case"skipDestroyFactory":return`A factory was not destroyed in ${a.payload.province}.`;case"endManeuver":return this.endManeuverAction();case"forceInvestor":return`${a.payload.player} forced a move on the Investor slot.`;case"skipForceInvestor":return`${a.payload.player} did not force a move on the Investor slot.`;case"endGame":return"Game Over!";case"playerGainsCash":return`${a.payload.player} gained ${a.payload.amount}m in taxes.`;case"nationGainsTreasury":return`${this.displayNationName(a.payload.nation.value)} has changed by ${a.payload.amount}m in taxes.`;case"nationGainsPowerPoints":return`${this.displayNationName(a.payload.nation.value)} gained ${a.payload.powerPoints} power points.`;case"nationPaysPlayer":return`${this.displayNationName(a.payload.nation.value)} paid ${a.payload.player} ${a.payload.amount}m.`;case"investorCardHolderChanged":return`${a.payload.oldInvestorCardHolder} has passed the investor card to ${a.payload.newInvestorCardHolder}.`;case"nationControllerChanged":return`Control of ${this.displayNationName(a.payload.nation.value)} has passed from ${a.payload.oldNationController} to ${a.payload.newNationController}.`;case"playerTradedInForABond":return`${a.payload.player} traded in their ${this.displayNationName(a.payload.bondNation.value)} bond for ${a.payload.bondCost}m.`;case"playerAutoSkipsBondPurchase":return`${a.payload.player} could not buy a bond from ${this.displayNationName(a.payload.bondNation.value)} because of insufficient funds.`;case"playerPaysForRondel":{const e=this.capitalize(a.payload.slot).replace(/\d/g,"");return`${a.payload.player} paid ${a.payload.cost}m to move to the ${e} slot on the rondel.`}case"playerInvests":return`${a.payload.player} received 2m for holding the investor card.`;case"unfriendlyEntrance":return`${this.displayNationName(a.payload.challenger.value)} has violently entered ${this.displayLocationName(a.payload.province)} (${this.displayNationName(a.payload.incumbent.value)}).`;case"friendlyEntrance":return`${this.displayNationName(a.payload.challenger.value)} has peacefully entered ${this.displayLocationName(a.payload.province)} (${this.displayNationName(a.payload.incumbent.value)}).`;case"blockCanal":return"A canal has been blocked.";case"unblockCanal":return"A canal has not been blocked.";default:return t}},initializeAction(a){const t=a.id;return`<strong>${this.displayNationName(a.nation.value)}</strong> is controlled by <strong>${t}</strong>`},getNation(a){return a.value==="CN"&&a.label==="NationAsia"?"CNAsia":a.value},rondelAction(a){const t=this.displayNationName(a.nation.value),e=this.capitalize(a.slot).replace(/\d/g,"");return`${t} advanced to the ${e} rondel slot.`},buildFactoryAction(a){const t=this.displayLocationName(a.province),e=a.nationCosts?a.nationCosts+a.playerCosts:5,i=`a factory in ${t} for ${this.displayMonetaryValue_InMillions(e)}.`;if(a.playerCosts){const r=this.displayNationName(this.board.graph.get(a.province).nation.value),{player:s}=a;return`${s} funded ${r} ${this.displayMonetaryValue_InMillions(a.playerCosts)} to build ${i}`}return`Built ${i}`},bondPurchaseAction(a){const{player:t}=a,{cost:e}=a,i=this.displayNationName(a.nation.value);return`${t} bought the ${e}m bond from ${i}.`},importAction(a){const t=a.placements.map(c=>this.displayLocationName(c.province)),e=t[0],i=`${t.slice(0,-1).join(", ")} and ${t.slice(-1)}`,r=t.length>1?i:e,s=t.length>1?"units":"unit";return`Imported a total of ${t.length} ${s} into ${r}.`},maneuverAction(a){const t=this.unitTypeByDestination_Singular(a.destination),e=this.displayLocationName(a.origin),i=this.displayLocationName(a.destination);return`Moved ${t} from ${e} to ${i}.`},coexistAction(a){const t=this.capitalize(this.unitTypeByDestination_Singular(a.province)),e=this.displayLocationName(a.province),i=`${this.displayNationName(a.incumbent.value)} and ${this.displayNationName(a.challenger.value)}`;return`${t} from ${i} are peacefully coexisting in ${e}.`},fightAction(a){const t=this.displayLocationName(a.province),e=this.displayNationName(a.incumbent.value);return`${this.displayNationName(a.challenger.value)} has picked a fight with ${e} in ${t}.`},destroyFactoryAction(a){return`Factory destroyed in ${this.displayLocationName(a.province)}.`},endManeuverAction(){return"Military maneuvers have ended for now."},timestampToString(a){if(a!==""&&a){let t=xt.fromISO(a).toLocaleString(xt.DATETIME_FULL);return t==="Invalid DateTime"&&(t="Automated"),t}return"Automated"}}},Wa={key:0,class:"pt-2"},qa={class:"d-flex justify-space-between"},Ja=["innerHTML"],Xa={key:1,class:"pt-2"},Ya={class:"d-flex justify-space-between"},Za={key:2,class:"pt-1 d-flex justify-space-between"};function Qa(a,t,e,i,r,s){const c=P("v-divider"),u=P("Flag"),f=P("v-list-item"),m=P("v-list"),h=P("v-list-tile");return _(!0),R(V,null,z(s.event,({action:n,timestamp:o},l)=>(_(),B(h,{key:l},{default:p(()=>[n.type==="initialize"?(_(),R("div",Wa,[T(c),A("div",qa,[A("p",null,[A("b",null,F(n.payload.soloMode?"Solo game started!":"Game started!"),1)]),A("p",null,F(s.timestampToString(o)),1)]),x(" Variant: "+F(n.payload.variant||"standard")+" ",1),T(m,{density:"compact"},{default:p(()=>[(_(!0),R(V,null,z(n.payload.players,(d,y)=>(_(),B(f,{key:y},{default:p(()=>[d.nation?(_(),B(u,{key:0,nation:s.getNation(d.nation),class:"inline-block mr-1",width:"30",height:"20"},null,8,["nation"])):E("",!0),!n.payload.variant||n.payload.variant==="standard"?(_(),R("span",{key:1,innerHTML:s.initializeAction(d)},null,8,Ja)):E("",!0)]),_:2},1024))),128))]),_:2},1024)])):n.type==="rondel"?(_(),R("div",Xa,[T(c),A("b",null,"Turn "+F(e.index)+": ",1),T(u,{nation:s.getNation(n.payload.nation),class:"inline-block mr-1",width:"30",height:"20"},null,8,["nation"]),A("b",null,F(n.playerName),1),A("div",Ya,[A("p",null,F(s.renderAction(n)),1),A("p",null,F(s.timestampToString(o)),1)])])):(_(),R("div",Za,[A("p",null,"- "+F(s.renderAction(n)),1),A("p",null,F(s.timestampToString(o)),1)]))]),_:2},1024))),128)}const $a=W(za,[["render",Qa]]),Ka={name:"GameLog",components:{GameLogEntry:$a},props:{board:{type:Object,default:()=>{}},log:{type:Array,default:()=>[]},logTimestamps:{type:Array,default:()=>[]}},computed:{processedLog(){const a=["playerGainsCash","playerTradedInForABond","playerAutoSkipsBondPurchase","playerPaysForRondel","playerInvests","nationGainsTreasury","nationGainsPowerPoints","nationPaysPlayer","investorCardHolderChanged","nationControllerChanged"],t=this.log||[],e=this.logTimestamps||[],i=[];let r=0;return t.forEach(s=>{let c="";a.includes(s.type)||(c=e[r],r+=1),s.type==="initialize"||s.type==="rondel"?i.push({event:[{action:s,timestamp:c}]}):i[i.length-1].event.push({action:s,timestamp:c})}),i.reverse()}}};function ei(a,t,e,i,r,s){const c=P("GameLogEntry"),u=P("v-list"),f=P("v-container");return _(),B(f,null,{default:p(()=>[T(u,null,{default:p(()=>[(_(!0),R(V,null,z(s.processedLog,(m,h)=>(_(),B(c,{key:h,events:m,board:e.board,index:s.processedLog.length-h-1},null,8,["events","board","index"]))),128))]),_:1})]),_:1})}const ti=W(Ka,[["render",ei]]),ni={name:"NationComponent",components:{Flag:Se},props:{baseGame:{type:String,default:""},canPayOut:Boolean,currentNation:{type:String,default:""},currentPlayer:{type:String,default:""},controller:{type:String,default:""},nation:{type:String,default:""},powerPoints:{type:Number,default:0},treasury:{type:Number,default:0},winner:{type:String,default:""}},methods:{currentNationClass(){return this.currentNation===this.nation&&this.controller===this.currentPlayer?`bg-${this.nation} border-4 border-black `:this.currentNation===this.nation?`bg-${this.nation} `:""},width(){return this.baseGame==="imperial"||this.baseGame==="imperialAsia"?"w-1/3 md:w-full lg:w-full xl:w-full 2xl:w-full":this.baseGame==="imperial2030"?"w-1/3 lg:w-1/3 xl:w-1/3 2xl:w-1/6":""},truncate(a){return a=a||"",a.length>10?`${a.slice(0,10)}...`:a},displayNationName(a){return xe(a)}}},ai={key:0,class:"text-center font-bold text-xl"};function ii(a,t,e,i,r,s){const c=P("Flag"),u=P("v-card-text"),f=P("v-card"),m=P("v-col");return _(),B(m,null,{default:p(()=>[T(f,{class:Me(s.currentNationClass())},{default:p(()=>[T(u,null,{default:p(()=>[A("div",null,[A("b",null,F(s.displayNationName(e.nation)),1)]),T(c,{nation:e.nation,filter:e.controller===e.currentPlayer?"":"grayscale",height:"20",width:"30"},null,8,["nation","filter"]),A("div",{class:Me(e.canPayOut?"":"text-red-500 font-bold")}," $"+F(e.treasury)+"mil ",3),A("div",null,F(e.powerPoints)+" power",1),e.winner?(_(),R("div",ai," x"+F(Math.floor(e.powerPoints/5)),1)):E("",!0),x(" "+F(s.truncate(e.controller)),1)]),_:1})]),_:1},8,["class"])]),_:1})}const ri=W(ni,[["render",ii]]),oi={name:"RondelSlot",props:{index:{type:Number,default:0},isValid:Boolean,rondelSlot:{type:Object,default:()=>{}},nations:{type:Array,default:()=>[]}},emits:["slot-clicked","slot-hovered","slot-silent","circle-hovered"],data(){return{rotation:360/8*this.index,textRotation:this.getTextRotation(),flagTranslation:`60 ${this.index+20}`,svgPathData:["M 0 0","H 1","A 1 1 0 0 1",Math.cos(2*Math.PI/8),Math.sin(2*Math.PI/8),"Z"].join(" "),hover:!1}},methods:{hoverable:a=>a?"hoverable":"",xPosition(a){return 25+15*a},yPosition(a){return 10+6*a},getTextRotation(){return this.index<4?`${-(360/8)*1.5} 150 40`:`${360/8*2.5} 100 10`},fill(a){switch(a){case"AH":return"#EBE084";case"IT":return"#6E8D4E";case"FR":return"#54BFF9";case"GB":return"#EF7F72";case"GE":return"#8F8F8F";case"RU":return"#9C6BAE";case"CN":return"#ebe084";case"IN":return"silver";case"BR":return"#6E8D4E";case"US":return"#EF7F72";case"EU":return"#54bff9";case"JP":return"#6E8D4E";case"TR":return"#8F8F8F";case"GEAsia":return"white";case"CNAsia":return"#ebe084";default:return""}}}},si=["transform"],li={key:0,id:"brightness"},ci=A("feComponentTransfer",null,[A("feFuncR",{type:"linear",slope:"2"}),A("feFuncG",{type:"linear",slope:"2"}),A("feFuncB",{type:"linear",slope:"2"})],-1),di=[ci],ui=["id","fill","d"],hi=["transform"],fi=["transform"],mi=["cx","cy","fill","onMouseover"];function pi(a,t,e,i,r,s){return _(),R("g",null,[A("g",{class:"slot",transform:"translate(100, 100) rotate("+r.rotation+")",onMouseover:t[3]||(t[3]=c=>r.hover=!0),onMouseleave:t[4]||(t[4]=c=>r.hover=!1)},[r.hover?(_(),R("filter",li,di)):E("",!0),A("path",{id:e.rondelSlot.type,fill:e.rondelSlot.color,d:r.svgPathData,stroke:"#000000","vector-effect":"non-scaling-stroke",transform:"scale(100, 100)",class:Me(s.hoverable(e.isValid)),onClick:t[0]||(t[0]=c=>a.$emit("slot-clicked")),onMouseover:t[1]||(t[1]=c=>a.$emit("slot-hovered")),onMouseleave:t[2]||(t[2]=c=>a.$emit("slot-silent"))},null,42,ui),A("text",{"font-weight":"normal","font-size":"10","letter-spacing":"0.3",fill:"#000000","text-align":"center",x:"130",y:"0","text-anchor":"middle","alignment-baseline":"central",transform:"rotate("+r.textRotation+")"},F(e.rondelSlot.label),9,hi)],40,si),A("g",{transform:"translate(100, 100) rotate("+r.rotation+")"},[(_(!0),R(V,null,z(e.nations,(c,u)=>(_(),R("circle",{key:u,cx:s.xPosition(u),cy:s.yPosition(u),r:"7","stroke-width":"0.5",stroke:"black",fill:s.fill(c),onMouseover:f=>a.$emit("circle-hovered",c)},null,40,mi))),128))],8,fi)])}const yi=W(oi,[["render",pi]]),gi={name:"Rondel",components:{RondelSlot:yi,Flag:Se},props:{game:{type:Object,default:()=>{}},name:{type:String,default:""},paused:Boolean,hostingThisGame:Boolean},emits:["tick-with-action"],data(){return{cost:0,displayHelperFlag:!1,helperNation:"",helperText:"",onInvestorSlot:!1,onTaxationSlot:!1,slots:[{type:"production1",label:"Production",color:"#8C8798"},{type:"maneuver1",label:"Maneuver",color:"#7EA850"},{type:"investor",label:"Investor",color:"#8EDFFF"},{type:"import",label:"Import",color:"#F39D81"},{type:"production2",label:"Production",color:"#8C8798"},{type:"maneuver2",label:"Maneuver",color:"#7EA850"},{type:"taxation",label:"Taxation",color:"#FFD281"},{type:"factory",label:"Factory",color:"#8DBCFB"}]}},computed:{bondBearers(){const a={};for(const i of Object.keys(this.game.players))for(const r of this.game.players[i].bonds)r.nation===this.game.currentNation&&(a[i]?a[i]+=r.number:a[i]=r.number);const t=Object.keys(a).map(i=>[i,a[i]]).sort((i,r)=>i[1]-r[1]);let e=this.game.nations.get(this.game.currentNation).treasury;return t.map(i=>{if(e===0)return!1;if(e>=i[1])return e-=i[1],i;const r=e;return e=0,[i[0],r]}).filter(Boolean)},nextTaxChartPosition(){const a=this.game.taxRevenueOf(this.game.currentNation);return this.game.getTaxChartPosition(a)},playerBonus(){const a=this.game.taxRevenueOf(this.game.currentNation);return this.game.playerBonusAfterUnitMaintenanceCosts(this.game.currentNation,a)},nationProfit(){const a=this.game.taxRevenueOf(this.game.currentNation);return this.game.nationTaxationProfit(this.game.currentNation,a)},nextTaxationPowerPoints(){return qt(this.game,this.game.currentNation)}},methods:{displayNationName(a){return xe(a)},displayMonetaryValue_InMillions(a){return It(a)},isValid(a){return this.paused?!1:!!(this.validSlots().includes(a)&&(this.game.currentPlayerName===this.name||this.game.soloMode&&this.hostingThisGame))},nationsOnSlot(a){const t=[];for(const[e,i]of this.game.nations)a===i.rondelPosition&&(e.value==="GE"&&e.label==="NationAsia"?t.push("GEAsia"):t.push(e.value));return t},slotHovered(a){if(this.showRondelHelperText()){switch(a){case"investor":{this.onInvestorSlot=!0,this.onTaxationSlot=!1,this.game.variant==="withoutInvestorCard"?this.helperText="Nation pays players interest":this.helperText=`Nation pays players interest, investor card holder receives ${this.displayMonetaryValue_InMillions(2)} and may purchase a bond, Swiss Banks may invest.`;break}case"import":{this.onInvestorSlot=!1,this.onTaxationSlot=!1,this.helperText=`Nation may purchase up to 3 units for ${this.displayMonetaryValue_InMillions(1)} each, to be placed anywhere in their home territory.`;break}case"production1":case"production2":{this.onInvestorSlot=!1,this.onTaxationSlot=!1,this.helperText="Unoccupied factories produce an army or fleet.";break}case"maneuver1":case"maneuver2":{this.onInvestorSlot=!1,this.onTaxationSlot=!1,this.helperText="Units may move. Fleets must move first, followed by armies.";break}case"taxation":{this.onInvestorSlot=!1,this.onTaxationSlot=!0,this.helperText=`Nation taxes (${this.displayMonetaryValue_InMillions(2)} per unoccupied factory and ${this.displayMonetaryValue_InMillions(1)} per flag in) its empire. Power points are increased and nation receives tax, less soldiers' pay (${this.displayMonetaryValue_InMillions(1)} per unit). Player is paid a bonus accordingly.`;break}case"factory":{this.onInvestorSlot=!1,this.onTaxationSlot=!1,this.helperText=`Nation builds a factory for ${this.displayMonetaryValue_InMillions(5)}. If the nation has insufficient funds, the governor of the nation will fund the rest of the costs.`;break}}this.cost=0;for(const t of this.game.availableActions)if(t.payload.slot===a){t.payload.cost&&(this.cost+=t.payload.cost);break}}},showRondelHelperText(){if(this.paused)return!1;this.displayHelperFlag=!1;let a=!0;for(const t of this.game.availableActions)t.type!=="rondel"&&t.type!=="undo"&&(a=!1);return a&&(this.game.currentPlayerName===this.name||this.game.soloMode&&this.hostingThisGame)},slotSilent(){this.displayHelperFlag=!1,this.helperText=""},slotClicked(a){if(this.game.currentPlayerName===this.name||this.game.soloMode&&this.hostingThisGame)for(const t of this.game.availableActions)t.payload.slot===a&&this.$emit("tick-with-action",t)},handleCircleHovered(a){this.displayHelperFlag=!0,this.helperNation=a,this.helperText=xe(a)},validSlots(){const a=[];for(const t of this.game.availableActions)t.type==="rondel"&&a.push(t.payload.slot);return a}}},vi={width:"350px",height:"350px",viewBox:"-20 -20 240 240",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},bi={key:0},_i={key:0},wi=A("b",null,"Tax Revenue",-1),ki={key:0};function Ti(a,t,e,i,r,s){const c=P("RondelSlot"),u=P("v-col"),f=P("v-card-text"),m=P("Flag"),h=P("v-card"),n=P("v-row");return _(),B(n,null,{default:p(()=>[T(u,{cols:"4","offset-sm":"4"},{default:p(()=>[(_(),R("svg",vi,[(_(!0),R(V,null,z(r.slots,(o,l)=>(_(),B(c,{key:o.type,index:l,"is-valid":s.isValid(o.type),nations:s.nationsOnSlot(o.type),"rondel-slot":o,onCircleHovered:s.handleCircleHovered,onSlotClicked:d=>s.slotClicked(o.type),onSlotHovered:d=>s.slotHovered(o.type),onSlotSilent:t[0]||(t[0]=d=>s.slotSilent())},null,8,["index","is-valid","nations","rondel-slot","onCircleHovered","onSlotClicked","onSlotHovered"]))),128))]))]),_:1}),r.helperText?(_(),B(u,{key:0,cols:"3"},{default:p(()=>[T(h,{color:"secondary"},{default:p(()=>[r.onInvestorSlot?(_(),B(f,{key:0},{default:p(()=>[(_(!0),R(V,null,z(s.bondBearers,([o,l])=>(_(),R("div",{key:o},[A("b",null,F(o),1),x(" would receive "+F(s.displayMonetaryValue_InMillions(l)),1)]))),128)),e.game.variant!=="withoutInvestorCard"?(_(),R("div",bi,[A("b",null,F(e.game.investorCardHolder),1),x(" has the investor card ")])):E("",!0)]),_:1})):E("",!0),r.onTaxationSlot?(_(),B(f,{key:1},{default:p(()=>[A("div",null,[e.game.baseGame==="imperial"?(_(),R("div",_i,[wi,x(" will go from "+F(s.displayMonetaryValue_InMillions(e.game.nations.get(e.game.currentNation).taxChartPosition))+" to "+F(s.displayMonetaryValue_InMillions(s.nextTaxChartPosition)),1)])):E("",!0),A("div",null,[A("b",null,F(e.game.currentPlayerName),1),x(" would receive "+F(s.displayMonetaryValue_InMillions(s.playerBonus)),1)]),A("div",null,[A("b",null,F(s.displayNationName(e.game.currentNation.value)),1),x("'s treasury would change by "+F(s.displayMonetaryValue_InMillions(s.nationProfit)),1)]),A("div",null,[A("b",null,F(s.displayNationName(e.game.currentNation.value)),1),x("'s power points would be "+F(s.nextTaxationPowerPoints),1)])])]),_:1})):E("",!0),r.cost>0?(_(),B(f,{key:2},{default:p(()=>[A("b",null,"Cost: "+F(s.displayMonetaryValue_InMillions(r.cost)),1)]),_:1})):E("",!0),T(f,null,{default:p(()=>[r.displayHelperFlag?(_(),R("span",ki,[T(m,{nation:r.helperNation,height:"20",width:"30",class:"inline-block pr-1"},null,8,["nation"])])):E("",!0),A("span",null,F(r.helperText),1)]),_:1})]),_:1})]),_:1})):E("",!0)]),_:1})}const Ai=W(gi,[["render",Ti]]),Ni={name:"TimeTravelButtons",props:{game:{type:Object,default:()=>{}},poppedTurns:{type:Array,default:()=>[]}},emits:["forwardToCurrentActionEvent","forwardEvent","backToGameStartEvent","backEvent","backToRoundStartEvent"]};function Pi(a,t,e,i,r,s){const c=P("v-btn"),u=P("v-btn-group"),f=P("v-row");return _(),B(f,{class:"justify-center"},{default:p(()=>[T(u,null,{default:p(()=>[e.game.log.length>1?(_(),B(c,{key:0,size:"small",color:"secondary",onClick:t[0]||(t[0]=m=>a.$emit("backToGameStartEvent"))},{default:p(()=>[x(" | ")]),_:1})):(_(),B(c,{key:1,size:"small",disabled:""},{default:p(()=>[x(" | ")]),_:1})),e.game.log.length>1?(_(),B(c,{key:2,size:"small",color:"secondary",onClick:t[1]||(t[1]=m=>a.$emit("backToRoundStartEvent"))},{default:p(()=>[x("  ")]),_:1})):(_(),B(c,{key:3,size:"small",disabled:""},{default:p(()=>[x("  ")]),_:1})),e.game.log.length>1?(_(),B(c,{key:4,size:"small",color:"secondary",onClick:t[2]||(t[2]=m=>a.$emit("backEvent"))},{default:p(()=>[x("  ")]),_:1})):(_(),B(c,{key:5,size:"small",disabled:""},{default:p(()=>[x("  ")]),_:1})),e.poppedTurns.length>0?(_(),B(c,{key:6,size:"small",color:"secondary",onClick:t[3]||(t[3]=m=>a.$emit("forwardEvent"))},{default:p(()=>[x("  ")]),_:1})):(_(),B(c,{key:7,size:"small",disabled:""},{default:p(()=>[x("  ")]),_:1})),e.poppedTurns.length>0?(_(),B(c,{key:8,size:"small",color:"secondary",onClick:t[4]||(t[4]=m=>a.$emit("forwardToCurrentActionEvent"))},{default:p(()=>[x(" | ")]),_:1})):(_(),B(c,{key:9,size:"small",disabled:""},{default:p(()=>[x(" | ")]),_:1}))]),_:1})]),_:1})}const Ii=W(Ni,[["render",Pi]]),Bi={name:"TurnStatus",props:{game:{type:Object,default:()=>{}},profile:{type:Object,default:()=>{}},controllingPlayerName:{type:String,default:""},paused:{type:Boolean,default:!1}},computed:{extraClasses(){return this.paused?"bg-yellow-100":this.game.currentPlayerName===this.profile.username?`bg-${this.game.currentNation.value}`:""},playerIs(){return this.controllingPlayerName===""?"<b>Swiss Banks</b> are ":this.game.currentPlayerName===this.profile.username?"<b>You</b> are ":`<b>${this.game.currentPlayerName}</b> is `}},methods:{stringify(a){const t=[];for(const e of a)e.type!=="undo"&&t.push(e);return t.every(e=>e.type==="rondel")?"choosing a rondel slot":t.every(e=>e.type==="buildFactory"||e.type==="skipBuildFactory")?"choosing where to build a factory":t.every(e=>e.type==="maneuver"||e.type==="endManeuver")?"choosing where to maneuver their military units. Fleets move first, then armies":t.every(e=>e.type==="bondPurchase"||e.type==="skipBondPurchase")?"choosing a bond to purchase":t.every(e=>e.type==="import")?"choosing where to import additional military units":t.every(e=>e.type==="fight"||e.type==="coexist")?"choosing whether to fight or coexist":t.every(e=>e.type==="forceInvestor"||e.type==="skipForceInvestor")?"choosing whether to force the current nation to stop on the Investor rondel slot":t.every(e=>e.type==="destroyFactory"||e.type==="skipDestroyFactory")?"choosing whether to destroy a factory":t.every(e=>e.type==="unfriendlyEntrance"||e.type==="friendlyEntrance")?"choosing whether to enter peacefully or not":t.every(e=>e.type==="blockCanal"||e.type==="unblockCanal")?"choosing whether or not to block a canal":"doing something mysterious"}}},Ci=A("b",null,"Game over!",-1),xi=["innerHTML"];function Si(a,t,e,i,r,s){const c=P("v-col"),u=P("v-row");return e.game.winner&&!e.paused?(_(),B(u,{key:0},{default:p(()=>[T(c,{color:"primary"},{default:p(()=>[Ci,x(" "+F(e.game.winner)+" won the game. ",1)]),_:1})]),_:1})):(_(),B(u,{key:1},{default:p(()=>[T(c,{class:Me(["border border-gray-500 text-center",s.extraClasses])},{default:p(()=>[A("span",{innerHTML:s.playerIs},null,8,xi),x(" "+F(s.stringify(Array.from(e.game.availableActions)))+". ",1)]),_:1},8,["class"])]),_:1}))}const Fi=W(Bi,[["render",Si]]),Ri=[{isOcean:!0,name:"northpacific"},{isOcean:!0,name:"southpacific"},{isOcean:!0,name:"northatlantic"},{isOcean:!0,name:"caribbeansea"},{isOcean:!0,name:"southatlantic"},{isOcean:!0,name:"gulfofguinea"},{isOcean:!0,name:"mediterraneansea"},{isOcean:!0,name:"indianocean"},{isOcean:!0,name:"seaofjapan"},{isOcean:!0,name:"chinasea"},{isOcean:!0,name:"tasmansea"},{isOcean:!1,name:"alaska"},{isOcean:!1,name:"canada"},{isOcean:!1,name:"quebec"},{isOcean:!1,name:"mexico"},{isOcean:!1,name:"colombia"},{isOcean:!1,name:"peru"},{isOcean:!1,name:"argentina"},{isOcean:!1,name:"guinea"},{isOcean:!1,name:"northafrica"},{isOcean:!1,name:"nigeria"},{isOcean:!1,name:"congo"},{isOcean:!1,name:"southafrica"},{isOcean:!1,name:"eastafrica"},{isOcean:!1,name:"neareast"},{isOcean:!1,name:"turkey"},{isOcean:!1,name:"ukraine"},{isOcean:!1,name:"iran"},{isOcean:!1,name:"afghanistan"},{isOcean:!1,name:"kazakhstan"},{isOcean:!1,name:"mongolia"},{isOcean:!1,name:"indochina"},{isOcean:!1,name:"korea"},{isOcean:!1,name:"japan"},{isOcean:!1,name:"philippines"},{isOcean:!1,name:"indonesia"},{isOcean:!1,name:"australia"},{isOcean:!1,name:"newzealand"},{nation:N.RU,factoryType:"armaments",name:"moscow",isHome:!0},{nation:N.RU,factoryType:"shipyard",name:"murmansk",egress:"northatlantic"},{nation:N.RU,factoryType:"shipyard",name:"vladivostok",egress:"seaofjapan"},{nation:N.RU,factoryType:"armaments",name:"novosibirsk"},{nation:N.CN,factoryType:"armaments",name:"beijing",isHome:!0},{nation:N.CN,factoryType:"armaments",name:"urumqi"},{nation:N.CN,factoryType:"shipyard",name:"shanghai",egress:"chinasea"},{nation:N.CN,factoryType:"armaments",name:"chongqing"},{nation:N.IN,factoryType:"armaments",name:"newdelhi",isHome:!0},{nation:N.IN,factoryType:"shipyard",name:"mumbai",egress:"indianocean"},{nation:N.IN,factoryType:"shipyard",name:"kolkata",egress:"indianocean"},{nation:N.IN,factoryType:"armaments",name:"chennai"},{nation:N.BR,factoryType:"armaments",name:"brasilia",isHome:!0},{nation:N.BR,factoryType:"shipyard",name:"riodejaneiro",egress:"southatlantic"},{nation:N.BR,factoryType:"shipyard",name:"fortaleza",egress:"caribbeansea"},{nation:N.BR,factoryType:"armaments",name:"manaus"},{nation:N.US,factoryType:"armaments",name:"chicago",isHome:!0},{nation:N.US,factoryType:"shipyard",name:"newyork",egress:"northatlantic"},{nation:N.US,factoryType:"shipyard",name:"neworleans",egress:"caribbeansea"},{nation:N.US,factoryType:"shipyard",name:"sanfrancisco",egress:"northpacific"},{nation:N.EU,factoryType:"armaments",name:"paris",isHome:!0},{nation:N.EU,factoryType:"shipyard",name:"london",egress:"northatlantic"},{nation:N.EU,factoryType:"shipyard",name:"rome",egress:"mediterraneansea"},{nation:N.EU,factoryType:"armaments",name:"berlin"}],Oi=[["alaska","canada"],["alaska","northpacific"],["canada","alaska"],["canada","quebec"],["canada","sanfrancisco"],["canada","chicago"],["canada","newyork"],["canada","northpacific"],["canada","northatlantic"],["quebec","canada"],["quebec","newyork"],["quebec","northatlantic"],["sanfrancisco","northpacific"],["sanfrancisco","canada"],["sanfrancisco","chicago"],["sanfrancisco","neworleans"],["sanfrancisco","mexico"],["chicago","canada"],["chicago","newyork"],["chicago","neworleans"],["chicago","sanfrancisco"],["newyork","northatlantic"],["newyork","chicago"],["newyork","canada"],["newyork","neworleans"],["neworleans","caribbeansea"],["neworleans","newyork"],["neworleans","mexico"],["neworleans","sanfrancisco"],["neworleans","chicago"],["mexico","neworleans"],["mexico","colombia"],["mexico","sanfrancisco"],["mexico","northpacific"],["mexico","caribbeansea"],["colombia","mexico"],["colombia","manaus"],["colombia","peru"],["colombia","northpacific"],["colombia","caribbeansea"],["peru","colombia"],["peru","manaus"],["peru","brasilia"],["peru","argentina"],["peru","southpacific"],["argentina","peru"],["argentina","brasilia"],["argentina","riodejaneiro"],["argentina","southpacific"],["argentina","southatlantic"],["riodejaneiro","southatlantic"],["riodejaneiro","argentina"],["riodejaneiro","brasilia"],["riodejaneiro","fortaleza"],["brasilia","riodejaneiro"],["brasilia","argentina"],["brasilia","manaus"],["brasilia","peru"],["brasilia","fortaleza"],["manaus","brasilia"],["manaus","peru"],["manaus","colombia"],["manaus","fortaleza"],["manaus","caribbeansea"],["fortaleza","caribbeansea"],["fortaleza","manaus"],["fortaleza","brasilia"],["fortaleza","riodejaneiro"],["london","northatlantic"],["london","paris"],["paris","northatlantic"],["paris","london"],["paris","berlin"],["paris","rome"],["paris","mediterraneansea"],["rome","paris"],["rome","berlin"],["rome","ukraine"],["rome","turkey"],["rome","mediterraneansea"],["berlin","northatlantic"],["berlin","murmansk"],["berlin","ukraine"],["berlin","rome"],["berlin","paris"],["ukraine","berlin"],["ukraine","murmansk"],["ukraine","moscow"],["ukraine","rome"],["murmansk","northatlantic"],["murmansk","novosibirsk"],["murmansk","moscow"],["murmansk","ukraine"],["murmansk","berlin"],["moscow","murmansk"],["moscow","novosibirsk"],["moscow","kazakhstan"],["moscow","ukraine"],["novosibirsk","murmansk"],["novosibirsk","vladivostok"],["novosibirsk","mongolia"],["novosibirsk","kazakhstan"],["novosibirsk","moscow"],["vladivostok","novosibirsk"],["vladivostok","seaofjapan"],["vladivostok","korea"],["vladivostok","beijing"],["vladivostok","mongolia"],["kazakhstan","moscow"],["kazakhstan","novosibirsk"],["kazakhstan","mongolia"],["kazakhstan","urumqi"],["kazakhstan","afghanistan"],["mongolia","novosibirsk"],["mongolia","vladivostok"],["mongolia","beijing"],["mongolia","urumqi"],["mongolia","kazakhstan"],["korea","beijing"],["korea","vladivostok"],["korea","seaofjapan"],["korea","chinasea"],["japan","seaofjapan"],["beijing","mongolia"],["beijing","vladivostok"],["beijing","korea"],["beijing","chinasea"],["beijing","shanghai"],["beijing","chongqing"],["beijing","urumqi"],["shanghai","beijing"],["shanghai","chinasea"],["shanghai","indochina"],["shanghai","chongqing"],["chongqing","beijing"],["chongqing","shanghai"],["chongqing","indochina"],["chongqing","kolkata"],["chongqing","urumqi"],["urumqi","kazakhstan"],["urumqi","mongolia"],["urumqi","beijing"],["urumqi","chongqing"],["urumqi","kolkata"],["urumqi","newdelhi"],["urumqi","afghanistan"],["afghanistan","kazakhstan"],["afghanistan","urumqi"],["afghanistan","newdelhi"],["afghanistan","mumbai"],["afghanistan","iran"],["iran","moscow"],["iran","afghanistan"],["iran","mumbai"],["iran","indianocean"],["iran","neareast"],["iran","turkey"],["turkey","rome"],["turkey","moscow"],["turkey","iran"],["turkey","neareast"],["turkey","mediterraneansea"],["neareast","mediterraneansea"],["neareast","turkey"],["neareast","iran"],["neareast","indianocean"],["neareast","northafrica"],["northafrica","northatlantic"],["northafrica","mediterraneansea"],["northafrica","neareast"],["northafrica","indianocean"],["northafrica","eastafrica"],["northafrica","nigeria"],["northafrica","guinea"],["guinea","northatlantic"],["guinea","northafrica"],["guinea","nigeria"],["guinea","gulfofguinea"],["nigeria","guinea"],["nigeria","northafrica"],["nigeria","eastafrica"],["nigeria","congo"],["nigeria","gulfofguinea"],["congo","nigeria"],["congo","eastafrica"],["congo","southafrica"],["congo","gulfofguinea"],["southafrica","gulfofguinea"],["southafrica","congo"],["southafrica","eastafrica"],["southafrica","indianocean"],["eastafrica","northafrica"],["eastafrica","indianocean"],["eastafrica","southafrica"],["eastafrica","congo"],["eastafrica","nigeria"],["mumbai","iran"],["mumbai","afghanistan"],["mumbai","newdelhi"],["mumbai","chennai"],["mumbai","indianocean"],["newdelhi","afghanistan"],["newdelhi","urumqi"],["newdelhi","kolkata"],["newdelhi","mumbai"],["kolkata","newdelhi"],["kolkata","urumqi"],["kolkata","chongqing"],["kolkata","indochina"],["kolkata","indianocean"],["kolkata","chennai"],["kolkata","mumbai"],["chennai","mumbai"],["chennai","kolkata"],["chennai","indianocean"],["indochina","kolkata"],["indochina","chongqing"],["indochina","shanghai"],["indochina","chinasea"],["indochina","indianocean"],["philippines","chinasea"],["indonesia","chinasea"],["indonesia","indianocean"],["indonesia","tasmansea"],["australia","tasmansea"],["newzealand","tasmansea"],["northpacific","alaska"],["northpacific","canada"],["northpacific","sanfrancisco"],["northpacific","mexico"],["northpacific","colombia"],["northpacific","seaofjapan"],["northpacific","chinasea"],["northpacific","caribbeansea"],["northpacific","southpacific"],["southpacific","chinasea"],["southpacific","tasmansea"],["southpacific","peru"],["southpacific","argentina"],["southpacific","northpacific"],["caribbeansea","northatlantic"],["caribbeansea","gulfofguinea"],["caribbeansea","southatlantic"],["caribbeansea","fortaleza"],["caribbeansea","manaus"],["caribbeansea","colombia"],["caribbeansea","northpacific"],["caribbeansea","mexico"],["caribbeansea","neworleans"],["northatlantic","quebec"],["northatlantic","london"],["northatlantic","murmansk"],["northatlantic","paris"],["northatlantic","mediterraneansea"],["northatlantic","northafrica"],["northatlantic","guinea"],["northatlantic","gulfofguinea"],["northatlantic","caribbeansea"],["northatlantic","newyork"],["southatlantic","argentina"],["southatlantic","riodejaneiro"],["southatlantic","caribbeansea"],["southatlantic","gulfofguinea"],["southatlantic","indianocean"],["southatlantic","southpacific"],["gulfofguinea","northatlantic"],["gulfofguinea","guinea"],["gulfofguinea","nigeria"],["gulfofguinea","congo"],["gulfofguinea","southafrica"],["gulfofguinea","indianocean"],["gulfofguinea","southatlantic"],["gulfofguinea","caribbeansea"],["mediterraneansea","northatlantic"],["mediterraneansea","paris"],["mediterraneansea","rome"],["mediterraneansea","turkey"],["mediterraneansea","neareast"],["mediterraneansea","indianocean"],["mediterraneansea","northafrica"],["indianocean","southatlantic"],["indianocean","gulfofguinea"],["indianocean","southafrica"],["indianocean","eastafrica"],["indianocean","neareast"],["indianocean","mediterraneansea"],["indianocean","iran"],["indianocean","mumbai"],["indianocean","chennai"],["indianocean","kolkata"],["indianocean","indochina"],["indianocean","indonesia"],["indianocean","chinasea"],["indianocean","tasmansea"],["seaofjapan","vladivostok"],["seaofjapan","japan"],["seaofjapan","korea"],["seaofjapan","northpacific"],["seaofjapan","chinasea"],["chinasea","shanghai"],["chinasea","beijing"],["chinasea","korea"],["chinasea","seaofjapan"],["chinasea","northpacific"],["chinasea","southpacific"],["chinasea","tasmansea"],["chinasea","philippines"],["chinasea","indonesia"],["chinasea","indochina"],["tasmansea","australia"],["tasmansea","newzealand"],["tasmansea","chinasea"],["tasmansea","southpacific"],["tasmansea","indonesia"],["tasmansea","indianocean"]],Ei=new At({nodes:Ri,edges:Oi}),Gi=[{isOcean:!0,name:"arabiansea"},{isOcean:!0,name:"bayofbengal"},{isOcean:!0,name:"caspiansea"},{isOcean:!0,name:"indianocean"},{isOcean:!0,name:"javasea"},{isOcean:!0,name:"mediterraneansea"},{isOcean:!0,name:"okhotsksea"},{isOcean:!0,name:"seaofjapan"},{isOcean:!0,name:"southchinasea"},{isOcean:!0,name:"timorsea"},{isOcean:!0,name:"yellowsea"},{isOcean:!1,name:"budapest"},{isOcean:!1,name:"egypt"},{isOcean:!1,name:"sudan"},{isOcean:!1,name:"eastafrica"},{isOcean:!1,name:"arabia"},{isOcean:!1,name:"persia"},{isOcean:!1,name:"afghanistan"},{isOcean:!1,name:"nepal"},{isOcean:!1,name:"burma"},{isOcean:!1,name:"malaysia"},{isOcean:!1,name:"hongkong"},{isOcean:!1,name:"northkorea"},{isOcean:!1,name:"southkorea"},{isOcean:!1,name:"formosa"},{isOcean:!1,name:"manila"},{isOcean:!1,name:"davao"},{isOcean:!1,name:"newguinea"},{nation:v.TR,factoryType:"shipyard",name:"constantinople",egress:"mediterraneansea"},{nation:v.TR,factoryType:"armaments",name:"angora"},{nation:v.TR,factoryType:"armaments",name:"syria",isHome:!0},{nation:v.TR,factoryType:"armaments",name:"armenia"},{nation:v.TR,factoryType:"shipyard",name:"iraq",isHome:!0,egress:"arabiansea"},{nation:v.RU,factoryType:"shipyard",name:"odessa",isHome:!0,egress:"mediterraneansea"},{nation:v.RU,factoryType:"armaments",name:"moscow",isHome:!0},{nation:v.RU,factoryType:"armaments",name:"omsk"},{nation:v.RU,factoryType:"armaments",name:"irkutsk"},{nation:v.RU,factoryType:"shipyard",name:"vladivostok",egress:"okhotsksea"},{nation:v.CN,factoryType:"shipyard",name:"shanghai",egress:"yellowsea"},{nation:v.CN,factoryType:"armaments",name:"canton"},{nation:v.CN,factoryType:"armaments",name:"peking",isHome:!0},{nation:v.CN,factoryType:"armaments",name:"sinkiang",isHome:!0},{nation:v.CN,factoryType:"armaments",name:"mongolia"},{nation:v.FR,factoryType:"armaments",name:"cambodia",isHome:!0},{nation:v.FR,factoryType:"armaments",name:"tongking"},{nation:v.FR,factoryType:"shipyard",name:"cochin",egress:"javasea"},{nation:v.FR,factoryType:"shipyard",name:"annam",isHome:!0,egress:"southchinasea"},{nation:v.FR,factoryType:"armaments",name:"siam"},{nation:v.JP,factoryType:"shipyard",name:"kyoto",egress:"seaofjapan"},{nation:v.JP,factoryType:"shipyard",name:"kyushu",egress:"yellowsea"},{nation:v.JP,factoryType:"armaments",name:"akita"},{nation:v.JP,factoryType:"shipyard",name:"otaru",isHome:!0,egress:"okhotsksea"},{nation:v.JP,factoryType:"shipyard",name:"tokyo",isHome:!0,egress:"seaofjapan"},{nation:v.GB,factoryType:"shipyard",name:"madras",isHome:!0,egress:"indianocean"},{nation:v.GB,factoryType:"armaments",name:"hyderabad",isHome:!0},{nation:v.GB,factoryType:"armaments",name:"delhi"},{nation:v.GB,factoryType:"shipyard",name:"bengal",egress:"bayofbengal"},{nation:v.GB,factoryType:"shipyard",name:"bombay",egress:"arabaiansea"},{nation:v.GE,factoryType:"shipyard",name:"sumatra",isHome:!0,egress:"bayofbengal"},{nation:v.GE,factoryType:"armaments",name:"sarawak"},{nation:v.GE,factoryType:"armaments",name:"celebes"},{nation:v.GE,factoryType:"shipyard",name:"java",egress:"indianocean"},{nation:v.GE,factoryType:"shipyard",name:"borneo",egress:"javasea",isHome:!0}],Mi=[["moscow","budapest"],["moscow","odessa"],["moscow","omsk"],["budapest","moscow"],["budapest","odessa"],["budapest","constantinople"],["budapest","mediterraneansea"],["constantinople","budapest"],["constantinople","mediterraneansea"],["constantinople","angora"],["mediterraneansea","arabiansea"],["mediterraneansea","constantinople"],["mediterraneansea","budapest"],["mediterraneansea","odessa"],["mediterraneansea","armenia"],["mediterraneansea","angora"],["mediterraneansea","syria"],["mediterraneansea","egypt"],["egypt","mediterraneansea"],["egypt","syria"],["egypt","sudan"],["egypt","arabiansea"],["sudan","egypt"],["sudan","eastafrica"],["sudan","arabiansea"],["sudan","indianocean"],["odessa","moscow"],["odessa","budapest"],["odessa","mediterraneansea"],["odessa","omsk"],["odessa","armenia"],["odessa","persia"],["angora","constantinople"],["angora","mediterraneansea"],["angora","armenia"],["armenia","odessa"],["armenia","persia"],["armenia","iraq"],["armenia","syria"],["armenia","angora"],["armenia","mediterraneansea"],["syria","mediterraneansea"],["syria","armenia"],["syria","iraq"],["syria","arabia"],["syria","egypt"],["iraq","armenia"],["iraq","persia"],["iraq","arabia"],["iraq","syria"],["iraq","arabiansea"],["arabia","syria"],["arabia","iraq"],["arabia","arabiansea"],["persia","odessa"],["persia","omsk"],["persia","afghanistan"],["persia","arabiansea"],["persia","iraq"],["persia","armenia"],["omsk","moscow"],["omsk","odessa"],["omsk","persia"],["omsk","afghanistan"],["omsk","sinkiang"],["omsk","irkutsk"],["afghanistan","persia"],["afghanistan","omsk"],["afghanistan","sinkiang"],["afghanistan","delhi"],["afghanistan","arabiansea"],["arabiansea","persia"],["arabiansea","afghanistan"],["arabiansea","delhi"],["arabiansea","bombay"],["arabiansea","indianocean"],["arabiansea","eastafrica"],["arabiansea","sudan"],["arabiansea","egypt"],["arabiansea","syria"],["arabiansea","arabia"],["arabiansea","iraq"],["eastafrica","sudan"],["eastafrica","arabiansea"],["eastafrica","indianocean"],["indianocean","sudan"],["indianocean","eastafrica"],["indianocean","arabiansea"],["indianocean","madras"],["indianocean","bayofbengal"],["indianocean","sumatra"],["indianocean","java"],["indianocean","timorsea"],["irkutsk","omsk"],["irkutsk","mongolia"],["irkutsk","vladivostok"],["mongolia","irkutsk"],["mongolia","vladivostok"],["mongolia","northkorea"],["mongolia","yellowsea"],["mongolia","shanghai"],["mongolia","peking"],["mongolia","sinkiang"],["sinkiang","omsk"],["sinkiang","mongolia"],["sinkiang","peking"],["sinkiang","canton"],["sinkiang","burma"],["sinkiang","bengal"],["sinkiang","nepal"],["sinkiang","delhi"],["sinkiang","afghanistan"],["delhi","afghanistan"],["delhi","sinkiang"],["delhi","nepal"],["delhi","bengal"],["delhi","hyderabad"],["delhi","bombay"],["delhi","arabiansea"],["bombay","arabiansea"],["bombay","delhi"],["bombay","hyderabad"],["bombay","madras"],["madras","indianocean"],["madras","bombay"],["madras","hyderabad"],["hyderabad","bombay"],["hyderabad","delhi"],["hyderabad","bengal"],["hyderabad","bayofbengal"],["hyderabad","madras"],["bengal","delhi"],["bengal","nepal"],["bengal","burma"],["bengal","bayofbengal"],["bengal","hyderabad"],["nepal","delhi"],["nepal","sinkiang"],["nepal","bengal"],["bayofbengal","hyderabad"],["bayofbengal","bengal"],["bayofbengal","burma"],["bayofbengal","malaysia"],["bayofbengal","timorsea"],["bayofbengal","sumatra"],["bayofbengal","indianocean"],["burma","sinkiang"],["burma","tongking"],["burma","malaysia"],["burma","bayofbengal"],["burma","bengal"],["vladivostok","irkutsk"],["vladivostok","mongolia"],["vladivostok","northkorea"],["vladivostok","okhotsksea"],["okhotsksea","vladivostok"],["okhotsksea","otaru"],["okhotsksea","seaofjapan"],["okhotsksea","northkorea"],["northkorea","vladivostok"],["northkorea","okhotsksea"],["northkorea","southkorea"],["northkorea","mongolia"],["southkorea","northkorea"],["southkorea","seaofjapan"],["southkorea","yellowsea"],["otaru","okhotsksea"],["otaru","akita"],["akita","otaru"],["akita","seaofjapan"],["akita","tokyo"],["tokyo","akita"],["tokyo","seaofjapan"],["tokyo","kyoto"],["kyoto","tokyo"],["kyoto","seaofjapan"],["kyoto","kyushu"],["kyushu","kyoto"],["kyushu","yellowsea"],["seaofjapan","kyoto"],["seaofjapan","tokyo"],["seaofjapan","akita"],["seaofjapan","okhotsksea"],["seaofjapan","southkorea"],["seaofjapan","yellowsea"],["yellowsea","shanghai"],["yellowsea","mongolia"],["yellowsea","northkorea"],["yellowsea","southkorea"],["yellowsea","seaofjapan"],["yellowsea","kyushu"],["yellowsea","formosa"],["yellowsea","southchinasea"],["peking","mongolia"],["peking","shanghai"],["peking","canton"],["peking","sinkiang"],["shanghai","mongolia"],["shanghai","yellowsea"],["shanghai","canton"],["shanghai","peking"],["canton","sinkiang"],["canton","peking"],["canton","shanghai"],["canton","southchinasea"],["canton","hongkong"],["canton","tongking"],["formosa","yellowsea"],["tongking","canton"],["tongking","southchinasea"],["tongking","annam"],["tongking","siam"],["tongking","burma"],["siam","tongking"],["siam","annam"],["siam","cambodia"],["siam","malaysia"],["annam","tongking"],["annam","southchinasea"],["annam","cambodia"],["annam","cochin"],["annam","siam"],["cambodia","siam"],["cambodia","annam"],["cambodia","cochin"],["cambodia","javasea"],["cambodia","malaysia"],["cochin","javasea"],["cochin","cambodia"],["cochin","annam"],["malaysia","javasea"],["malaysia","burma"],["malaysia","siam"],["malaysia","cambodia"],["malaysia","bayofbengal"],["hongkong","canton"],["hongkong","southchinasea"],["manila","southchinasea"],["manila","davao"],["southchinasea","canton"],["southchinasea","hongkong"],["southchinasea","manila"],["southchinasea","yellowsea"],["southchinasea","javasea"],["southchinasea","annam"],["southchinasea","tongking"],["southchinasea","timorsea"],["davao","manila"],["davao","javasea"],["javasea","davao"],["javasea","sarawak"],["javasea","borneo"],["javasea","timorsea"],["javasea","bayofbengal"],["javasea","malaysia"],["javasea","cambodia"],["javasea","cochin"],["javasea","southchinasea"],["sumatra","indianocean"],["sumatra","bayofbengal"],["sumatra","timorsea"],["sumatra","java"],["sumatra","javasea"],["java","indianocean"],["java","timorsea"],["java","sumatra"],["sarawak","javasea"],["sarawak","borneo"],["borneo","sarawak"],["borneo","javasea"],["borneo","celebes"],["celebes","borneo"],["celebes","timorsea"],["newguinea","timorsea"],["timorsea","newguinea"],["timorsea","java"],["timorsea","sumatra"],["timorsea","javasea"],["timorsea","celebes"],["timorsea","southchinasea"],["timorsea","indianocean"]],Ui=new At({nodes:Gi,edges:Mi}),ji=(a,t)=>{if(t==="imperial")switch(a.length){case 2:return[{id:a[0].id,nation:k.AH},{id:a[1].id,nation:k.IT}];case 3:return[{id:a[0].id,nation:k.AH},{id:a[1].id,nation:k.IT},{id:a[2].id,nation:k.FR}];case 4:return[{id:a[0].id,nation:k.AH},{id:a[1].id,nation:k.IT},{id:a[2].id,nation:k.FR},{id:a[3].id,nation:k.GB}];case 5:return[{id:a[0].id,nation:k.AH},{id:a[1].id,nation:k.IT},{id:a[2].id,nation:k.FR},{id:a[3].id,nation:k.GB},{id:a[4].id,nation:k.GE}];case 6:return[{id:a[0].id,nation:k.AH},{id:a[1].id,nation:k.IT},{id:a[2].id,nation:k.FR},{id:a[3].id,nation:k.GB},{id:a[4].id,nation:k.GE},{id:a[5].id,nation:k.RU}];default:return[]}else if(t==="imperial2030")switch(a.length){case 2:return[{id:a[0].id,nation:N.RU},{id:a[1].id,nation:N.CN}];case 3:return[{id:a[0].id,nation:N.RU},{id:a[1].id,nation:N.CN},{id:a[2].id,nation:N.IN}];case 4:return[{id:a[0].id,nation:N.RU},{id:a[1].id,nation:N.CN},{id:a[2].id,nation:N.IN},{id:a[3].id,nation:N.BR}];case 5:return[{id:a[0].id,nation:N.RU},{id:a[1].id,nation:N.CN},{id:a[2].id,nation:N.IN},{id:a[3].id,nation:N.BR},{id:a[4].id,nation:N.US}];case 6:return[{id:a[0].id,nation:N.RU},{id:a[1].id,nation:N.CN},{id:a[2].id,nation:N.IN},{id:a[3].id,nation:N.BR},{id:a[4].id,nation:N.US},{id:a[5].id,nation:N.EU}];default:return[]}else if(t==="imperialAsia")switch(a.length){case 2:return[{id:a[0].id,nation:v.CN},{id:a[1].id,nation:v.JP}];case 3:return[{id:a[0].id,nation:v.CN},{id:a[1].id,nation:v.JP},{id:a[2].id,nation:v.FR}];case 4:return[{id:a[0].id,nation:v.CN},{id:a[1].id,nation:v.JP},{id:a[2].id,nation:v.FR},{id:a[3].id,nation:v.GB}];case 5:return[{id:a[0].id,nation:v.CN},{id:a[1].id,nation:v.JP},{id:a[2].id,nation:v.FR},{id:a[3].id,nation:v.GB},{id:a[4].id,nation:v.TR}];case 6:return[{id:a[0].id,nation:v.CN},{id:a[1].id,nation:v.JP},{id:a[2].id,nation:v.FR},{id:a[3].id,nation:v.GB},{id:a[4].id,nation:v.TR},{id:a[5].id,nation:v.RU}];default:return[]}return[]},Hi=(a,t)=>a.map(e=>{let i;t==="imperial"?i=k:t==="imperial2030"?i=N:t==="imperialAsia"&&(i=v);const r=JSON.parse(e);return r.type==="initialize"&&(!r.payload.variant||r.payload.variant==="standard")&&(r.payload.players=r.payload.players.map(s=>({id:s.id,nation:i[s.nation.value]}))),r.payload&&(r.payload.incumbent&&(r.payload.incumbent=i[r.payload.incumbent.value]),r.payload.challenger&&(r.payload.challenger=i[r.payload.challenger.value]),r.payload.nation&&(r.payload.nation=i[r.payload.nation.value])),r}),Li="/assets/favicon2-4c21b237.ico",Di="/assets/favicon3-a46d28f9.ico",Vi="/assets/notification-a5bff45c.mp3",zi={name:"Game",components:{Board:Xn,ControlPanel:Ra,GameDetails:Va,GameLog:ti,NationComponent:ri,Rondel:Ai,TimeTravelButtons:Ii,TurnStatus:Fi},beforeRouteLeave(a,t,e){ee.userStoppedObservingGame(this.profile.username,this.$route.params.id);const i=document.createElement("link");i.rel="icon",document.getElementsByTagName("head")[0].appendChild(i),this.games.some(s=>s.currentPlayerName===this.profile.username&&!s.winner)?i.href=Di:i.href="/packs/favicon.ico",e()},props:{env:{type:String,default:""},games:{type:Array,default:()=>[]},gameData:{type:Object,default:()=>{}},observers:{type:Array,default:()=>[]},profile:{type:Object,default:()=>{}},users:{type:Array,default:()=>[]}},emits:["receiveGameData"],data:()=>({importProvince:"",board:{},boardConfig:{},controllingPlayerName:"",currentPlayer:{},game:{},gameLogDialog:!1,gameStarted:!1,importPlacements:[],joinedGame:!1,logTimestamps:[],maneuverOrigin:"",nationsCard:!1,playerDialog:!1,poppedTurns:[],provinceWithFight:"",silenceAudio:!0,tab:null,tradedInBondNation:"",tradedInValue:0}),computed:{reversedGameLog(){return this.game.log?this.game.log.slice().reverse():[]},playingInThisGame(){let a=!1;for(const t of this.playersInGame)t===this.profile.username&&(a=!0);return!!a},hostingThisGame(){return this.gameData.host===this.profile.username},playersInGame(){return this.games.find(a=>a.id===this.$route.params.id).players.map(a=>a.name)},paused(){return this.poppedTurns.length>0}},created(){ee.getGameLog(this.$route.params.id,this.game.baseGame),window.addEventListener("beforeunload",this.beforeWindowUnload),ee.userObservingGame(this.profile.username,this.$route.params.id)},updated(){this.getBoardConfig(),document.title=`${this.gameData.name} - Imperial`},beforeUnmount(){window.removeEventListener("beforeunload",this.beforeWindowUnload)},methods:{getBoardConfig(){this.gameData.baseGame==="imperial"?$(()=>import("./boardConfigs-2bf115ec.js"),["assets/boardConfigs-2bf115ec.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]).then(a=>{this.boardConfig=a.default.imperial}):this.gameData.baseGame==="imperial2030"?$(()=>import("./board2030Configs-ef5de4b3.js"),["assets/board2030Configs-ef5de4b3.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]).then(a=>{this.boardConfig=a.default.imperial2030}):this.gameData.baseGame==="imperialAsia"&&$(()=>import("./boardAsiaConfigs-d886db7b.js"),["assets/boardAsiaConfigs-d886db7b.js","assets/index-dfdf83d7.js","assets/index-80ed489d.css"]).then(a=>{this.boardConfig=a.default.imperialAsia})},beforeWindowUnload(){ee.userStoppedObservingGame(this.profile.username,this.$route.params.id)},otherPlayersInGame(){return this.playersInGame.filter(t=>t!==this.profile.username)},joinGame(){this.joinedGame=!0,ee.joinGame(this.$cookies.get("user_id"),this.$route.params.id,this.profile.username)},startGame(){const a=this.playerNames(this.gameData);let t=this.shuffle(a);const{baseGame:e}=this.gameData,{variant:i}=this.gameData;i==="standard"&&(t=ji(t,e));const{soloMode:r}=this.gameData,s=C.initialize({players:t,soloMode:r,variant:i,baseGame:e});ee.tick(this.gameData.id,s)},cancelGame(){ee.cancel(this.gameData.id),this.$router.push("/")},boot(a){ee.boot(a,this.$route.params.id)},leaveGame(a){this.boot(a),this.$router.push("/")},gameCancelled(){return this.gameData.cancelledAt},playerNames(a){return a.players.length===1?(a.soloMode=!0,a.players.push({name:"Charles"},{name:"Louis"},{name:"Otto"},{name:"Henry"},{name:"Conrad"}),a.players.map(t=>t.name)):(a.soloMode=!1,a.players.map(t=>t.name))},shuffle(a){let t=a.length,e,i;for(;t!==0;)i=Math.floor(Math.random()*t),t-=1,e=a[t],a[t]=a[i],a[i]=e;return a.map(r=>({id:r}))},updateGameLog(a,t,e,i){this.logTimestamps=t,this.poppedTurns=[];let r=e;r||(a[0]?r=JSON.parse(a[0]).payload.baseGame||"imperial":{baseGame:r}=this.gameData.baseGame);const s=Hi(a,r);if(r==="imperial"?this.board=Nt:r==="imperial2030"?this.board=Ei:r==="imperialAsia"&&(this.board=Ui),this.game=Q(new Ne(this.board,new Oe(this.env,this.gameData.id))),r&&(this.game.baseGame=r),this.game.tickFromLog(s),Object.keys(this.game.players).length>0&&(this.gameStarted=!0,this.currentPlayer=this.game.players[this.profile.username]||{},this.controllingPlayerName=this.game.currentPlayerName,this.updateFavicon(),this.audioNotification()),i!==this.game.currentPlayerName&&(i===this.profile.username||!i&&this.game.currentPlayerName)&&ee.notifyNextPlayer(this.$route.params.id,this.game.currentPlayerName),ee.updateCurrentPlayerName(this.$route.params.id,this.game.currentPlayerName),this.game.winner){const c={};for(const u in this.game.players)c[u]=this.game.players[u].rawScore+this.game.players[u].cash;ee.updateWinner(this.$route.params.id,this.game.winner,c)}this.silenceAudio=!1},validProvinces(){const a=new Set;if(this.game.currentPlayerName===this.profile.username||this.game.soloMode&&this.hostingThisGame)for(const t of this.game.availableActions)t.type==="maneuver"&&this.game.maneuvering?this.maneuverOrigin===t.payload.origin?a.add(t.payload.destination):this.maneuverOrigin||a.add(t.payload.origin):t.type==="import"&&this.game.importing?t.payload.placements.forEach(e=>{a.add(e.province)}):t.type==="buildFactory"&&this.game.buildingFactory&&a.add(t.payload.province);return Array.from(a)},selectProvince(a){const t=a.replace(/\.*\s/gm,"").toLowerCase();let e=!1;for(const i of this.validProvinces())if(i===t){e=!0;break}if(!e){this.maneuverOrigin="";return}if(this.game.currentPlayerName===this.profile.username||this.game.soloMode&&this.hostingThisGame){if(this.game.maneuvering&&this.maneuverOrigin){const i=C.maneuver({origin:this.maneuverOrigin,destination:t});this.maneuverOrigin="",this.tickWithAction(i)}else if(this.game.maneuvering)this.maneuverOrigin=t;else if(this.game.importing)this.game.board.graph.get(t).factoryType==="shipyard"?this.importProvince=t:this.importPlacements.push({province:t,type:"army",nation:this.game.currentNation.value}),this.importPlacements.length===this.game.maxImports&&this.runImport();else if(this.game.buildingFactory)for(const i of this.game.availableActions)i.payload.province===t&&this.tickWithAction(i)}},tickWithAction(a){this.controllingPlayerName=this.game.currentPlayerName,this.paused||(ee.tick(this.$route.params.id,a),this.displayFight(a))},displayFight(a){a.type==="fight"&&(this.provinceWithFight=a.payload.province)},resolveFight(){this.provinceWithFight=""},makeImportTypeChoice(a){this.importPlacements.push({province:this.importProvince,type:a,nation:this.game.currentNation.value}),this.importProvince="",this.importPlacements.length===this.game.maxImports&&this.runImport()},runImport(){const a=this.importPlacements;a.forEach(t=>delete t.nation),this.tickWithAction(C.import({placements:a})),this.importPlacements=[]},skipBuildFactory(){for(const a of this.game.availableActions)a.type==="skipBuildFactory"&&this.tickWithAction(a)},endManeuver(){this.tickWithAction(C.endManeuver()),this.maneuverOrigin=""},back(){const a=this.game.log.pop();this.poppedTurns.push(a);let t=this.game.log[this.game.log.length-1].type;for(;t!=="rondel"&&t!=="initialize"||t==="endGame";)this.poppedTurns.push(this.game.log.pop()),t=this.game.log[this.game.log.length-1].type;const{log:e}=this.game,{baseGame:i}=this.game;this.game=Q(new Ne(this.board,new Oe("replay",this.gameData.id))),i&&(this.game.baseGame=i),this.game.tickFromLog(e)},backToRoundStart(){const a=this.game.baseGame==="imperial"?k.AH:N.RU;for(;this.game.log[this.game.log.length-1].payload.nation!==a||this.game.log[this.game.log.length-1].type!=="rondel";)this.back();const t=this.game.log.pop();this.poppedTurns.push(t);const{log:e}=this.game,{baseGame:i}=this.game;this.game=Q(new Ne(this.board,new Oe("replay",this.gameData.id))),i&&(this.game.baseGame=i),this.game.tickFromLog(e)},backToGameStart(){for(;this.game.log[this.game.log.length-1].type!=="initialize";)this.back()},forward(){var e;const a=this.game.log;for(a.push(this.poppedTurns.pop());((e=this.poppedTurns[this.poppedTurns.length-1])==null?void 0:e.type)==="maneuver";)a.push(this.poppedTurns.pop());const{baseGame:t}=this.game;this.game=Q(new Ne(this.board,new Oe("replay",this.gameData.id))),t&&(this.game.baseGame=t),this.game.tickFromLog(a)},forwardToCurrentAction(){for(;this.poppedTurns.length>0;)this.forward()},updateFavicon(){if(this.currentPlayer.name===this.game.currentPlayerName){const a=document.createElement("link");a.rel="icon",document.getElementsByTagName("head")[0].appendChild(a),a.href=Li}else{const a=document.createElement("link");a.rel="icon",document.getElementsByTagName("head")[0].appendChild(a),a.href="/packs/favicon.ico"}},audioNotification(){this.currentPlayer.name===this.game.currentPlayerName&&!this.silenceAudio&&new jt.Howl({src:[Vi]}).play()},baseGameString(a){switch(a){case"imperial":return"Original Imperial";case"imperial2030":return"Imperial 2030";case"imperialAsia":return"Imperial Asia";default:return"Imperial"}},variant(a){return a==="standard"?"Standard (with investor card, no auction)":a==="auction"?"Auction (with investor card and auction)":a==="withoutInvestorCard"?"Without Investor Card (with auction, no investor card)":""},cloneGame(){fetch("http://localhost:3000/clone_games",{method:"POST",body:JSON.stringify({id:this.$route.params.id,host_id:this.profile.id,log:this.game.log}),headers:{"Content-Type":"application/json"}}).then(a=>a.json()).then(a=>{this.$emit("receiveGameData",a),ee.getGameLog(a.id,this.game.baseGame),this.$router.push(`/game/${a.id}`)})},goToSourceGame(){const a=this.gameData.clonedFromGame;ee.getGameLog(a,this.game.baseGame),this.$router.push(`/game/${a}`)},canPayOut(a){let t=0;for(const e in this.game.players)for(const i of this.game.players[e].bonds)i.nation===a&&(t+=i.number);return this.game.nations.get(a).treasury>=t},toggleTradeIn(a){this.tradedInValue>0?(this.tradedInBondNationValue="",this.tradedInValue=0):(this.tradedInBondNation=a.nation.value,this.tradedInValue=a.cost)},purchaseBond(a){for(const t of this.game.availableActions)a.cost===t.payload.cost&&a.nation.value===t.payload.nation.value&&t.payload.tradeInValue===this.tradedInValue&&(this.tickWithAction(t),this.tradedInValue=0)}}},Wi={class:"text-h5 mr-2"},qi={key:0},Ji={class:"d-flex"},Xi={key:0},Yi={key:1},Zi={key:2},Qi={key:0},$i=A("b",null,"Players:",-1),Ki=A("b",null,"Base game:",-1),er=A("b",null,"Variant:",-1),tr={key:1},nr=A("b",null,"Players:",-1),ar=A("b",null,"Base game:",-1),ir=A("b",null,"Variant:",-1),rr=A("div",{class:"text-2xl m-2"}," Game not yet started! ",-1),or={key:2},sr={class:"mx-auto p-2 text-center"},lr=A("b",null,"Players:",-1),cr=A("b",null,"Base game:",-1),dr=A("b",null,"Variant:",-1);function ur(a,t,e,i,r,s){const c=P("v-btn"),u=P("v-col"),f=P("v-row"),m=P("TurnStatus"),h=P("v-icon"),n=P("v-tab"),o=P("v-tabs"),l=P("v-window-item"),d=P("NationComponent"),y=P("GameDetails"),b=P("GameLog"),g=P("v-window"),w=P("v-sheet"),S=P("Board"),M=P("TimeTravelButtons"),q=P("ControlPanel"),oe=P("Rondel"),ke=P("v-main"),Fe=P("v-layout"),D=P("v-card");return _(),B(w,null,{default:p(()=>[T(f,{align:"center"},{default:p(()=>[T(u,null,{default:p(()=>[A("span",Wi,[x(F(e.gameData.name)+" ",1),e.gameData.clonedFromGame?(_(),R("span",qi,"(clone)")):E("",!0)]),e.gameData.clonedFromGame&&a.gameStarted?(_(),B(c,{key:0,size:"x-small",onClick:s.goToSourceGame},{default:p(()=>[x(" Back to source game ")]),_:1},8,["onClick"])):a.gameStarted?(_(),B(c,{key:1,size:"x-small",onClick:s.cloneGame},{default:p(()=>[x(" Clone game ")]),_:1},8,["onClick"])):E("",!0)]),_:1})]),_:1}),a.gameStarted?(_(),B(w,{key:0},{default:p(()=>[T(m,{game:a.game,profile:e.profile,"controlling-player-name":a.controllingPlayerName,paused:s.paused},null,8,["game","profile","controlling-player-name","paused"]),T(f,null,{default:p(()=>[T(u,null,{default:p(()=>[T(D,null,{default:p(()=>[T(Fe,null,{default:p(()=>[T(w,null,{default:p(()=>[A("div",Ji,[T(o,{modelValue:a.tab,"onUpdate:modelValue":t[0]||(t[0]=J=>a.tab=J),optional:"",direction:"vertical",color:"primary-darken-1"},{default:p(()=>[T(n,null,{default:p(()=>[T(h,{size:"x-large"},{default:p(()=>[x(" mdi-fullscreen ")]),_:1})]),_:1}),T(n,{value:"nations"},{default:p(()=>[T(h,{size:"x-large"},{default:p(()=>[x(" mdi-flag ")]),_:1})]),_:1}),T(n,{value:"players"},{default:p(()=>[T(h,{size:"x-large"},{default:p(()=>[x(" mdi-account-group ")]),_:1})]),_:1}),T(n,{value:"gameLog"},{default:p(()=>[T(h,{size:"x-large"},{default:p(()=>[x(" mdi-script-text-outline ")]),_:1})]),_:1})]),_:1},8,["modelValue"]),T(g,{modelValue:a.tab,"onUpdate:modelValue":t[1]||(t[1]=J=>a.tab=J)},{default:p(()=>[T(l),T(l,{value:"nations"},{default:p(()=>[(_(!0),R(V,null,z(a.game.nations,([J])=>(_(),B(d,{key:J.value,"current-nation":a.game.currentNation.value,nation:J.value,treasury:a.game.nations.get(J).treasury,"can-pay-out":s.canPayOut(J),"power-points":a.game.nations.get(J).powerPoints,controller:a.game.nations.get(J).controller,"current-player":e.profile.username,"base-game":a.game.baseGame,winner:a.game.winner},null,8,["current-nation","nation","treasury","can-pay-out","power-points","controller","current-player","base-game","winner"]))),128))]),_:1}),T(l,{value:"players"},{default:p(()=>[T(y,{game:a.game,"game-data":e.gameData,"controlling-player-name":a.controllingPlayerName,profile:e.profile,"online-users":e.users,paused:s.paused,"hosting-this-game":s.hostingThisGame,onTick:s.tickWithAction,onToggleTradeIn:s.toggleTradeIn},null,8,["game","game-data","controlling-player-name","profile","online-users","paused","hosting-this-game","onTick","onToggleTradeIn"])]),_:1}),T(l,{value:"gameLog"},{default:p(()=>[T(b,{log:a.game.annotatedLog,"log-timestamps":a.logTimestamps,board:a.board},null,8,["log","log-timestamps","board"])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),T(ke,null,{default:p(()=>[T(w,null,{default:p(()=>[T(f,null,{default:p(()=>[T(u,{cols:"12",class:"mx-auto"},{default:p(()=>[T(S,{config:a.boardConfig,game:a.game,"game-started":a.gameStarted,paused:s.paused,profile:e.profile,"province-with-fight":a.provinceWithFight,"select-province":s.selectProvince,"units-to-import":a.importPlacements,"valid-provinces":s.validProvinces(),onFightResolved:s.resolveFight},null,8,["config","game","game-started","paused","profile","province-with-fight","select-province","units-to-import","valid-provinces","onFightResolved"]),T(M,{game:a.game,"popped-turns":a.poppedTurns,onBackToGameStartEvent:s.backToGameStart,onBackToRoundStartEvent:s.backToRoundStart,onBackEvent:s.back,onForwardEvent:s.forward,onForwardToCurrentActionEvent:s.forwardToCurrentAction},null,8,["game","popped-turns","onBackToGameStartEvent","onBackToRoundStartEvent","onBackEvent","onForwardEvent","onForwardToCurrentActionEvent"])]),_:1})]),_:1}),T(f,null,{default:p(()=>[T(u,{cols:"11",class:"mx-auto"},{default:p(()=>[T(q,{game:a.game,"choose-import-type":a.importProvince,"controlling-player-name":a.controllingPlayerName,profile:e.profile,"import-placements":a.importPlacements,"game-data":e.gameData,"traded-in-bond-nation":a.tradedInBondNation,"traded-in-value":a.tradedInValue,paused:s.paused,"hosting-this-game":s.hostingThisGame,onTick:s.tickWithAction,onEndManeuver:s.endManeuver,onChooseImportType:s.makeImportTypeChoice,onRunImport:s.runImport,onSkipBuildFactory:s.skipBuildFactory,onPurchaseBond:s.purchaseBond,onToggleTradeIn:s.toggleTradeIn},null,8,["game","choose-import-type","controlling-player-name","profile","import-placements","game-data","traded-in-bond-nation","traded-in-value","paused","hosting-this-game","onTick","onEndManeuver","onChooseImportType","onRunImport","onSkipBuildFactory","onPurchaseBond","onToggleTradeIn"])]),_:1})]),_:1}),a.game.winner?E("",!0):(_(),B(f,{key:0,style:{"margin-bottom":"50px"}},{default:p(()=>[T(u,null,{default:p(()=>[T(oe,{game:a.game,name:e.profile.username,paused:s.paused,"hosting-this-game":s.hostingThisGame,onTickWithAction:s.tickWithAction},null,8,["game","name","paused","hosting-this-game","onTickWithAction"])]),_:1})]),_:1}))]),_:1}),a.game.winner?(_(),R("div",Xi)):E("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):s.gameCancelled()?(_(),R("div",Yi," This game was cancelled by the host ")):(_(),R("div",Zi,[T(f,null,{default:p(()=>[T(u,{cols:"8"},{default:p(()=>[T(S,{config:a.boardConfig,game:a.game,"game-started":a.gameStarted,paused:s.paused,profile:e.profile,"province-with-fight":a.provinceWithFight,"select-province":s.selectProvince,"units-to-import":a.importPlacements,"valid-provinces":s.validProvinces(),onFightResolved:s.resolveFight},null,8,["config","game","game-started","paused","profile","province-with-fight","select-province","units-to-import","valid-provinces","onFightResolved"])]),_:1}),s.hostingThisGame?(_(),R("div",Qi,[A("p",null,[$i,A("span",null,F(s.playersInGame.join(", ")),1)]),A("p",null,[Ki,A("span",null,F(s.baseGameString(e.gameData.baseGame)),1)]),A("p",null,[er,A("span",null,F(s.variant(e.gameData.variant)),1)]),s.playersInGame.length===1?(_(),B(c,{key:0,color:"primary-darken-1",class:"mt-2",block:"",onClick:s.startGame},{default:p(()=>[x(" Start Solo Game (sandbox mode) ")]),_:1},8,["onClick"])):(_(),B(c,{key:1,color:"primary-darken-1",block:"",onClick:s.startGame},{default:p(()=>[x(" Start Game ")]),_:1},8,["onClick"])),T(c,{color:"error",class:"mt-2",block:"",onClick:s.cancelGame},{default:p(()=>[x(" Cancel Game ")]),_:1},8,["onClick"]),(_(!0),R(V,null,z(s.otherPlayersInGame(),J=>(_(),B(c,{key:J,color:"error",block:"",onClick:ut=>s.boot(J)},{default:p(()=>[x(" Boot "+F(J),1)]),_:2},1032,["onClick"]))),128))])):s.playingInThisGame?(_(),R("div",tr,[A("p",null,[nr,A("span",null,F(s.playersInGame.join(", ")),1)]),A("p",null,[ar,A("span",null,F(s.baseGameString(e.gameData.baseGame)),1)]),A("p",null,[ir,A("span",null,F(s.variant(e.gameData.variant)),1)]),rr,A("button",{class:"rounded bg-red-500 text-white cursor-pointer \\ block text-2xl hover:bg-red-600 p-5 m-5 mx-auto",onClick:t[2]||(t[2]=J=>s.leaveGame(e.profile.username))}," Leave game ")])):a.joinedGame?E("",!0):(_(),R("div",or,[A("div",sr,[A("p",null,[lr,A("span",null,F(s.playersInGame.join(", ")),1)]),A("p",null,[cr,A("span",null,F(s.baseGameString(e.gameData.baseGame)),1)]),A("p",null,[dr,A("span",null,F(s.variant(e.gameData.variant)),1)])]),A("button",{class:"rounded bg-green-800 text-white cursor-pointer \\ block text-2xl hover:bg-green-900 p-10 m-10 mx-auto",onClick:t[3]||(t[3]=(...J)=>s.joinGame&&s.joinGame(...J))}," Join This Game ")]))]),_:1})]))]),_:1})}const vr=W(zi,[["render",ur]]);export{vr as default};
